
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>bfdtd.BFDTDobject &#8212; script_inception_public  documentation</title>
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">script_inception_public  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for bfdtd.BFDTDobject</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">configparser</span>

<span class="kn">from</span> <span class="nn">numpy.linalg</span> <span class="k">import</span> <span class="n">norm</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="k">import</span> <span class="n">array</span><span class="p">,</span> <span class="n">rad2deg</span><span class="p">,</span> <span class="n">cross</span><span class="p">,</span> <span class="n">dot</span><span class="p">,</span> <span class="n">sqrt</span><span class="p">,</span> <span class="n">ceil</span><span class="p">,</span> <span class="n">floor</span>

<span class="kn">from</span> <span class="nn">utilities.common</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">utilities.brisFDTD_ID_info</span>
<span class="kn">from</span> <span class="nn">meshing.meshing</span> <span class="k">import</span> <span class="n">subGridMultiLayer</span>

<span class="kn">from</span> <span class="nn">constants.physcon</span> <span class="k">import</span> <span class="n">get_c0</span><span class="p">,</span> <span class="n">get_e</span><span class="p">,</span> <span class="n">get_eV</span><span class="p">,</span> <span class="n">get_epsilon0</span><span class="p">,</span> <span class="n">get_mu0</span><span class="p">,</span> <span class="n">get_h</span><span class="p">,</span> <span class="n">get_h_eVs</span><span class="p">,</span> <span class="n">get_hb</span><span class="p">,</span> <span class="n">get_me</span>

<span class="kn">from</span> <span class="nn">.BFDTDentry</span> <span class="k">import</span> <span class="n">BFDTDentry</span>
<span class="kn">from</span> <span class="nn">.excitation</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.meshobject</span> <span class="k">import</span> <span class="n">MeshObject</span><span class="p">,</span> <span class="n">MeshingParameters</span>
<span class="kn">from</span> <span class="nn">.snapshot</span> <span class="k">import</span> <span class="n">TimeSnapshot</span><span class="p">,</span> <span class="n">ModeFilteredProbe</span><span class="p">,</span> <span class="n">EpsilonSnapshot</span><span class="p">,</span> <span class="n">FrequencySnapshot</span><span class="p">,</span> <span class="n">EpsilonBox</span><span class="p">,</span> <span class="n">EpsilonBoxFull</span><span class="p">,</span> <span class="n">SnapshotBoxSurface</span><span class="p">,</span> <span class="n">SnapshotBox</span><span class="p">,</span> <span class="n">ModeVolumeBoxFull</span>
<span class="kn">from</span> <span class="nn">.probe</span> <span class="k">import</span> <span class="n">Probe</span>

<span class="c1"># .. todo:: fix these globbed imports?</span>
<span class="kn">from</span> <span class="nn">.bristolFDTD_generator_functions</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.GeometryObjects</span> <span class="k">import</span> <span class="o">*</span>

<div class="viewcode-block" id="BFDTDobject"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject">[docs]</a><span class="k">class</span> <span class="nc">BFDTDobject</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  .. todo:: add addSnapshot, addProbe, etc functions to BFDTDobject to make adding stuff easier (should copy value from last similar)</span>
<span class="sd">  .. todo:: beware of the multiple snapshot lists! reduce duplicate info and add set/get functions</span>
<span class="sd">  .. todo:: implement &quot;orientation&quot; thingie from triangular_prism.py to easily exchange axes.</span>
<span class="sd">  .. todo:: objects should be able to have parents, etc. (try to follow structure similar to what is in Blender)</span>
<span class="sd">  .. todo:: We might want to add a more generic .inp object combining snapshots, probes, etc instead of all those different lists?</span>
<span class="sd">  .. todo:: We need &quot;periodic objects&quot; to reduce RAM usage in case of crystal/periodic structures.</span>
<span class="sd">  </span>
<span class="sd">  .. todo:: DESIGN: Debate advantage of using single lists for objects or per-type lists + epsilon/MF-probe/time-snapshots distinctions.</span>
<span class="sd">  </span>
<span class="sd">    * single list:</span>
<span class="sd">    </span>
<span class="sd">      * advantages: Ability to write out objects in arbitrary orders, including same as originally imported/read file. -&gt; User could use custom object write functions if he wants to do that. Non-canonical ordering should be discouraged anyway. (and not matter to the simulation) Geo objects will be ordered in any case as that is the only place order matters.</span>
<span class="sd">      * disadvantages: Need to loop through list to get specific types of object. -&gt; Except for geo objects, it is unlikely that there will be more than ~2000 objects. And if size becomes a problem, it should be possible to hack in something custom for extreme cases.</span>
<span class="sd">      </span>
<span class="sd">    * multiples lists:</span>
<span class="sd">    </span>
<span class="sd">      * advantages: Faster access to specific types of objects. Easy to write things out in a canonical order. -&gt; Writing out in canonical order can also be done with single lists and some filtering.</span>
<span class="sd">      * disadvantages: lots of attributes and what if we add new objects? -&gt; it should be ok to limit ourselves to geo, exc, (probe, tsnap, fsnap). Any additional objects can be subclasses and if really different, a new list. get/set() functions can be added as needed. They are also needed with single lists anyway. So no change from user point of view.</span>
<span class="sd">  </span>
<span class="sd">  .. todo:: append* functions do not check the type of the appended object. It would also be possible to assign object to the various lists based on their type. cf design todo...</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    
    <span class="c1"># read configuration options from a config file</span>
    <span class="c1"># if it does not exist, use defaults and create the config file</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">configparser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">({</span>
                                          <span class="s1">&#39;SafetyChecks&#39;</span><span class="p">:</span> <span class="s1">&#39;True&#39;</span><span class="p">,</span>
                                          <span class="s1">&#39;autoset_FrequencySnapshotSettings&#39;</span><span class="p">:</span> <span class="s1">&#39;True&#39;</span><span class="p">,</span>
                                          <span class="s1">&#39;autoset_N_FrequencySnapshots&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span>
                                          <span class="s1">&#39;autoset_ExcitationStartTime&#39;</span><span class="p">:</span> <span class="s1">&#39;True&#39;</span><span class="p">,</span>
                                          <span class="s1">&#39;AutoFix&#39;</span><span class="p">:</span> <span class="s1">&#39;True&#39;</span><span class="p">,</span>
                                          <span class="s1">&#39;MaxTimeSnapshots&#39;</span><span class="p">:</span> <span class="s1">&#39;99&#39;</span><span class="p">,</span>
                                          <span class="s1">&#39;MaxFrequencySnapshots&#39;</span><span class="p">:</span> <span class="s1">&#39;99&#39;</span><span class="p">,</span>
                                          <span class="s1">&#39;RepetitionFactor_MaxPeriod&#39;</span><span class="p">:</span> <span class="s1">&#39;100&#39;</span><span class="p">,</span>
                                          <span class="s1">&#39;RepetitionFactor_ExcitationEndTime&#39;</span><span class="p">:</span> <span class="s1">&#39;10&#39;</span><span class="p">,</span>
                                          <span class="s1">&#39;RepetitionMode&#39;</span><span class="p">:</span> <span class="s1">&#39;3&#39;</span><span class="p">,</span>
                                        <span class="p">})</span>
    
    <span class="n">configdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">utilities</span><span class="o">.</span><span class="n">getuserdir</span><span class="o">.</span><span class="n">getuserdir</span><span class="p">(),</span> <span class="s1">&#39;.config&#39;</span><span class="p">,</span> <span class="s1">&#39;script_inception_public&#39;</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">configdir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">configfile_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">configdir</span><span class="p">,</span> <span class="s1">&#39;BFDTDobject.ini&#39;</span><span class="p">)</span>
    <span class="c1">#print(&#39;configfile_name = &#39;, configfile_name)</span>
    <span class="n">configfiles_read</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">configfile_name</span><span class="p">)</span>
    <span class="c1">#print(&#39;configfiles_read = &#39;, configfiles_read)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">SafetyChecks</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;DEFAULT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getboolean</span><span class="p">(</span><span class="s1">&#39;SafetyChecks&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">autoset_FrequencySnapshotSettings</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;DEFAULT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getboolean</span><span class="p">(</span><span class="s1">&#39;autoset_FrequencySnapshotSettings&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">autoset_N_FrequencySnapshots</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;DEFAULT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getint</span><span class="p">(</span><span class="s1">&#39;autoset_N_FrequencySnapshots&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">autoset_ExcitationStartTime</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;DEFAULT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getboolean</span><span class="p">(</span><span class="s1">&#39;autoset_ExcitationStartTime&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">AutoFix</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;DEFAULT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getboolean</span><span class="p">(</span><span class="s1">&#39;AutoFix&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">MaxTimeSnapshots</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;DEFAULT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getint</span><span class="p">(</span><span class="s1">&#39;MaxTimeSnapshots&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">MaxFrequencySnapshots</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;DEFAULT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getint</span><span class="p">(</span><span class="s1">&#39;MaxFrequencySnapshots&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">RepetitionFactor_MaxPeriod</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;DEFAULT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getint</span><span class="p">(</span><span class="s1">&#39;RepetitionFactor_MaxPeriod&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">RepetitionFactor_ExcitationEndTime</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;DEFAULT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getint</span><span class="p">(</span><span class="s1">&#39;RepetitionFactor_ExcitationEndTime&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">RepetitionMode</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;DEFAULT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getint</span><span class="p">(</span><span class="s1">&#39;RepetitionMode&#39;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">configfiles_read</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No config file found. Creating </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">configfile_name</span><span class="p">))</span>
      <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">configfile_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">configfile</span><span class="p">:</span>
        <span class="n">config</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">configfile</span><span class="p">)</span>
    
    <span class="c1"># enable/disable safety checks:</span>
    <span class="c1"># TODO: Use  warnings.warn() + warnings.simplefilter() to change behaviour? -&gt; but we would like it to be specific to this module and not affect others...</span>
    <span class="c1">#self.checkSimulation = True</span>
    <span class="c1">#self.setSafetyChecks(True)</span>
    
    <span class="c1"># enable/disable automatic value settings:</span>
    <span class="c1">#self.autoset_FrequencySnapshotSettings = True</span>
    <span class="c1">#self.autoset_N_FrequencySnapshots = 1</span>
    <span class="c1">#self.autoset_ExcitationStartTime = True</span>
    
    <span class="c1"># mandatory objects</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="o">=</span> <span class="n">MeshObject</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">flag</span> <span class="o">=</span> <span class="n">Flag</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">boundaries</span> <span class="o">=</span> <span class="n">Boundaries</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="n">Box</span><span class="p">()</span>
    
    <span class="c1"># geometry objects</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">geometry_object_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sphere_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">block_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">distorted_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cylinder_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">global_rotation_list</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c1"># excitation objects</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">excitation_list</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c1"># measurement objects</span>
    <span class="c1">#self.measurement_object_list = [] # TODO: make sure fully unused + not necessary and remove? use subclasses, etc...</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">snapshot_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">time_snapshot_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">frequency_snapshot_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">probe_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># excitation template list</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">excitation_template_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mesh_object_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># special</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fileList</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c1"># excitation object meshes</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fitMeshToExcitations</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fitMeshToProbes</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fitMeshToSnapshots</span> <span class="o">=</span> <span class="kc">False</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">verboseMeshing</span> <span class="o">=</span> <span class="kc">False</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">=</span> <span class="mi">1</span>
    
    <span class="c1"># default properties for writing files</span>
    <span class="c1"># executable to use for shellscripts, running, etc</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">BFDTD_executable</span> <span class="o">=</span> <span class="s1">&#39;fdtd&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fileBaseName</span> <span class="o">=</span> <span class="s1">&#39;sim&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">WORKDIR</span> <span class="o">=</span> <span class="s1">&#39;$JOBDIR&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">WALLTIME</span> <span class="o">=</span> <span class="mi">12</span>
    
    <span class="c1"># default material properties</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">default_permittivity</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">default_conductivity</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="c1"># data input/output</span>
    <span class="c1"># TODO: Decide on proper names/organization</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dataPaths</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;.&#39;</span><span class="p">]</span>
    <span class="c1">#self.data = None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data_time_snapshots</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data_frequency_snapshots</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="c1">#self.data_epsilon = None</span>
    <span class="c1">#self.data_fields_frequency_domain_list = []</span>
    <span class="c1">#self.data_fields_time_domain_list = []</span>
    <span class="c1">#self.data_fields_time_domain_list = []</span>
    
<div class="viewcode-block" id="BFDTDobject.disableSafetyChecks"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.disableSafetyChecks">[docs]</a>  <span class="k">def</span> <span class="nf">disableSafetyChecks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">SafetyChecks</span> <span class="o">=</span> <span class="kc">False</span></div>
  
<div class="viewcode-block" id="BFDTDobject.enableSafetyChecks"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.enableSafetyChecks">[docs]</a>  <span class="k">def</span> <span class="nf">enableSafetyChecks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">SafetyChecks</span> <span class="o">=</span> <span class="kc">True</span></div>
  
<div class="viewcode-block" id="BFDTDobject.disableAutoFix"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.disableAutoFix">[docs]</a>  <span class="k">def</span> <span class="nf">disableAutoFix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">AutoFix</span> <span class="o">=</span> <span class="kc">False</span></div>
  
<div class="viewcode-block" id="BFDTDobject.enableAutoFix"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.enableAutoFix">[docs]</a>  <span class="k">def</span> <span class="nf">enableAutoFix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">AutoFix</span> <span class="o">=</span> <span class="kc">True</span></div>
  
<div class="viewcode-block" id="BFDTDobject.setSafetyChecks"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.setSafetyChecks">[docs]</a>  <span class="k">def</span> <span class="nf">setSafetyChecks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    .. todo:: Finish safety check features...</span>
<span class="sd">    </span>
<span class="sd">    Because safety checks are essential, they currently always raise exceptions.</span>
<span class="sd">    Will decide later which way to go.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;DO NOT USE AT THE MOMENT&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">val</span><span class="p">:</span>
      <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;always&quot;</span><span class="p">)</span></div>
  
  <span class="c1">#################</span>
<div class="viewcode-block" id="BFDTDobject.getExcitationInfos"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getExcitationInfos">[docs]</a>  <span class="k">def</span> <span class="nf">getExcitationInfos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Loops over all excitations and returns the tuple (StartTimeMin, EndTimeMax, FrequencyMin, FrequencyMax).</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">StartTimeMin</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">inf</span>
    <span class="n">EndTimeMax</span> <span class="o">=</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">inf</span>
    <span class="n">FrequencyMin</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">inf</span>
    <span class="n">FrequencyMax</span> <span class="o">=</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">inf</span>
    
    <span class="k">for</span> <span class="n">E</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getExcitations</span><span class="p">():</span>
      <span class="k">if</span> <span class="n">E</span><span class="o">.</span><span class="n">getStartTime</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">StartTimeMin</span><span class="p">:</span>
        <span class="n">StartTimeMin</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">getStartTime</span><span class="p">()</span>
      <span class="k">if</span> <span class="n">E</span><span class="o">.</span><span class="n">getEndTime</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">EndTimeMax</span><span class="p">:</span>
        <span class="n">EndTimeMax</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">getEndTime</span><span class="p">()</span>
      <span class="k">if</span> <span class="n">E</span><span class="o">.</span><span class="n">getFrequencyMin</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">FrequencyMin</span><span class="p">:</span>
        <span class="n">FrequencyMin</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">getFrequencyMin</span><span class="p">()</span>
      <span class="k">if</span> <span class="n">E</span><span class="o">.</span><span class="n">getFrequencyMax</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">FrequencyMax</span><span class="p">:</span>
        <span class="n">FrequencyMax</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">getFrequencyMax</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="p">(</span><span class="n">StartTimeMin</span><span class="p">,</span> <span class="n">EndTimeMax</span><span class="p">,</span> <span class="n">FrequencyMin</span><span class="p">,</span> <span class="n">FrequencyMax</span><span class="p">)</span></div>
  
<div class="viewcode-block" id="BFDTDobject.getExcitationStartTimeMin"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getExcitationStartTimeMin">[docs]</a>  <span class="k">def</span> <span class="nf">getExcitationStartTimeMin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Returns the smallest &quot;start time&quot; of all excitations.&#39;&#39;&#39;</span>
    <span class="p">(</span><span class="n">StartTimeMin</span><span class="p">,</span> <span class="n">EndTimeMax</span><span class="p">,</span> <span class="n">FrequencyMin</span><span class="p">,</span> <span class="n">FrequencyMax</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getExcitationInfos</span><span class="p">()</span>
    <span class="k">return</span><span class="p">(</span><span class="n">StartTimeMin</span><span class="p">)</span></div>
  
<div class="viewcode-block" id="BFDTDobject.getExcitationEndTimeMax"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getExcitationEndTimeMax">[docs]</a>  <span class="k">def</span> <span class="nf">getExcitationEndTimeMax</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Returns the biggest &quot;end time&quot; of all excitations.&#39;&#39;&#39;</span>
    <span class="p">(</span><span class="n">StartTimeMin</span><span class="p">,</span> <span class="n">EndTimeMax</span><span class="p">,</span> <span class="n">FrequencyMin</span><span class="p">,</span> <span class="n">FrequencyMax</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getExcitationInfos</span><span class="p">()</span>
    <span class="k">return</span><span class="p">(</span><span class="n">EndTimeMax</span><span class="p">)</span></div>

<div class="viewcode-block" id="BFDTDobject.getExcitationFrequencyMin"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getExcitationFrequencyMin">[docs]</a>  <span class="k">def</span> <span class="nf">getExcitationFrequencyMin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Returns the smallest &quot;start freqency&quot; of all excitations.&#39;&#39;&#39;</span>
    <span class="p">(</span><span class="n">StartTimeMin</span><span class="p">,</span> <span class="n">EndTimeMax</span><span class="p">,</span> <span class="n">FrequencyMin</span><span class="p">,</span> <span class="n">FrequencyMax</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getExcitationInfos</span><span class="p">()</span>
    <span class="k">return</span><span class="p">(</span><span class="n">FrequencyMin</span><span class="p">)</span></div>
  
<div class="viewcode-block" id="BFDTDobject.getExcitationFrequencyMax"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getExcitationFrequencyMax">[docs]</a>  <span class="k">def</span> <span class="nf">getExcitationFrequencyMax</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Returns the biggest &quot;end frequency&quot; of all excitations.&#39;&#39;&#39;</span>
    <span class="p">(</span><span class="n">StartTimeMin</span><span class="p">,</span> <span class="n">EndTimeMax</span><span class="p">,</span> <span class="n">FrequencyMin</span><span class="p">,</span> <span class="n">FrequencyMax</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getExcitationInfos</span><span class="p">()</span>
    <span class="k">return</span><span class="p">(</span><span class="n">FrequencyMax</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="BFDTDobject.getExcitationFrequencyRange"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getExcitationFrequencyRange">[docs]</a>  <span class="k">def</span> <span class="nf">getExcitationFrequencyRange</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Returns the total frequency range covered by all excitations.&#39;&#39;&#39;</span>
    <span class="p">(</span><span class="n">StartTimeMin</span><span class="p">,</span> <span class="n">EndTimeMax</span><span class="p">,</span> <span class="n">FrequencyMin</span><span class="p">,</span> <span class="n">FrequencyMax</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getExcitationInfos</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">FrequencyMin</span><span class="p">,</span> <span class="n">FrequencyMax</span><span class="p">)</span></div>
  <span class="c1">#################</span>

<div class="viewcode-block" id="BFDTDobject.setAutosetExcitationStartTime"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.setAutosetExcitationStartTime">[docs]</a>  <span class="k">def</span> <span class="nf">setAutosetExcitationStartTime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">autoset_ExcitationStartTime</span> <span class="o">=</span> <span class="n">val</span></div>

<div class="viewcode-block" id="BFDTDobject.setAutosetFrequencySnapshotSettings"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.setAutosetFrequencySnapshotSettings">[docs]</a>  <span class="k">def</span> <span class="nf">setAutosetFrequencySnapshotSettings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">autoset_FrequencySnapshotSettings</span> <span class="o">=</span> <span class="n">val</span></div>

<div class="viewcode-block" id="BFDTDobject.setAutosetNFrequencySnapshots"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.setAutosetNFrequencySnapshots">[docs]</a>  <span class="k">def</span> <span class="nf">setAutosetNFrequencySnapshots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Nsnaps</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">autoset_N_FrequencySnapshots</span> <span class="o">=</span> <span class="n">Nsnaps</span></div>

  <span class="c1"># .. todo:: safety check/autoset combo function?</span>

<div class="viewcode-block" id="BFDTDobject.autosetExcitationStartTime"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.autosetExcitationStartTime">[docs]</a>  <span class="k">def</span> <span class="nf">autosetExcitationStartTime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">E</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getExcitations</span><span class="p">():</span>
      <span class="k">if</span> <span class="n">E</span><span class="o">.</span><span class="n">getStartTime</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING: Fixing excitation start time!&#39;</span><span class="p">)</span>
        <span class="n">E</span><span class="o">.</span><span class="n">setStartTime</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="BFDTDobject.autosetFrequencySnapshotSettings"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.autosetFrequencySnapshotSettings">[docs]</a>  <span class="k">def</span> <span class="nf">autosetFrequencySnapshotSettings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Automatically sets frequency snapshots parameters.</span>
<span class="sd">    </span>
<span class="sd">    mode = 0:</span>
<span class="sd">      repetition = (MaxIterations - start)/self.autoset_N_FrequencySnapshots</span>
<span class="sd">    mode = 1:</span>
<span class="sd">      repetition = RepetitionFactor*period_max</span>
<span class="sd">    mode = 2:</span>
<span class="sd">      repetition = RepetitionFactor*ExcitationEndTimeMax</span>
<span class="sd">    mode = 3:</span>
<span class="sd">      repetition = biggest repetition between mode 1 and 2</span>
<span class="sd">      </span>
<span class="sd">    start = ExcitationEndTimeMax</span>
<span class="sd">    first = start + repetition</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getExcitations</span><span class="p">())</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;At least one excitation is required for automatic snapshot configuration.&#39;</span><span class="p">)</span>
    
    <span class="n">timestep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTimeStep</span><span class="p">()</span>
    
    <span class="n">Nstart</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ceil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getExcitationEndTimeMax</span><span class="p">()</span><span class="o">/</span><span class="n">timestep</span><span class="p">))</span>
    
    <span class="c1">############</span>
    <span class="c1">##### choose repetition value</span>
    
    <span class="c1"># fixed number of snapshots</span>
    <span class="n">repetition_0</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">floor</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">getIterations</span><span class="p">()</span> <span class="o">-</span> <span class="n">Nstart</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">autoset_N_FrequencySnapshots</span><span class="p">))</span>
    
    <span class="c1"># multiple of max period</span>
    <span class="n">period_max</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">getExcitationFrequencyMin</span><span class="p">()</span>
    <span class="n">repetition_1</span> <span class="o">=</span>  <span class="nb">int</span><span class="p">(</span><span class="n">ceil</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RepetitionFactor_MaxPeriod</span> <span class="o">*</span> <span class="n">period_max</span> <span class="o">/</span> <span class="n">timestep</span> <span class="p">))</span>
    
    <span class="c1"># multiple of excitation end time</span>
    <span class="n">repetition_2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ceil</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RepetitionFactor_ExcitationEndTime</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">getExcitationEndTimeMax</span><span class="p">()</span> <span class="o">/</span> <span class="n">timestep</span> <span class="p">))</span>
    
    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">repetition</span> <span class="o">=</span> <span class="n">repetition_0</span>
    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="n">repetition</span> <span class="o">=</span> <span class="n">repetition_1</span>
    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
      <span class="n">repetition</span> <span class="o">=</span> <span class="n">repetition_2</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">repetition</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">repetition_1</span><span class="p">,</span> <span class="n">repetition_2</span><span class="p">)</span>
      
    <span class="c1"># additional min limit</span>
    <span class="n">repetition</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">repetition</span><span class="p">,</span> <span class="mi">24</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
    <span class="c1">############</span>
    
    <span class="n">Nfirst</span> <span class="o">=</span> <span class="n">Nstart</span> <span class="o">+</span> <span class="n">repetition</span>
    <span class="n">Nsnaps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span> <span class="p">(</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getIterations</span><span class="p">()</span> <span class="o">-</span> <span class="n">Nfirst</span><span class="p">)</span> <span class="o">/</span> <span class="n">repetition</span> <span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">))</span>
    <span class="n">Nlast</span> <span class="o">=</span> <span class="n">Nstart</span> <span class="o">+</span> <span class="n">Nsnaps</span><span class="o">*</span><span class="n">repetition</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----------------------------------&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Nstart = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Nstart</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Nfirst = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Nfirst</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Nlast = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Nlast</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;repetition = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">repetition</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Nsnaps = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Nsnaps</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Niterations = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getIterations</span><span class="p">()))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----------------------------------&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;repetition_0 = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">repetition_0</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;repetition_1 = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">repetition_1</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;repetition_2 = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">repetition_2</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----------------------------------&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;t_start = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Nstart</span><span class="o">*</span><span class="n">timestep</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;t_first = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Nfirst</span><span class="o">*</span><span class="n">timestep</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;t_last = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Nlast</span><span class="o">*</span><span class="n">timestep</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;t_repetition = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">repetition</span><span class="o">*</span><span class="n">timestep</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;t_Niterations = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getIterations</span><span class="p">()</span><span class="o">*</span><span class="n">timestep</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----------------------------------&#39;</span><span class="p">)</span>
    
    <span class="c1"># configure frequency snapshots only</span>
    <span class="k">for</span> <span class="n">snap</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFrequencySnapshots</span><span class="p">():</span>
      <span class="n">snap</span><span class="o">.</span><span class="n">setStartingSample</span><span class="p">(</span><span class="n">Nstart</span><span class="p">)</span>
      <span class="n">snap</span><span class="o">.</span><span class="n">setFirst</span><span class="p">(</span><span class="n">Nfirst</span><span class="p">)</span>
      <span class="n">snap</span><span class="o">.</span><span class="n">setRepetition</span><span class="p">(</span><span class="n">repetition</span><span class="p">)</span>
    
    <span class="k">return</span></div>

<div class="viewcode-block" id="BFDTDobject.setDataPaths"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.setDataPaths">[docs]</a>  <span class="k">def</span> <span class="nf">setDataPaths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path_list</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dataPaths</span> <span class="o">=</span> <span class="n">path_list</span></div>

<div class="viewcode-block" id="BFDTDobject.getFlag"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getFlag">[docs]</a>  <span class="k">def</span> <span class="nf">getFlag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flag</span><span class="p">)</span></div>
<div class="viewcode-block" id="BFDTDobject.getBoundaries"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getBoundaries">[docs]</a>  <span class="k">def</span> <span class="nf">getBoundaries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaries</span><span class="p">)</span></div>

<div class="viewcode-block" id="BFDTDobject.getIdString"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getIdString">[docs]</a>  <span class="k">def</span> <span class="nf">getIdString</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getFlag</span><span class="p">()</span><span class="o">.</span><span class="n">getIdString</span><span class="p">())</span></div>
<div class="viewcode-block" id="BFDTDobject.setIdString"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.setIdString">[docs]</a>  <span class="k">def</span> <span class="nf">setIdString</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">id_string</span><span class="p">):</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getFlag</span><span class="p">()</span><span class="o">.</span><span class="n">setIdString</span><span class="p">(</span><span class="n">id_string</span><span class="p">))</span></div>

<div class="viewcode-block" id="BFDTDobject.add_arguments"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.add_arguments">[docs]</a>  <span class="k">def</span> <span class="nf">add_arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    .. todo:: implement</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1">#group_WritingSettings = parser.add_argument_group(&#39;GWL writing settings&#39;)</span>
    <span class="c1">#group_WritingSettings.add_argument(&quot;--set-lower-to-origin&quot;, help=&#39;offset structure so that its &quot;lower corner&quot; is moved to the (0,0,0) coordinates. This will make all coordinates positive.&#39;, action=&quot;store_true&quot;)</span>
    <span class="c1">#group_WritingSettings.add_argument(&quot;--write-power&quot;, help=&quot;Write power values using the power compensation (PC) parameters.&quot;, action=&quot;store_true&quot;)</span>
    <span class="c1">#group_WritingSettings.add_argument(&quot;--reverse_line_order_on_write&quot;, help=&quot;reverse line order on write&quot;, action=&quot;store_true&quot;)</span>
    <span class="c1">#group_WritingSettings.add_argument(&quot;--reverse_voxel_order_per_line_on_write&quot;, help=&quot;reverse voxel order per line on write&quot;, action=&quot;store_true&quot;)</span>

    <span class="c1">#group_PowerCompensation = parser.add_argument_group(&#39;GWL power compensation&#39;, &#39;LP(Z) = (1+K*(Z-interfaceAt))*LP(0) if bool_InverseWriting=False or LP(Z) = (1+K*((H-Z)+interfaceAt))*LP(0) if bool_InverseWriting=True&#39;) # TODO: nicely formatted help/description?</span>
    <span class="c1">#group_PowerCompensation.add_argument(&quot;--PC_laser_power_at_z0&quot;, help=&quot;PC: laser power at z0&quot;, type=float, default=100)</span>
    <span class="c1">#group_PowerCompensation.add_argument(&quot;--PC_slope&quot;, help=&quot;PC: power compensation slope&quot;, type=float, default=0)</span>
    <span class="c1">#group_PowerCompensation.add_argument(&quot;--PC_interfaceAt&quot;, help=&quot;PC: interface position&quot;, type=float, default=0)</span>
    <span class="c1">#group_PowerCompensation.add_argument(&quot;--PC_bool_InverseWriting&quot;, help=&quot;PC: To write a file designed for use with the InvertZAxis command&quot;, action=&quot;store_true&quot;, default=False)</span>
    <span class="c1">#group_PowerCompensation.add_argument(&quot;--PC_float_height&quot;, help=&#39;PC: &quot;substrate height&quot;, in practice just a value added to the interfaceAt value&#39;, type=float, default=0)</span>
    <span class="c1">#group_PowerCompensation.add_argument(&quot;--PC_bool_LaserPowerCommand&quot;, help=&quot;PC: Use the LaserPower command instead of a 4th coordinate for power.&quot;, action=&quot;store_true&quot;, default=False)</span>

    <span class="k">return</span></div>
    
<div class="viewcode-block" id="BFDTDobject.setAttributesFromParsedOptions"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.setAttributesFromParsedOptions">[docs]</a>  <span class="k">def</span> <span class="nf">setAttributesFromParsedOptions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Sets the object&#39;s attributes based on the ones from the *options* object (usually an argparse.ArgumentParser instance).</span>
<span class="sd">    </span>
<span class="sd">    See also: :py:func:`add_arguments`</span>
<span class="sd">    </span>
<span class="sd">    .. todo:: implement</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1">#self.set_lower_to_origin = options.set_lower_to_origin</span>
    <span class="c1">#self.write_power = options.write_power</span>
    <span class="c1">#self.reverse_line_order_on_write = options.reverse_line_order_on_write</span>
    <span class="c1">#self.reverse_voxel_order_per_line_on_write = options.reverse_voxel_order_per_line_on_write</span>
    <span class="c1">#self.PC_laser_power_at_z0 = options.PC_laser_power_at_z0</span>
    <span class="c1">#self.PC_slope = options.PC_slope</span>
    <span class="c1">#self.PC_interfaceAt = options.PC_interfaceAt</span>
    <span class="c1">#self.PC_bool_InverseWriting = options.PC_bool_InverseWriting</span>
    <span class="c1">#self.PC_float_height = options.PC_float_height</span>
    <span class="c1">#self.PC_bool_LaserPowerCommand = options.PC_bool_LaserPowerCommand</span>
    <span class="k">return</span></div>
    
<div class="viewcode-block" id="BFDTDobject.setVerbosity"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.setVerbosity">[docs]</a>  <span class="k">def</span> <span class="nf">setVerbosity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbosity</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">=</span> <span class="n">verbosity</span>
    <span class="k">return</span></div>
  
<div class="viewcode-block" id="BFDTDobject.setExecutable"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.setExecutable">[docs]</a>  <span class="k">def</span> <span class="nf">setExecutable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">BFDTD_executable</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">BFDTD_executable</span> <span class="o">=</span> <span class="n">BFDTD_executable</span></div>
<div class="viewcode-block" id="BFDTDobject.getExecutable"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getExecutable">[docs]</a>  <span class="k">def</span> <span class="nf">getExecutable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">BFDTD_executable</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="BFDTDobject.setFileBaseName"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.setFileBaseName">[docs]</a>  <span class="k">def</span> <span class="nf">setFileBaseName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileBaseName</span><span class="p">,</span> <span class="n">set_default_filelist</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fileBaseName</span> <span class="o">=</span> <span class="n">fileBaseName</span>
    <span class="k">if</span> <span class="n">set_default_filelist</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">fileList</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fileBaseName</span><span class="o">+</span><span class="s1">&#39;.inp&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileBaseName</span><span class="o">+</span><span class="s1">&#39;.geo&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="BFDTDobject.getFileBaseName"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getFileBaseName">[docs]</a>  <span class="k">def</span> <span class="nf">getFileBaseName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fileBaseName</span><span class="p">)</span></div>

<div class="viewcode-block" id="BFDTDobject.setWorkDir"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.setWorkDir">[docs]</a>  <span class="k">def</span> <span class="nf">setWorkDir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">WORKDIR</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">WORKDIR</span> <span class="o">=</span> <span class="n">WORKDIR</span></div>
  
<div class="viewcode-block" id="BFDTDobject.setWallTime"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.setWallTime">[docs]</a>  <span class="k">def</span> <span class="nf">setWallTime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">WALLTIME</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;set the walltime to use for torque job shellscripts&#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">WALLTIME</span> <span class="o">=</span> <span class="n">WALLTIME</span></div>

<div class="viewcode-block" id="BFDTDobject.getWallTime"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getWallTime">[docs]</a>  <span class="k">def</span> <span class="nf">getWallTime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;get the walltime to use for torque job shellscripts&#39;&#39;&#39;</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">WALLTIME</span><span class="p">)</span></div>
  
<div class="viewcode-block" id="BFDTDobject.set2D"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.set2D">[docs]</a>  <span class="k">def</span> <span class="nf">set2D</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">flag</span><span class="o">.</span><span class="n">set2D</span><span class="p">()</span></div>
<div class="viewcode-block" id="BFDTDobject.set3D"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.set3D">[docs]</a>  <span class="k">def</span> <span class="nf">set3D</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">flag</span><span class="o">.</span><span class="n">set3D</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="BFDTDobject.setBoundaryConditionsToPML"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.setBoundaryConditionsToPML">[docs]</a>  <span class="k">def</span> <span class="nf">setBoundaryConditionsToPML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number_of_layers</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">grading_index</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">min_reflection_coeff</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets all boundaries to PML.</span>
<span class="sd">    You can specify the thickness either directly in meters/micrometers/etc or as a number of layers.</span>
<span class="sd">    If *thickness* == None, *number_of_layers* will be used</span>
<span class="sd">    else *number_of_layers* will be set so that the specified *thickness* is obtained (even if *number_of_layers* is already specified!).</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">number_of_layers_Xpos</span> <span class="o">=</span> <span class="n">number_of_layers_Xneg</span> <span class="o">=</span> <span class="n">number_of_layers_Ypos</span> <span class="o">=</span> <span class="n">number_of_layers_Yneg</span> <span class="o">=</span> <span class="n">number_of_layers_Zpos</span> <span class="o">=</span> <span class="n">number_of_layers_Zneg</span> <span class="o">=</span> <span class="n">number_of_layers</span>

    <span class="k">if</span> <span class="n">thickness</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="p">(</span><span class="n">idx_Xneg</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="o">=</span> <span class="n">findNearestInSortedArray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">xmesh</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">xmesh</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">thickness</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
      <span class="p">(</span><span class="n">idx_Xpos</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="o">=</span> <span class="n">findNearestInSortedArray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">xmesh</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">xmesh</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">thickness</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
      <span class="n">number_of_layers_Xneg</span> <span class="o">=</span> <span class="n">idx_Xneg</span>
      <span class="n">number_of_layers_Xpos</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">xmesh</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="o">-</span> <span class="n">idx_Xpos</span>

      <span class="p">(</span><span class="n">idx_Yneg</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="o">=</span> <span class="n">findNearestInSortedArray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">ymesh</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">ymesh</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">thickness</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
      <span class="p">(</span><span class="n">idx_Ypos</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="o">=</span> <span class="n">findNearestInSortedArray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">ymesh</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">ymesh</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">thickness</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
      <span class="n">number_of_layers_Yneg</span> <span class="o">=</span> <span class="n">idx_Yneg</span>
      <span class="n">number_of_layers_Ypos</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">ymesh</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="o">-</span> <span class="n">idx_Ypos</span>

      <span class="p">(</span><span class="n">idx_Zneg</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="o">=</span> <span class="n">findNearestInSortedArray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">zmesh</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">zmesh</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">thickness</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
      <span class="p">(</span><span class="n">idx_Zpos</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="o">=</span> <span class="n">findNearestInSortedArray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">zmesh</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">zmesh</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">thickness</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
      <span class="n">number_of_layers_Zneg</span> <span class="o">=</span> <span class="n">idx_Zneg</span>
      <span class="n">number_of_layers_Zpos</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">zmesh</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="o">-</span> <span class="n">idx_Zpos</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">boundaries</span><span class="o">.</span><span class="n">setBoundaryConditionsXnegToPML</span><span class="p">(</span><span class="n">number_of_layers_Xneg</span><span class="p">,</span> <span class="n">grading_index</span><span class="p">,</span> <span class="n">min_reflection_coeff</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">boundaries</span><span class="o">.</span><span class="n">setBoundaryConditionsXposToPML</span><span class="p">(</span><span class="n">number_of_layers_Xpos</span><span class="p">,</span> <span class="n">grading_index</span><span class="p">,</span> <span class="n">min_reflection_coeff</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">boundaries</span><span class="o">.</span><span class="n">setBoundaryConditionsYnegToPML</span><span class="p">(</span><span class="n">number_of_layers_Yneg</span><span class="p">,</span> <span class="n">grading_index</span><span class="p">,</span> <span class="n">min_reflection_coeff</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">boundaries</span><span class="o">.</span><span class="n">setBoundaryConditionsYposToPML</span><span class="p">(</span><span class="n">number_of_layers_Ypos</span><span class="p">,</span> <span class="n">grading_index</span><span class="p">,</span> <span class="n">min_reflection_coeff</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">boundaries</span><span class="o">.</span><span class="n">setBoundaryConditionsZnegToPML</span><span class="p">(</span><span class="n">number_of_layers_Zneg</span><span class="p">,</span> <span class="n">grading_index</span><span class="p">,</span> <span class="n">min_reflection_coeff</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">boundaries</span><span class="o">.</span><span class="n">setBoundaryConditionsZposToPML</span><span class="p">(</span><span class="n">number_of_layers_Zpos</span><span class="p">,</span> <span class="n">grading_index</span><span class="p">,</span> <span class="n">min_reflection_coeff</span><span class="p">)</span></div>

<div class="viewcode-block" id="BFDTDobject.setTimeStepFactor"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.setTimeStepFactor">[docs]</a>  <span class="k">def</span> <span class="nf">setTimeStepFactor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeStepFactor</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">flag</span><span class="o">.</span><span class="n">setTimeStepFactor</span><span class="p">(</span><span class="n">timeStepFactor</span><span class="p">)</span></div>

<div class="viewcode-block" id="BFDTDobject.getTimeStepFactor"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getTimeStepFactor">[docs]</a>  <span class="k">def</span> <span class="nf">getTimeStepFactor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag</span><span class="o">.</span><span class="n">getTimeStepFactor</span><span class="p">()</span></div>

<div class="viewcode-block" id="BFDTDobject.getTimeStepMax"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getTimeStepMax">[docs]</a>  <span class="k">def</span> <span class="nf">getTimeStepMax</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the maxmimum acceptable timestep for stable simulations defined by::</span>
<span class="sd">    </span>
<span class="sd">      timeStepMax = 1/(c0*sqrt(1/dx^2+1/dy^2+1/dz^2))</span>
<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="p">(</span><span class="n">dx</span><span class="p">,</span><span class="n">dy</span><span class="p">,</span><span class="n">dz</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">getMinDeltas</span><span class="p">()</span>
    <span class="n">timeStepMax</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">get_c0</span><span class="p">()</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="o">/</span><span class="n">dy</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="o">/</span><span class="n">dz</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">return</span><span class="p">(</span><span class="n">timeStepMax</span><span class="p">)</span></div>

<div class="viewcode-block" id="BFDTDobject.getTimeStep"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getTimeStep">[docs]</a>  <span class="k">def</span> <span class="nf">getTimeStep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the timestep in:</span>
<span class="sd">    </span>
<span class="sd">      * seconds if dimensions are in meters</span>
<span class="sd">      * microseconds if dimensions are in micrometers</span>
<span class="sd">      * etc</span>
<span class="sd">    </span>
<span class="sd">    The simulation timestep is given by::</span>
<span class="sd">    </span>
<span class="sd">      timeStep = timeStepFactor/(c0*sqrt(1/dx^2+1/dy^2+1/dz^2))</span>
<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1">#(dx,dy,dz) = self.mesh.getMinDeltas()</span>
    <span class="c1">#timeStep = self.flag.timeStepFactor/(get_c0()*sqrt(1/dx**2+1/dy**2+1/dz**2))</span>
    <span class="n">timeStep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag</span><span class="o">.</span><span class="n">timeStepFactor</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">getTimeStepMax</span><span class="p">()</span>
    <span class="k">return</span><span class="p">(</span><span class="n">timeStep</span><span class="p">)</span></div>
  
<div class="viewcode-block" id="BFDTDobject.setTimeStep"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.setTimeStep">[docs]</a>  <span class="k">def</span> <span class="nf">setTimeStep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeStep</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Sets the timestep to *timeStep* indirectly by setting the timeStepFactor.&#39;&#39;&#39;</span>
    <span class="c1">#(dx,dy,dz) = self.mesh.getMinDeltas()</span>
    <span class="c1">#self.flag.setTimeStepFactor( timeStep*(get_c0()*sqrt(1/dx**2+1/dy**2+1/dz**2)) )</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">flag</span><span class="o">.</span><span class="n">setTimeStepFactor</span><span class="p">(</span> <span class="n">timeStep</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">getTimeStepMax</span><span class="p">()</span> <span class="p">)</span>
    <span class="k">return</span></div>
  
<div class="viewcode-block" id="BFDTDobject.setIterations"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.setIterations">[docs]</a>  <span class="k">def</span> <span class="nf">setIterations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterations</span><span class="p">,</span> <span class="n">AfterSources</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the number of iterations.</span>
<span class="sd">    If AfterSources=True, the number of iterations is set so that all sources finish running and then adds **iterations** iterations after that.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">AfterSources</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">setSimulationTime</span><span class="p">()</span>
      <span class="n">Nmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getIterations</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">flag</span><span class="o">.</span><span class="n">setIterations</span><span class="p">(</span><span class="n">Nmin</span> <span class="o">+</span> <span class="n">iterations</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">flag</span><span class="o">.</span><span class="n">setIterations</span><span class="p">(</span><span class="n">iterations</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getIterations</span><span class="p">()</span></div>

<div class="viewcode-block" id="BFDTDobject.getIterations"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getIterations">[docs]</a>  <span class="k">def</span> <span class="nf">getIterations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Returns the number of iterations.&#39;&#39;&#39;</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flag</span><span class="o">.</span><span class="n">getIterations</span><span class="p">())</span></div>

<div class="viewcode-block" id="BFDTDobject.setSimulationTime"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.setSimulationTime">[docs]</a>  <span class="k">def</span> <span class="nf">setSimulationTime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maxtime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">AfterSources</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the number of iterations to ceil(maxtime/timestep).</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">maxtime</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">setIterations</span><span class="p">(</span><span class="n">ceil</span><span class="p">(</span><span class="n">maxtime</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">getTimeStep</span><span class="p">()))</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getExcitations</span><span class="p">())</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;WARNING: No excitation specified. Adding default excitation.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addDefaultExcitation</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">setSimulationTime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getExcitationEndTimeMax</span><span class="p">())</span></div>

<div class="viewcode-block" id="BFDTDobject.addDefaultExcitation"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.addDefaultExcitation">[docs]</a>  <span class="k">def</span> <span class="nf">addDefaultExcitation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Simply adds a default excitation centered in the simulation box, of excitation_size = box_size/10.&#39;&#39;&#39;</span>
    <span class="n">default_excitation</span> <span class="o">=</span> <span class="n">Excitation</span><span class="p">()</span>
    <span class="n">default_excitation</span><span class="o">.</span><span class="n">setCentro</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getCentro</span><span class="p">())</span>
    <span class="n">default_excitation</span><span class="o">.</span><span class="n">setSize</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">getSize</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">appendExcitation</span><span class="p">(</span><span class="n">default_excitation</span><span class="p">)</span></div>

<div class="viewcode-block" id="BFDTDobject.getSimulationTime"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getSimulationTime">[docs]</a>  <span class="k">def</span> <span class="nf">getSimulationTime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Returns the total simulation time based on the mesh and the number of iterations.</span>
<span class="sd">    </span>
<span class="sd">    .. todo:: Implement parsing of BFDTD output to give the current simulation time (and eventually progress bar).</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getIterations</span><span class="p">()</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">getTimeStep</span><span class="p">()</span></div>

<div class="viewcode-block" id="BFDTDobject.appendExcitation"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.appendExcitation">[docs]</a>  <span class="k">def</span> <span class="nf">appendExcitation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">excitation</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Add one or more Excitation objects to the simulation.</span>

<span class="sd">    :param obj: Excitation or list of Excitation instances</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">excitation</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">excitation_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">excitation</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">excitation_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">excitation</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">excitation</span><span class="p">)</span></div>

<div class="viewcode-block" id="BFDTDobject.appendGeometryObject"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.appendGeometryObject">[docs]</a>  <span class="k">def</span> <span class="nf">appendGeometryObject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Add one or more geometry objects to the simulation.</span>

<span class="sd">    :param obj: GeometryObject or list of GeometryObject instances</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">geometry_object_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">geometry_object_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span></div>

<div class="viewcode-block" id="BFDTDobject.appendSnapshot"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.appendSnapshot">[docs]</a>  <span class="k">def</span> <span class="nf">appendSnapshot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Add one or more snapshot objects to the simulation.</span>

<span class="sd">    :param obj: Snapshot or list of Snapshot instances</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">snapshot_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">snapshot_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span></div>

<div class="viewcode-block" id="BFDTDobject.appendProbe"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.appendProbe">[docs]</a>  <span class="k">def</span> <span class="nf">appendProbe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Add one or more Probe objects to the simulation.</span>

<span class="sd">    :param obj: Probe or list of Probe instances</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">probe_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">probe_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span></div>

<div class="viewcode-block" id="BFDTDobject.setSizeAndResolution"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.setSizeAndResolution">[docs]</a>  <span class="k">def</span> <span class="nf">setSizeAndResolution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size_vec3</span><span class="p">,</span> <span class="n">N_vec3</span><span class="p">,</span> <span class="n">Ncells_per_unit</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the size and resolution (number of cells in the x,y and z directions) of the simulation.</span>
<span class="sd">    </span>
<span class="sd">    See also: :py:func:`bfdtd.meshobject.MeshObject.setSizeAndResolution`</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">setExtension</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">size_vec3</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">setSizeAndResolution</span><span class="p">(</span><span class="n">size_vec3</span><span class="p">,</span> <span class="n">N_vec3</span><span class="p">,</span> <span class="n">Ncells_per_unit</span><span class="p">)</span></div>

<div class="viewcode-block" id="BFDTDobject.getSizeAndResolution"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getSizeAndResolution">[docs]</a>  <span class="k">def</span> <span class="nf">getSizeAndResolution</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMesh</span><span class="p">()</span><span class="o">.</span><span class="n">getSizeAndResolution</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="BFDTDobject.getBox"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getBox">[docs]</a>  <span class="k">def</span> <span class="nf">getBox</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">box</span></div>

<div class="viewcode-block" id="BFDTDobject.getSize"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getSize">[docs]</a>  <span class="k">def</span> <span class="nf">getSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getBox</span><span class="p">()</span><span class="o">.</span><span class="n">getSize</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="BFDTDobject.getExtension"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getExtension">[docs]</a>  <span class="k">def</span> <span class="nf">getExtension</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getBox</span><span class="p">()</span><span class="o">.</span><span class="n">getExtension</span><span class="p">()</span></div>

<div class="viewcode-block" id="BFDTDobject.getLower"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getLower">[docs]</a>  <span class="k">def</span> <span class="nf">getLower</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getBox</span><span class="p">()</span><span class="o">.</span><span class="n">getLower</span><span class="p">()</span></div>

<div class="viewcode-block" id="BFDTDobject.getUpper"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getUpper">[docs]</a>  <span class="k">def</span> <span class="nf">getUpper</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getBox</span><span class="p">()</span><span class="o">.</span><span class="n">getUpper</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="BFDTDobject.printInfo"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.printInfo">[docs]</a>  <span class="k">def</span> <span class="nf">printInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">timestep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTimeStep</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Ncells = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getNcells</span><span class="p">()))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Iterations = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getIterations</span><span class="p">()))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;SimulationTime = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getSimulationTime</span><span class="p">()))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;TimeStep = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getTimeStep</span><span class="p">()))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;StartTimeMin = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getExcitationStartTimeMin</span><span class="p">()))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;EndTimeMax = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getExcitationEndTimeMax</span><span class="p">()))</span>
    
    <span class="n">iter_start</span> <span class="o">=</span> <span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getExcitationStartTimeMin</span><span class="p">()</span><span class="o">/</span><span class="n">timestep</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">iter_start</span><span class="p">):</span>
      <span class="n">iter_start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">iter_start</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;StartTimeMin/timestep = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">iter_start</span><span class="p">))</span>

    <span class="n">iter_end</span> <span class="o">=</span> <span class="n">ceil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getExcitationEndTimeMax</span><span class="p">()</span><span class="o">/</span><span class="n">timestep</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">iter_end</span><span class="p">):</span>
      <span class="n">iter_end</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">iter_end</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;EndTimeMax/timestep = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">iter_end</span> <span class="p">))</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;probes:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getProbes</span><span class="p">()))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;frequency snapshots:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getFrequencySnapshots</span><span class="p">(</span><span class="n">split</span><span class="o">=</span><span class="kc">True</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;time snapshots:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getTimeSnapshots</span><span class="p">()))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;epsilonSnapshot:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getEpsilonSnapshots</span><span class="p">(</span><span class="n">split</span><span class="o">=</span><span class="kc">True</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;mode filtered probes:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getModeFilteredProbes</span><span class="p">()))</span></div>
    
  <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="n">ret</span> <span class="o">=</span> <span class="s1">&#39;---&gt;snapshot_list</span><span class="se">\n</span><span class="s1">&#39;</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapshot_list</span><span class="p">)):</span>
          <span class="n">ret</span> <span class="o">+=</span> <span class="s1">&#39;--&gt;snapshot &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;:</span><span class="se">\n</span><span class="s1">&#39;</span>
          <span class="n">ret</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapshot_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

      <span class="n">ret</span> <span class="o">+=</span> <span class="s1">&#39;---&gt;time_snapshot_list</span><span class="se">\n</span><span class="s1">&#39;</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_snapshot_list</span><span class="p">)):</span>
          <span class="n">ret</span> <span class="o">+=</span> <span class="s1">&#39;--&gt;time_snapshot &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;:</span><span class="se">\n</span><span class="s1">&#39;</span>
          <span class="n">ret</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_snapshot_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

      <span class="n">ret</span> <span class="o">+=</span> <span class="s1">&#39;---&gt;frequency_snapshot_list</span><span class="se">\n</span><span class="s1">&#39;</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_snapshot_list</span><span class="p">)):</span>
          <span class="n">ret</span> <span class="o">+=</span> <span class="s1">&#39;--&gt;frequency_snapshot &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;:</span><span class="se">\n</span><span class="s1">&#39;</span>
          <span class="n">ret</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_snapshot_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

      <span class="n">ret</span> <span class="o">+=</span> <span class="s1">&#39;---&gt;excitation_list</span><span class="se">\n</span><span class="s1">&#39;</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">excitation_list</span><span class="p">)):</span>
          <span class="n">ret</span> <span class="o">+=</span> <span class="s1">&#39;--&gt;excitation &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;:</span><span class="se">\n</span><span class="s1">&#39;</span>
          <span class="n">ret</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">excitation_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
      
      <span class="n">ret</span> <span class="o">+=</span> <span class="s1">&#39;---&gt;delta_X_vector</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">getXmeshDelta</span><span class="p">()</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span>\
      <span class="s1">&#39;---&gt;delta_Y_vector</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">getYmeshDelta</span><span class="p">()</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span>\
      <span class="s1">&#39;---&gt;delta_Z_vector</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">getZmeshDelta</span><span class="p">()</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span>\
      <span class="s1">&#39;---&gt;flag</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">flag</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span>\
      <span class="s1">&#39;---&gt;boundaries</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaries</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span>\
      <span class="s1">&#39;---&gt;box</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
      
      <span class="n">ret</span> <span class="o">+=</span> <span class="s1">&#39;---&gt;probe_list</span><span class="se">\n</span><span class="s1">&#39;</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">probe_list</span><span class="p">)):</span>
          <span class="n">ret</span> <span class="o">+=</span> <span class="s1">&#39;--&gt;probe &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;:</span><span class="se">\n</span><span class="s1">&#39;</span>
          <span class="n">ret</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">probe_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

      <span class="n">ret</span> <span class="o">+=</span> <span class="s1">&#39;---&gt;sphere_list</span><span class="se">\n</span><span class="s1">&#39;</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sphere_list</span><span class="p">)):</span>
          <span class="n">ret</span> <span class="o">+=</span> <span class="s1">&#39;--&gt;sphere &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;:</span><span class="se">\n</span><span class="s1">&#39;</span>
          <span class="n">ret</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sphere_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
      
      <span class="n">ret</span> <span class="o">+=</span> <span class="s1">&#39;---&gt;block_list</span><span class="se">\n</span><span class="s1">&#39;</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block_list</span><span class="p">)):</span>
          <span class="n">ret</span> <span class="o">+=</span> <span class="s1">&#39;--&gt;block &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;:</span><span class="se">\n</span><span class="s1">&#39;</span>
          <span class="n">ret</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

      <span class="n">ret</span> <span class="o">+=</span> <span class="s1">&#39;---&gt;distorted_list</span><span class="se">\n</span><span class="s1">&#39;</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">distorted_list</span><span class="p">)):</span>
          <span class="n">ret</span> <span class="o">+=</span> <span class="s1">&#39;--&gt;distorted &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;:</span><span class="se">\n</span><span class="s1">&#39;</span>
          <span class="n">ret</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distorted_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

      <span class="n">ret</span> <span class="o">+=</span> <span class="s1">&#39;---&gt;cylinder_list</span><span class="se">\n</span><span class="s1">&#39;</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cylinder_list</span><span class="p">)):</span>
          <span class="n">ret</span> <span class="o">+=</span> <span class="s1">&#39;--&gt;cylinder &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;:</span><span class="se">\n</span><span class="s1">&#39;</span>
          <span class="n">ret</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cylinder_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

      <span class="n">ret</span> <span class="o">+=</span> <span class="s1">&#39;---&gt;global_rotation_list</span><span class="se">\n</span><span class="s1">&#39;</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_rotation_list</span><span class="p">)):</span>
          <span class="c1"># ret += &#39;\n&#39;</span>
          <span class="n">ret</span> <span class="o">+=</span> <span class="s1">&#39;--&gt;rotation &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;:</span><span class="se">\n</span><span class="s1">&#39;</span>
          <span class="n">ret</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_rotation_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

      <span class="n">ret</span> <span class="o">+=</span> <span class="s1">&#39;---&gt;geometry_object_list</span><span class="se">\n</span><span class="s1">&#39;</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry_object_list</span><span class="p">)):</span>
          <span class="n">ret</span> <span class="o">+=</span> <span class="s1">&#39;--&gt;geometry_object &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;:</span><span class="se">\n</span><span class="s1">&#39;</span>
          <span class="n">ret</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry_object_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
          
      <span class="k">return</span> <span class="n">ret</span>
  
<div class="viewcode-block" id="BFDTDobject.getCentro"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getCentro">[docs]</a>  <span class="k">def</span> <span class="nf">getCentro</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">getCentro</span><span class="p">()</span></div>
  
<div class="viewcode-block" id="BFDTDobject.getNcells"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getNcells">[docs]</a>  <span class="k">def</span> <span class="nf">getNcells</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">getNcells</span><span class="p">()</span></div>

  <span class="c1">##############</span>
  <span class="c1"># backfill/default material related functions</span>
<div class="viewcode-block" id="BFDTDobject.setDefaultRefractiveIndex"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.setDefaultRefractiveIndex">[docs]</a>  <span class="k">def</span> <span class="nf">setDefaultRefractiveIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">default_permittivity</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span></div>

<div class="viewcode-block" id="BFDTDobject.getDefaultRefractiveIndex"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getDefaultRefractiveIndex">[docs]</a>  <span class="k">def</span> <span class="nf">getDefaultRefractiveIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_permittivity</span><span class="p">)</span></div>

<div class="viewcode-block" id="BFDTDobject.setDefaultRelativePermittivity"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.setDefaultRelativePermittivity">[docs]</a>  <span class="k">def</span> <span class="nf">setDefaultRelativePermittivity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">permittivity</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">default_permittivity</span> <span class="o">=</span> <span class="n">permittivity</span></div>

<div class="viewcode-block" id="BFDTDobject.setDefaultRelativeConductivity"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.setDefaultRelativeConductivity">[docs]</a>  <span class="k">def</span> <span class="nf">setDefaultRelativeConductivity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conductivity</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">default_conductivity</span> <span class="o">=</span> <span class="n">conductivity</span></div>

<div class="viewcode-block" id="BFDTDobject.getDefaultRelativePermittivity"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getDefaultRelativePermittivity">[docs]</a>  <span class="k">def</span> <span class="nf">getDefaultRelativePermittivity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_permittivity</span><span class="p">)</span></div>

<div class="viewcode-block" id="BFDTDobject.getDefaultRelativeConductivity"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getDefaultRelativeConductivity">[docs]</a>  <span class="k">def</span> <span class="nf">getDefaultRelativeConductivity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_conductivity</span><span class="p">)</span></div>
  <span class="c1">##############</span>

<div class="viewcode-block" id="BFDTDobject.addCentralXYZSnapshots"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.addCentralXYZSnapshots">[docs]</a>  <span class="k">def</span> <span class="nf">addCentralXYZSnapshots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">freqlist</span><span class="p">,</span> <span class="n">withEpsilon</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">freqlist</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">addFrequencySnapshot</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">location</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">frequency_list</span><span class="o">=</span><span class="p">[</span><span class="n">f</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Central X snapshot for f=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">addFrequencySnapshot</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="n">location</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">frequency_list</span><span class="o">=</span><span class="p">[</span><span class="n">f</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Central Y snapshot for f=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">addFrequencySnapshot</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="n">location</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">frequency_list</span><span class="o">=</span><span class="p">[</span><span class="n">f</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Central Z snapshot for f=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">withEpsilon</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">addEpsilonSnapshot</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">location</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">addEpsilonSnapshot</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="n">location</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">addEpsilonSnapshot</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="n">location</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
      
    <span class="k">return</span></div>

<div class="viewcode-block" id="BFDTDobject.addBoxFrequencySnapshots"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.addBoxFrequencySnapshots">[docs]</a>  <span class="k">def</span> <span class="nf">addBoxFrequencySnapshots</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This should be called after the box and mesh have been defined. Else the box size might be incorrect.</span>
<span class="sd">    </span>
<span class="sd">    Returns the &quot;base snapshot&quot;.</span>
<span class="sd">    </span>
<span class="sd">    .. todo:: Upgrade using new snapshot system? (and what does a normal snapshot do now when L,U forms a box...?)</span>
<span class="sd">    .. todo:: Add SnapshotBoxSurfaceFull ? (or a &quot;full extension&quot; boolean like for Snapshot?)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1">#L = [self.box.lower[0], self.box.lower[1], self.box.lower[2]]</span>
    <span class="c1">#U = [self.box.upper[0], self.box.upper[1], self.box.upper[2]]</span>
    <span class="c1">#F = FrequencySnapshot()</span>
    <span class="c1">#F.setName(&#39;Box frequency snapshot&#39;)</span>
    <span class="c1">#F.setExtension(L,U)</span>
    <span class="c1">#self.snapshot_list.append(F)</span>
    
    <span class="n">F</span> <span class="o">=</span> <span class="n">FrequencySnapshot</span><span class="p">()</span>
    <span class="n">F</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="s1">&#39;Box frequency snapshot&#39;</span><span class="p">)</span>
    <span class="n">fbox</span> <span class="o">=</span> <span class="n">SnapshotBoxSurface</span><span class="p">()</span>
    <span class="n">fbox</span><span class="o">.</span><span class="n">setBaseSnapshot</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
    <span class="n">fbox</span><span class="o">.</span><span class="n">setExtension</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">getExtension</span><span class="p">())</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">appendSnapshot</span><span class="p">(</span><span class="n">fbox</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fbox</span><span class="o">.</span><span class="n">getBaseSnapshot</span><span class="p">()</span></div>

<div class="viewcode-block" id="BFDTDobject.addEpsilonBox"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.addEpsilonBox">[docs]</a>  <span class="k">def</span> <span class="nf">addEpsilonBox</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">eps</span> <span class="o">=</span> <span class="n">EpsilonBoxFull</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">appendSnapshot</span><span class="p">(</span><span class="n">eps</span><span class="p">)</span></div>

<div class="viewcode-block" id="BFDTDobject.addSnapshot"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.addSnapshot">[docs]</a>  <span class="k">def</span> <span class="nf">addSnapshot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">snapshot_class</span><span class="p">,</span> <span class="n">plane</span><span class="p">,</span> <span class="n">position_input</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Adds a snapshot of class &quot;snapshot_class&quot;.</span>
<span class="sd">    </span>
<span class="sd">    :param snapshot_class: One of the snapshot classes or a custom snapshot class derived from them.</span>
<span class="sd">    :param plane: &#39;x&#39;, &#39;y&#39; or &#39;z&#39;</span>
<span class="sd">    :param position_input: float or list/array of size 3</span>
<span class="sd">    :param name: Name of the snapshot to add. If None, will be set to a string of the form &quot;X/Y/Z snapshot_class.__name__&quot;</span>

<span class="sd">    .. todo:: use x,y,z or vectors wherever possible instead of 1,2,3/0,1,2 to avoid confusion DONE?</span>
<span class="sd">    .. todo:: support multiple types for position argument (int/float or array) DONE?</span>
<span class="sd">    .. todo:: Create function to readapt size of snapshots to sim box? Or fit them when writing out the files? Maybe store only their orientation and position?</span>
<span class="sd">    .. todo:: Create equivalent of addObject for .in and .inp files? or addProbe, addSnapshot, etc?</span>
<span class="sd">    .. todo:: create generic plane adding function and call it from the specific functions</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="c1"># Forcing switch to x,y,z by exiting on numeric indices.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">plane</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
      <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Plane argument should be of type </span><span class="se">\&#39;</span><span class="s1">str</span><span class="se">\&#39;</span><span class="s1">, but is of type </span><span class="si">{}</span><span class="se">\n</span><span class="s1">If you are still using numeric indices (0,1,2 or 1,2,3), please switch to letter indices: </span><span class="se">\&#39;</span><span class="s1">x</span><span class="se">\&#39;</span><span class="s1">,</span><span class="se">\&#39;</span><span class="s1">y</span><span class="se">\&#39;</span><span class="s1">,</span><span class="se">\&#39;</span><span class="s1">z</span><span class="se">\&#39;</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">position_input</span><span class="p">)))</span>

    <span class="c1"># force lower case</span>
    <span class="n">plane</span> <span class="o">=</span> <span class="n">plane</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">plane</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">]:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;ERROR: Invalid plane value. plane must be </span><span class="se">\&#39;</span><span class="s1">x</span><span class="se">\&#39;</span><span class="s1">,</span><span class="se">\&#39;</span><span class="s1">y</span><span class="se">\&#39;</span><span class="s1"> or </span><span class="se">\&#39;</span><span class="s1">z</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">)</span>
    
    <span class="c1"># determine position</span>
    <span class="n">position</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">position_input</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">position_input</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
      <span class="n">position</span> <span class="o">=</span> <span class="n">position_input</span><span class="p">[[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">plane</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">position</span> <span class="o">=</span> <span class="n">position_input</span>
      
    <span class="c1"># data type check</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">position</span><span class="p">,</span><span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">position</span><span class="p">,</span><span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int64</span><span class="p">):</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;ERROR: position argument is not int or float, but is </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">position</span><span class="p">)))</span>
    
    <span class="c1">#vec, alpha = getVecAlphaDirectionFromVar(plane)</span>
    <span class="k">if</span> <span class="n">plane</span> <span class="o">==</span> <span class="s1">&#39;x&#39;</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;X &#39;</span><span class="o">+</span><span class="n">snapshot_class</span><span class="o">.</span><span class="vm">__name__</span>
      <span class="n">L</span> <span class="o">=</span> <span class="p">[</span><span class="n">position</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">lower</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">lower</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
      <span class="n">U</span> <span class="o">=</span> <span class="p">[</span><span class="n">position</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">upper</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">upper</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
    <span class="k">elif</span> <span class="n">plane</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Y &#39;</span><span class="o">+</span><span class="n">snapshot_class</span><span class="o">.</span><span class="vm">__name__</span>
      <span class="n">L</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">lower</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">position</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">lower</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
      <span class="n">U</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">upper</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">position</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">upper</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
    <span class="k">elif</span> <span class="n">plane</span> <span class="o">==</span> <span class="s1">&#39;z&#39;</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Z &#39;</span><span class="o">+</span><span class="n">snapshot_class</span><span class="o">.</span><span class="vm">__name__</span>
      <span class="n">L</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">lower</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">lower</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">position</span><span class="p">]</span>
      <span class="n">U</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">upper</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">upper</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">position</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;ERROR: Invalid plane : </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">plane</span><span class="p">))</span>
    
    <span class="n">S</span> <span class="o">=</span> <span class="n">snapshot_class</span><span class="p">()</span>
    <span class="n">S</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="n">S</span><span class="o">.</span><span class="n">plane</span> <span class="o">=</span> <span class="n">plane</span>
    <span class="n">S</span><span class="o">.</span><span class="n">P1</span> <span class="o">=</span> <span class="n">L</span>
    <span class="n">S</span><span class="o">.</span><span class="n">P2</span> <span class="o">=</span> <span class="n">U</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">snapshot_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">S</span></div>
  
<div class="viewcode-block" id="BFDTDobject.addFrequencySnapshot"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.addFrequencySnapshot">[docs]</a>  <span class="k">def</span> <span class="nf">addFrequencySnapshot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plane</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">frequency_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Add a frequency snapshot.</span>
<span class="sd">    </span>
<span class="sd">    :param plane: The X, Y or Z plane.</span>
<span class="sd">    :param position: the X, Y or Z (depending on the value of *plane*) position or simply a set of 3D coordinates (ex:``[5.3, 6.4, 7.6]``).</span>
<span class="sd">    :type position: float or list/array of size 3</span>
<span class="sd">    :param frequency_list: a list of frequencies</span>
<span class="sd">    :type frequency_list: a list of floats (ex: [1.2, 2.3, 3.4])</span>
<span class="sd">    :param string name: string</span>
<span class="sd">    </span>
<span class="sd">    See also: :py:func:`addSnapshot`</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">F</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addSnapshot</span><span class="p">(</span><span class="n">FrequencySnapshot</span><span class="p">,</span> <span class="n">plane</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
    <span class="n">F</span><span class="o">.</span><span class="n">setFrequencies</span><span class="p">(</span><span class="n">frequency_list</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">F</span><span class="p">)</span></div>
  
<div class="viewcode-block" id="BFDTDobject.addTimeSnapshot"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.addTimeSnapshot">[docs]</a>  <span class="k">def</span> <span class="nf">addTimeSnapshot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plane</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">addSnapshot</span><span class="p">(</span><span class="n">TimeSnapshot</span><span class="p">,</span> <span class="n">plane</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="BFDTDobject.addModeFilteredProbe"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.addModeFilteredProbe">[docs]</a>  <span class="k">def</span> <span class="nf">addModeFilteredProbe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plane</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">addSnapshot</span><span class="p">(</span><span class="n">ModeFilteredProbe</span><span class="p">,</span> <span class="n">plane</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="BFDTDobject.addEpsilonSnapshot"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.addEpsilonSnapshot">[docs]</a>  <span class="k">def</span> <span class="nf">addEpsilonSnapshot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plane</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">eps_snapshot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addSnapshot</span><span class="p">(</span><span class="n">EpsilonSnapshot</span><span class="p">,</span> <span class="n">plane</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
    <span class="c1"># We set repetition to the max iteration number, so that only one epsilon snapshot is generated.</span>
    <span class="n">eps_snapshot</span><span class="o">.</span><span class="n">repetition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getIterations</span><span class="p">()</span>
    <span class="n">eps_snapshot</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">eps_snapshot</span></div>

<div class="viewcode-block" id="BFDTDobject.clearTimeSnapshots"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.clearTimeSnapshots">[docs]</a>  <span class="k">def</span> <span class="nf">clearTimeSnapshots</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Remove all time snapshots.</span>
<span class="sd">    </span>
<span class="sd">    .. todo:: Should distinguish time snapshots based on their attributes?</span>
<span class="sd">    .. todo:: Some &quot;sorting&quot; function should be created to sort snapshots based on their attributes? And could be used on import. -&gt; Beware feature creep!!!</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">snapshot_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapshot_list</span> <span class="k">if</span> <span class="p">(</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">TimeSnapshot</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">EpsilonSnapshot</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">ModeFilteredProbe</span><span class="p">)</span> <span class="p">)</span> <span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">time_snapshot_list</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="BFDTDobject.clearFrequencySnapshots"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.clearFrequencySnapshots">[docs]</a>  <span class="k">def</span> <span class="nf">clearFrequencySnapshots</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Remove all frequency snapshots.&#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">snapshot_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapshot_list</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">FrequencySnapshot</span><span class="p">)</span> <span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">frequency_snapshot_list</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="BFDTDobject.clearEpsilonSnapshots"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.clearEpsilonSnapshots">[docs]</a>  <span class="k">def</span> <span class="nf">clearEpsilonSnapshots</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Remove all epsilon snapshots.&#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">snapshot_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapshot_list</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">EpsilonSnapshot</span><span class="p">)</span> <span class="p">]</span></div>

<div class="viewcode-block" id="BFDTDobject.clearModeFilteredProbes"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.clearModeFilteredProbes">[docs]</a>  <span class="k">def</span> <span class="nf">clearModeFilteredProbes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Remove all &quot;mode filtered probe&quot; snapshots.&#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">snapshot_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapshot_list</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">ModeFilteredProbe</span><span class="p">)</span> <span class="p">]</span></div>

<div class="viewcode-block" id="BFDTDobject.clearAllSnapshots"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.clearAllSnapshots">[docs]</a>  <span class="k">def</span> <span class="nf">clearAllSnapshots</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Remove all snapshots (time, frequency, etc).&#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">snapshot_list</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">time_snapshot_list</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">frequency_snapshot_list</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="BFDTDobject.clearProbes"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.clearProbes">[docs]</a>  <span class="k">def</span> <span class="nf">clearProbes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Clear the list of probes.&#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">probe_list</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="BFDTDobject.clearGeometry"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.clearGeometry">[docs]</a>  <span class="k">def</span> <span class="nf">clearGeometry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Clear the list of geometry objects.&#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">geometry_object_list</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="BFDTDobject.clearExcitationList"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.clearExcitationList">[docs]</a>  <span class="k">def</span> <span class="nf">clearExcitationList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Clear the list of Excitation objects.&#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">excitation_list</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="BFDTDobject.clearFileList"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.clearFileList">[docs]</a>  <span class="k">def</span> <span class="nf">clearFileList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Clears the filelist. &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fileList</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="BFDTDobject.getFileList"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getFileList">[docs]</a>  <span class="k">def</span> <span class="nf">getFileList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fileList</span><span class="p">)</span></div>

<div class="viewcode-block" id="BFDTDobject.setFileList"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.setFileList">[docs]</a>  <span class="k">def</span> <span class="nf">setFileList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileList</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the filelist.</span>
<span class="sd">    ..todo:: appendFileList()? (but make sure always a single box in geo file and that it is at the end)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fileList</span> <span class="o">=</span> <span class="n">fileList</span>
    <span class="k">return</span><span class="p">(</span><span class="n">fileList</span><span class="p">)</span></div>

<div class="viewcode-block" id="BFDTDobject.getObjects"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getObjects">[docs]</a>  <span class="k">def</span> <span class="nf">getObjects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Returns the list of excitations and geometry objects.&#39;&#39;&#39;</span>    
    <span class="n">object_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">object_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getExcitations</span><span class="p">())</span>
    <span class="n">object_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getGeometryObjects</span><span class="p">())</span>
    <span class="c1">#object_list.extend(self.getProbes())</span>
    <span class="k">return</span> <span class="n">object_list</span></div>

<div class="viewcode-block" id="BFDTDobject.getGeometryObjects"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getGeometryObjects">[docs]</a>  <span class="k">def</span> <span class="nf">getGeometryObjects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Returns the list of geometry objects.&#39;&#39;&#39;</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry_object_list</span><span class="p">)</span></div>

<div class="viewcode-block" id="BFDTDobject.setGeometryObjects"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.setGeometryObjects">[docs]</a>  <span class="k">def</span> <span class="nf">setGeometryObjects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geometry_object_list</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Returns the list of geometry objects.&#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">geometry_object_list</span> <span class="o">=</span> <span class="n">geometry_object_list</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry_object_list</span><span class="p">)</span></div>

<div class="viewcode-block" id="BFDTDobject.getGeometryObjectsByName"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getGeometryObjectsByName">[docs]</a>  <span class="k">def</span> <span class="nf">getGeometryObjectsByName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Returns the list of geometry objects matching the name **name**.</span>
<span class="sd">    </span>
<span class="sd">    :param name: string (ex: ``&#39;defect&#39;``)</span>
<span class="sd">    </span>
<span class="sd">    .. todo:: case-insensitive matching, regex matching, globbing and/or partial matching</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="p">[</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry_object_list</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="n">name</span> <span class="p">]</span></div>
    
<div class="viewcode-block" id="BFDTDobject.getGeometryObjectsByType"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getGeometryObjectsByType">[docs]</a>  <span class="k">def</span> <span class="nf">getGeometryObjectsByType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">class_or_type_or_tuple</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Returns the list of geometry objects of type/class **class_or_type_or_tuple**.</span>
<span class="sd">    </span>
<span class="sd">    The filtering is done by ``isinstance(object, class_or_type_or_tuple)``.</span>
<span class="sd">    </span>
<span class="sd">    :param class_or_type_or_tuple: An FDTD object class like :py:class:`Block` or a tuple of such classes like ``(Block, Cylinder)``, in which case it will match if it is an instance of any of the classes in the tuple.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="p">[</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getGeometryObjects</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">class_or_type_or_tuple</span><span class="p">)</span> <span class="p">]</span></div>

<div class="viewcode-block" id="BFDTDobject.getSnapshots"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getSnapshots">[docs]</a>  <span class="k">def</span> <span class="nf">getSnapshots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Returns a list of all snapshots. &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">split</span><span class="p">:</span>
      <span class="n">snapshot_list</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapshot_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">ModeVolumeBoxFull</span><span class="p">):</span>
          <span class="n">esnap_list</span><span class="p">,</span> <span class="n">fsnap_list</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">getSplitSnapshots</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getMesh</span><span class="p">())</span>
          <span class="n">snapshot_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">esnap_list</span> <span class="o">+</span> <span class="n">fsnap_list</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="n">snapshot_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">snapshot_list</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapshot_list</span><span class="p">)</span></div>

<div class="viewcode-block" id="BFDTDobject.setSnapshots"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.setSnapshots">[docs]</a>  <span class="k">def</span> <span class="nf">setSnapshots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Removes all existing snapshots and replaces them with the elements from  the list of snapshots *obj* (or *[obj]* if *obj* is not a list, for convenience).</span>
<span class="sd">    </span>
<span class="sd">    Ex::</span>
<span class="sd">      </span>
<span class="sd">      sim.setSnapshots(EpsilonBoxFull()) # single snapshot</span>
<span class="sd">      sim.setSnapshots(100*[EpsilonSnapshot()]) # list of 100 snapshots</span>
<span class="sd">    </span>
<span class="sd">    :param obj: Snapshot or list of Snapshot instances</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">clearAllSnapshots</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">snapshot_list</span> <span class="o">=</span> <span class="n">obj</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">snapshot_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">obj</span><span class="p">]</span>
    
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapshot_list</span><span class="p">)</span></div>

<div class="viewcode-block" id="BFDTDobject.getAllTimeSnapshots"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getAllTimeSnapshots">[docs]</a>  <span class="k">def</span> <span class="nf">getAllTimeSnapshots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filterBasedOnClass</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the time snapshots sorted into lists based on their type:</span>
<span class="sd">    </span>
<span class="sd">    * all_time_snapshots</span>
<span class="sd">    * time_snapshots</span>
<span class="sd">    * epsilon_snapshots</span>
<span class="sd">    * mode_filtered_probes</span>

<span class="sd">    The classifications are exclusive, i.e.::</span>
<span class="sd">    </span>
<span class="sd">      len(all_time_snapshots) = len(time_snapshots) + len(epsilon_snapshots) + len(mode_filtered_probes)</span>
<span class="sd">    </span>
<span class="sd">    :param filterBasedOnClass: Boolean. If True, the snapshot type will be determined based on its current class type, else it will be determined based on its attributes. Default: False.</span>
<span class="sd">    :return: (all_time_snapshots, time_snapshots, epsilon_snapshots, mode_filtered_probes) - tuple of lists</span>
<span class="sd">        </span>
<span class="sd">    .. seealso::</span>
<span class="sd">    </span>
<span class="sd">      * :py:func:`getTimeSnapshots`</span>
<span class="sd">      * :py:func:`getEpsilonSnapshots`</span>
<span class="sd">      * :py:func:`getModeFilteredProbes`</span>
<span class="sd">      * :py:func:`bfdtd.snapshot.TimeSnapshot.getTypeBasedOnAttributes`</span>
<span class="sd">    </span>
<span class="sd">    .. warning:: The *SnapshotBox* subclasses are not yet supported by this system and will not be returned even if they generate *TimeSnapshot* entries.</span>
<span class="sd">    </span>
<span class="sd">    .. todo:: Support *SnapshotBox* subclasses?</span>
<span class="sd">    .. todo:: frequency snapshots, etc? split probe objects into different attributes again? -&gt; Need to be carefull with output file numbering! Data read-in depends on it!</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">all_time_snapshots</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">time_snapshots</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">epsilon_snapshots</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">mode_filtered_probes</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSnapshots</span><span class="p">(</span><span class="n">split</span><span class="p">):</span>
      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">TimeSnapshot</span><span class="p">):</span>
        <span class="n">all_time_snapshots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">filterBasedOnClass</span><span class="p">:</span>
          <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">ModeFilteredProbe</span><span class="p">):</span>
            <span class="n">mode_filtered_probes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
          <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">EpsilonSnapshot</span><span class="p">):</span>
            <span class="n">epsilon_snapshots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
          <span class="k">else</span><span class="p">:</span>
            <span class="n">time_snapshots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="n">t</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">getTypeBasedOnAttributes</span><span class="p">()</span>
          <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="n">ModeFilteredProbe</span><span class="p">:</span>
            <span class="n">mode_filtered_probes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
          <span class="k">elif</span> <span class="n">t</span> <span class="o">==</span> <span class="n">EpsilonSnapshot</span><span class="p">:</span>
            <span class="n">epsilon_snapshots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
          <span class="k">else</span><span class="p">:</span>
            <span class="n">time_snapshots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">all_time_snapshots</span><span class="p">,</span> <span class="n">time_snapshots</span><span class="p">,</span> <span class="n">epsilon_snapshots</span><span class="p">,</span> <span class="n">mode_filtered_probes</span><span class="p">)</span></div>

<div class="viewcode-block" id="BFDTDobject.getTimeSnapshots"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getTimeSnapshots">[docs]</a>  <span class="k">def</span> <span class="nf">getTimeSnapshots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filterBasedOnClass</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns all &quot;time snapshots&quot;.</span>
<span class="sd">    </span>
<span class="sd">    .. seealso:: :py:func:`getAllTimeSnapshots`</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="p">(</span><span class="n">all_time_snapshots</span><span class="p">,</span> <span class="n">time_snapshots</span><span class="p">,</span> <span class="n">epsilon_snapshots</span><span class="p">,</span> <span class="n">mode_filtered_probes</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAllTimeSnapshots</span><span class="p">(</span><span class="n">filterBasedOnClass</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">time_snapshots</span></div>
    
<div class="viewcode-block" id="BFDTDobject.getModeFilteredProbes"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getModeFilteredProbes">[docs]</a>  <span class="k">def</span> <span class="nf">getModeFilteredProbes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filterBasedOnClass</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns all &quot;mode filtered probes&quot;.</span>
<span class="sd">    </span>
<span class="sd">    .. seealso:: :py:func:`getAllTimeSnapshots`</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="p">(</span><span class="n">all_time_snapshots</span><span class="p">,</span> <span class="n">time_snapshots</span><span class="p">,</span> <span class="n">epsilon_snapshots</span><span class="p">,</span> <span class="n">mode_filtered_probes</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAllTimeSnapshots</span><span class="p">(</span><span class="n">filterBasedOnClass</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mode_filtered_probes</span></div>

<div class="viewcode-block" id="BFDTDobject.getEpsilonSnapshots"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getEpsilonSnapshots">[docs]</a>  <span class="k">def</span> <span class="nf">getEpsilonSnapshots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filterBasedOnClass</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns all &quot;epsilon snapshots&quot;.</span>
<span class="sd">    </span>
<span class="sd">    .. seealso:: :py:func:`getAllTimeSnapshots`</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="p">(</span><span class="n">all_time_snapshots</span><span class="p">,</span> <span class="n">time_snapshots</span><span class="p">,</span> <span class="n">epsilon_snapshots</span><span class="p">,</span> <span class="n">mode_filtered_probes</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAllTimeSnapshots</span><span class="p">(</span><span class="n">filterBasedOnClass</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="n">split</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">epsilon_snapshots</span></div>

<div class="viewcode-block" id="BFDTDobject.getFrequencySnapshots"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getFrequencySnapshots">[docs]</a>  <span class="k">def</span> <span class="nf">getFrequencySnapshots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns a list of the frequency snapshots.</span>
<span class="sd">    .. todo:: improve &quot;super-snapshot&quot; handling... (boxes, etc) -&gt; one problem is that it depends on the mesh of course...</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">frequency_snapshot_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSnapshots</span><span class="p">(</span><span class="n">split</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">FrequencySnapshot</span><span class="p">)</span> <span class="p">]</span>
    <span class="c1">#if not split:</span>
      <span class="c1">#frequency_snapshot_list = [ s for s in self.snapshot_list if isinstance(s, FrequencySnapshot) ]</span>
    <span class="c1">#else:</span>
      <span class="c1">#frequency_snapshot_list = []</span>
      <span class="c1">#for s in self.snapshot_list:</span>
        <span class="c1">#if isinstance(s, FrequencySnapshot):</span>
          <span class="c1">#if isinstance(s, ModeVolumeBoxFull):</span>
            <span class="c1">#esnap_list, fsnap_list = s.getSplitSnapshots(self.getMesh())</span>
            <span class="c1">#frequency_snapshot_list.extend(fsnap_list)</span>
          <span class="c1">#else:</span>
            <span class="c1">#frequency_snapshot_list.append(s)</span>
    <span class="k">return</span> <span class="n">frequency_snapshot_list</span></div>
  
<div class="viewcode-block" id="BFDTDobject.getProbes"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getProbes">[docs]</a>  <span class="k">def</span> <span class="nf">getProbes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">probe_list</span><span class="p">)</span></div>
  
<div class="viewcode-block" id="BFDTDobject.getExcitations"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getExcitations">[docs]</a>  <span class="k">def</span> <span class="nf">getExcitations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">excitation_list</span><span class="p">)</span></div>
<div class="viewcode-block" id="BFDTDobject.setExcitations"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.setExcitations">[docs]</a>  <span class="k">def</span> <span class="nf">setExcitations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">excitation_list</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">excitation_list</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
      <span class="n">excitation_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">excitation_list</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">excitation_list</span> <span class="o">=</span> <span class="n">excitation_list</span></div>

<div class="viewcode-block" id="BFDTDobject.getRefractiveIndexSet"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getRefractiveIndexSet">[docs]</a>  <span class="k">def</span> <span class="nf">getRefractiveIndexSet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns a set of unique refractive indices used in the objects.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">n_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getGeometryObjects</span><span class="p">():</span>
      <span class="n">n_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">getRefractiveIndex</span><span class="p">())</span>
    <span class="k">return</span><span class="p">(</span><span class="n">n_set</span><span class="p">)</span></div>

<div class="viewcode-block" id="BFDTDobject.getExcitationFrequencySet"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getExcitationFrequencySet">[docs]</a>  <span class="k">def</span> <span class="nf">getExcitationFrequencySet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns a set of unique frequencies used in the excitations.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">frequency_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">E</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getExcitations</span><span class="p">():</span>
      <span class="n">frequency_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">getFrequency</span><span class="p">())</span>
    <span class="k">return</span><span class="p">(</span><span class="n">frequency_set</span><span class="p">)</span></div>

<div class="viewcode-block" id="BFDTDobject.getSnapshotFrequencySet"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getSnapshotFrequencySet">[docs]</a>  <span class="k">def</span> <span class="nf">getSnapshotFrequencySet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns a set of unique frequencies used in the frequency snapshots.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">frequency_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">freq_snap</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFrequencySnapshots</span><span class="p">():</span>
      <span class="k">for</span> <span class="n">freq</span> <span class="ow">in</span> <span class="n">freq_snap</span><span class="o">.</span><span class="n">frequency_vector</span><span class="p">:</span>
        <span class="n">frequency_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">frequency_set</span><span class="p">)</span></div>

<div class="viewcode-block" id="BFDTDobject.getSnapshotFirstMax"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getSnapshotFirstMax">[docs]</a>  <span class="k">def</span> <span class="nf">getSnapshotFirstMax</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">first_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSnapshots</span><span class="p">():</span>
      <span class="n">first_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">getFirst</span><span class="p">())</span>
    <span class="k">return</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">first_set</span><span class="p">))</span></div>

<div class="viewcode-block" id="BFDTDobject.clearMesh"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.clearMesh">[docs]</a>  <span class="k">def</span> <span class="nf">clearMesh</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39; Resets the mesh to the default. &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="o">=</span> <span class="n">MeshObject</span><span class="p">()</span></div>
  
<div class="viewcode-block" id="BFDTDobject.getMesh"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getMesh">[docs]</a>  <span class="k">def</span> <span class="nf">getMesh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="p">)</span></div>
<div class="viewcode-block" id="BFDTDobject.setMesh"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.setMesh">[docs]</a>  <span class="k">def</span> <span class="nf">setMesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mesh</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh</span></div>

<div class="viewcode-block" id="BFDTDobject.getXmesh"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getXmesh">[docs]</a>  <span class="k">def</span> <span class="nf">getXmesh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getMesh</span><span class="p">()</span><span class="o">.</span><span class="n">getXmesh</span><span class="p">())</span></div>

<div class="viewcode-block" id="BFDTDobject.getYmesh"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getYmesh">[docs]</a>  <span class="k">def</span> <span class="nf">getYmesh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getMesh</span><span class="p">()</span><span class="o">.</span><span class="n">getYmesh</span><span class="p">())</span></div>

<div class="viewcode-block" id="BFDTDobject.getZmesh"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getZmesh">[docs]</a>  <span class="k">def</span> <span class="nf">getZmesh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getMesh</span><span class="p">()</span><span class="o">.</span><span class="n">getZmesh</span><span class="p">())</span></div>
  
<div class="viewcode-block" id="BFDTDobject.readBristolFDTD"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.readBristolFDTD">[docs]</a>  <span class="k">def</span> <span class="nf">readBristolFDTD</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Reads in one or multiple BFDTD input files (.in (=&gt;.inp+.geo), .geo or .inp) and adds their contents to the BFDTDobject.</span>
<span class="sd">    </span>
<span class="sd">    Examples::</span>
<span class="sd">    </span>
<span class="sd">      sim.readBristolFDTD(&#39;sim.in&#39;)</span>
<span class="sd">      sim.readBristolFDTD(&#39;sim.geo&#39;)</span>
<span class="sd">      sim.readBristolFDTD(&#39;sim.inp&#39;)</span>
<span class="sd">      sim.readBristolFDTD(&#39;sim1.in&#39;,&#39;sim2.in&#39;,&#39;sim3.geo&#39;)</span>
<span class="sd">      sim.readBristolFDTD(&#39;sim.geo&#39;,&#39;sim.inp&#39;)</span>
<span class="sd">    </span>
<span class="sd">    * Returns 0 on success.</span>
<span class="sd">    * Returns -1 on failure.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="k">for</span> <span class="n">current_filename</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
    
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&gt; Processing generic file : &#39;</span> <span class="o">+</span> <span class="n">current_filename</span><span class="p">)</span>
      
      <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">current_filename</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;ERROR: Not a file: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">current_filename</span><span class="p">))</span>
        <span class="c1">#print(&#39;ERROR: Not a file: {}&#39;.format(current_filename), file=sys.stderr)</span>
        <span class="k">return</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
      
      <span class="n">extension</span> <span class="o">=</span> <span class="n">getExtension</span><span class="p">(</span><span class="n">current_filename</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">extension</span> <span class="o">==</span> <span class="s1">&#39;in&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;.in file detected&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">readFileList</span><span class="p">(</span><span class="n">current_filename</span><span class="p">)</span>
      <span class="k">elif</span> <span class="n">extension</span> <span class="o">==</span> <span class="s1">&#39;inp&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;.inp file detected&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">readInputFile</span><span class="p">(</span><span class="n">current_filename</span><span class="p">)</span>
      <span class="k">elif</span> <span class="n">extension</span> <span class="o">==</span> <span class="s1">&#39;geo&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;.geo file detected&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">readInputFile</span><span class="p">(</span><span class="n">current_filename</span><span class="p">)</span>
      <span class="k">elif</span> <span class="n">extension</span> <span class="o">==</span> <span class="s1">&#39;prn&#39;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;.prn file detected: Not supported yet&#39;</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Unknown file format: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">extension</span><span class="p">))</span>
    
    <span class="k">return</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="BFDTDobject.readInputFile"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.readInputFile">[docs]</a>  <span class="k">def</span> <span class="nf">readInputFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
      <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">      read GEO or INP file</span>
<span class="sd">      </span>
<span class="sd">      .. todo:: Determine if a time snapshot is an epsilon or mode filtered snapshot during file reading (useful for easier processing of the snapshots later on). (cf snapshot getTypeByAttributes function in snapshot.py...)</span>
<span class="sd">      .. todo:: Store full comment as attribute of object</span>
<span class="sd">      .. todo:: This parsing system may need to be rewritten because rotation entries should apply to the previous entry... (partially done, but may cause problems in case of multiple rotations)</span>
<span class="sd">      .. todo:: separation of snapshots into correct classes on read-in by checking attributes (+ later MVboxes, etc of course, using special comment system)</span>
<span class="sd">      &#39;&#39;&#39;</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Processing &#39;</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span>
      <span class="n">box_read</span> <span class="o">=</span> <span class="kc">False</span>
      <span class="n">xmesh_read</span> <span class="o">=</span> <span class="kc">False</span>
      
      <span class="c1"># open file</span>
      <span class="n">input_stream</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
      <span class="c1"># read the whole file as one string</span>
      <span class="n">fulltext</span> <span class="o">=</span> <span class="n">input_stream</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
      <span class="c1"># close file</span>
      <span class="n">input_stream</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
  
      <span class="c1"># print fulltext</span>
  
      <span class="c1"># remove comments</span>
      <span class="c1"># TODO: Add more generic system for functional comments (to add layer, scene and group for example)</span>
      <span class="n">pattern_stripcomments</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;\*\*(?!name=).*</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
      <span class="n">cleantext</span> <span class="o">=</span> <span class="n">pattern_stripcomments</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fulltext</span><span class="p">)</span>
      <span class="c1">#print(cleantext)</span>
  
      <span class="c1"># pattern_objects = re.compile(&quot;^(?&lt;Type&gt;\w+).*?\{(?&lt;data&gt;[^\{\}]*?)\}&quot;)</span>
      <span class="c1">#pattern_objects = re.compile(&quot;(?P&lt;Type&gt;\w+)\s*(?P&lt;name&gt;(?&lt;=\*\*name=)[^{}]*)?{(?P&lt;data&gt;[^{}]*)}&quot;,re.DOTALL)</span>
      <span class="n">pattern_objects</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;(?P&lt;Type&gt;\w+)\s*(?P&lt;nameblob&gt;[^</span><span class="si">{}</span><span class="s2">]+)?{(?P&lt;data&gt;[^</span><span class="si">{}</span><span class="s2">]*)}&quot;</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>
      <span class="n">objects</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">groupdict</span><span class="p">()</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">pattern_objects</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">cleantext</span><span class="p">)]</span>
    
      <span class="n">entries</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="c1"># process objects</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">objects</span><span class="p">)):</span>
          <span class="n">Type</span> <span class="o">=</span> <span class="n">objects</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;Type&#39;</span><span class="p">]</span>
          <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
          <span class="k">if</span> <span class="s1">&#39;nameblob&#39;</span> <span class="ow">in</span> <span class="n">objects</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c1">#print objects[i][&#39;nameblob&#39;]</span>
            <span class="k">if</span> <span class="n">objects</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;nameblob&#39;</span><span class="p">]:</span>
              <span class="c1">#print &#39;OK&#39;</span>
              <span class="n">pattern_nameblob</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;\*\*name=(.*)&quot;</span><span class="p">)</span>
              <span class="n">m</span> <span class="o">=</span> <span class="n">pattern_nameblob</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">objects</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;nameblob&#39;</span><span class="p">])</span>
              <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="c1">#else:</span>
              <span class="c1">#print &#39;NOT OK&#39;</span>
              <span class="c1">#name = &#39;&#39;</span>
          <span class="c1">#else:</span>
            <span class="c1">#print &#39;NO NAME&#39;</span>
            <span class="c1">#name = &#39;&#39;</span>
          <span class="n">data</span> <span class="o">=</span> <span class="n">objects</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
          
          <span class="c1"># convert Type to upper case and strip it</span>
          <span class="n">Type</span> <span class="o">=</span> <span class="n">Type</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
          <span class="c1"># split data by spaces and new lines</span>
          <span class="n">data</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;\s+&#39;</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
          <span class="c1"># remove empty lines from data</span>
          <span class="c1">#data = filter(None, data)</span>
          <span class="n">data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>
          <span class="c1">#print(&#39;data = &#39;+str(data))</span>
          
          <span class="n">entry</span> <span class="o">=</span> <span class="n">Entry</span><span class="p">()</span>
          <span class="n">entry</span><span class="o">.</span><span class="n">Type</span> <span class="o">=</span> <span class="n">Type</span>
          <span class="n">entry</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
          <span class="n">entry</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
          <span class="n">entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
          
          <span class="c1"># mandatory objects</span>
          <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">Type</span> <span class="o">==</span> <span class="s1">&#39;XMESH&#39;</span><span class="p">:</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">setXmeshDelta</span><span class="p">(</span><span class="n">float_array</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
              <span class="n">xmesh_read</span> <span class="o">=</span> <span class="kc">True</span>
          <span class="k">elif</span> <span class="n">entry</span><span class="o">.</span><span class="n">Type</span> <span class="o">==</span> <span class="s1">&#39;YMESH&#39;</span><span class="p">:</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">setYmeshDelta</span><span class="p">(</span><span class="n">float_array</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
          <span class="k">elif</span> <span class="n">entry</span><span class="o">.</span><span class="n">Type</span> <span class="o">==</span> <span class="s1">&#39;ZMESH&#39;</span><span class="p">:</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">setZmeshDelta</span><span class="p">(</span><span class="n">float_array</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
          <span class="k">elif</span> <span class="n">entry</span><span class="o">.</span><span class="n">Type</span> <span class="o">==</span> <span class="s1">&#39;FLAG&#39;</span><span class="p">:</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">flag</span><span class="o">.</span><span class="n">read_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
          <span class="k">elif</span> <span class="n">entry</span><span class="o">.</span><span class="n">Type</span> <span class="o">==</span> <span class="s1">&#39;BOUNDARY&#39;</span><span class="p">:</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">boundaries</span><span class="o">.</span><span class="n">read_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
          <span class="k">elif</span> <span class="n">entry</span><span class="o">.</span><span class="n">Type</span> <span class="o">==</span> <span class="s1">&#39;BOX&#39;</span><span class="p">:</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">read_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
              <span class="n">box_read</span> <span class="o">=</span> <span class="kc">True</span>
                  
          <span class="c1"># geometry objects</span>
          <span class="k">elif</span> <span class="n">entry</span><span class="o">.</span><span class="n">Type</span> <span class="o">==</span> <span class="s1">&#39;SPHERE&#39;</span><span class="p">:</span>
              <span class="n">sphere</span> <span class="o">=</span> <span class="n">Sphere</span><span class="p">()</span>
              <span class="n">sphere</span><span class="o">.</span><span class="n">read_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">sphere_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sphere</span><span class="p">)</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">geometry_object_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sphere</span><span class="p">)</span>
          <span class="k">elif</span> <span class="n">entry</span><span class="o">.</span><span class="n">Type</span> <span class="o">==</span> <span class="s1">&#39;BLOCK&#39;</span><span class="p">:</span>
              <span class="n">block</span> <span class="o">=</span> <span class="n">Block</span><span class="p">()</span>
              <span class="n">block</span><span class="o">.</span><span class="n">read_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">block_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">geometry_object_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
          <span class="k">elif</span> <span class="n">entry</span><span class="o">.</span><span class="n">Type</span> <span class="o">==</span> <span class="s1">&#39;DISTORTED&#39;</span><span class="p">:</span>
              <span class="n">distorted</span> <span class="o">=</span> <span class="n">Distorted</span><span class="p">()</span>
              <span class="n">distorted</span><span class="o">.</span><span class="n">read_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">distorted_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">distorted</span><span class="p">)</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">geometry_object_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">distorted</span><span class="p">)</span>
          <span class="k">elif</span> <span class="n">entry</span><span class="o">.</span><span class="n">Type</span> <span class="o">==</span> <span class="s1">&#39;CYLINDER&#39;</span><span class="p">:</span>
              <span class="n">cylinder</span> <span class="o">=</span> <span class="n">Cylinder</span><span class="p">()</span>
              <span class="n">cylinder</span><span class="o">.</span><span class="n">read_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">cylinder_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cylinder</span><span class="p">)</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">geometry_object_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cylinder</span><span class="p">)</span>
              
          <span class="k">elif</span> <span class="n">entry</span><span class="o">.</span><span class="n">Type</span> <span class="o">==</span> <span class="s1">&#39;ROTATION&#39;</span><span class="p">:</span>
              <span class="n">rotation</span> <span class="o">=</span> <span class="n">Rotation</span><span class="p">()</span>
              <span class="n">rotation</span><span class="o">.</span><span class="n">read_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">global_rotation_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rotation</span><span class="p">)</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">geometry_object_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">rotation_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rotation</span><span class="p">)</span> <span class="c1"># append rotation to previous object (pb of course, if multiple rotations...)</span>
          
          <span class="c1"># excitation objects</span>
          <span class="k">elif</span> <span class="n">entry</span><span class="o">.</span><span class="n">Type</span> <span class="o">==</span> <span class="s1">&#39;EXCITATION&#39;</span><span class="p">:</span>
              <span class="n">current_excitation</span> <span class="o">=</span> <span class="n">Excitation</span><span class="p">()</span>
              <span class="n">current_excitation</span><span class="o">.</span><span class="n">read_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">excitation_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_excitation</span><span class="p">)</span>
          
          <span class="c1"># measurement objects</span>
          <span class="k">elif</span> <span class="n">entry</span><span class="o">.</span><span class="n">Type</span> <span class="o">==</span> <span class="s1">&#39;FREQUENCY_SNAPSHOT&#39;</span><span class="p">:</span>
              <span class="n">frequency_snapshot</span> <span class="o">=</span> <span class="n">FrequencySnapshot</span><span class="p">()</span>
              <span class="n">frequency_snapshot</span><span class="o">.</span><span class="n">read_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
              <span class="n">frequency_snapshot</span><span class="o">.</span><span class="n">setFullExtensionOff</span><span class="p">()</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">frequency_snapshot_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frequency_snapshot</span><span class="p">)</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">snapshot_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frequency_snapshot</span><span class="p">)</span>
          <span class="k">elif</span> <span class="n">entry</span><span class="o">.</span><span class="n">Type</span> <span class="o">==</span> <span class="s1">&#39;SNAPSHOT&#39;</span><span class="p">:</span>
              <span class="n">time_snapshot</span> <span class="o">=</span> <span class="n">TimeSnapshot</span><span class="p">()</span>
              <span class="n">time_snapshot</span><span class="o">.</span><span class="n">read_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
              <span class="n">time_snapshot</span><span class="o">.</span><span class="n">setFullExtensionOff</span><span class="p">()</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">time_snapshot_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time_snapshot</span><span class="p">)</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">snapshot_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time_snapshot</span><span class="p">)</span>
          <span class="k">elif</span> <span class="n">entry</span><span class="o">.</span><span class="n">Type</span> <span class="o">==</span> <span class="s1">&#39;PROBE&#39;</span><span class="p">:</span>
              <span class="n">probe</span> <span class="o">=</span> <span class="n">Probe</span><span class="p">()</span>
              <span class="n">probe</span><span class="o">.</span><span class="n">read_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">probe_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">probe</span><span class="p">)</span>
  
          <span class="k">else</span><span class="p">:</span>
              <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Unknown Type: &#39;</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">Type</span><span class="p">)</span>

      <span class="k">return</span> <span class="p">[</span> <span class="n">xmesh_read</span><span class="p">,</span> <span class="n">box_read</span> <span class="p">]</span></div>

<div class="viewcode-block" id="BFDTDobject.readFileList"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.readFileList">[docs]</a>  <span class="k">def</span> <span class="nf">readFileList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
      <span class="sd">&#39;&#39;&#39; read .in file &#39;&#39;&#39;</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&gt;Processing .in file : &#39;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
      
      <span class="n">box_read</span> <span class="o">=</span> <span class="kc">False</span>
      <span class="n">xmesh_read</span> <span class="o">=</span> <span class="kc">False</span>
      
      <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span> <span class="c1"># only process line if it is not empty</span>
              <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span> <span class="nb">print</span><span class="p">((</span><span class="s1">&#39;os.path.dirname(filename): &#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename</span><span class="p">)))</span> <span class="c1"># directory of .in file</span>
              <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span> <span class="nb">print</span><span class="p">((</span><span class="s1">&#39;line.strip()=&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()))</span> <span class="c1"># remove any \n or similar</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">fileList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
              <span class="c1"># this is done so that you don&#39;t have to be in the directory containing the .geo/.inp files</span>
              <span class="c1">#subfile = os.path.join(os.path.dirname(filename),os.path.basename(line.strip())) # converts absolute paths to relative</span>
              <span class="n">subfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="c1"># uses absolute paths if given</span>
              <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span> <span class="nb">print</span><span class="p">((</span><span class="s1">&#39;subfile: &#39;</span><span class="p">,</span> <span class="n">subfile</span><span class="p">))</span>
              <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">xmesh_read</span><span class="p">):</span> <span class="c1"># as long as the mesh hasn&#39;t been read, .inp is assumed as the default extension</span>
                  <span class="n">subfile_ext</span> <span class="o">=</span> <span class="n">addExtension</span><span class="p">(</span><span class="n">subfile</span><span class="p">,</span><span class="s1">&#39;inp&#39;</span><span class="p">)</span>
              <span class="k">else</span><span class="p">:</span>
                  <span class="n">subfile_ext</span> <span class="o">=</span> <span class="n">addExtension</span><span class="p">(</span><span class="n">subfile</span><span class="p">,</span><span class="s1">&#39;geo&#39;</span><span class="p">)</span>
                  <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">subfile_ext</span><span class="p">):</span>
                    <span class="n">subfile_ext</span> <span class="o">=</span> <span class="n">addExtension</span><span class="p">(</span><span class="n">subfile</span><span class="p">,</span><span class="s1">&#39;inp&#39;</span><span class="p">)</span>
              <span class="p">[</span> <span class="n">xmesh_read_loc</span><span class="p">,</span> <span class="n">box_read_loc</span> <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readInputFile</span><span class="p">(</span><span class="n">subfile_ext</span><span class="p">)</span>
              <span class="k">if</span> <span class="n">xmesh_read_loc</span><span class="p">:</span>
                  <span class="n">xmesh_read</span> <span class="o">=</span> <span class="kc">True</span>
              <span class="k">if</span> <span class="n">box_read_loc</span><span class="p">:</span>
                  <span class="n">box_read</span> <span class="o">=</span> <span class="kc">True</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">xmesh_read</span><span class="p">):</span>
          <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING: mesh not found&#39;</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">box_read</span><span class="p">):</span>
          <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING: box not found&#39;</span><span class="p">)</span></div>
  
<div class="viewcode-block" id="BFDTDobject.writeDatFiles"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.writeDatFiles">[docs]</a>  <span class="k">def</span> <span class="nf">writeDatFiles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Generate template .dat file for a plane excitation&#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">excitation_template_list</span><span class="p">:</span>
      <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;WARNING: Passing the mesh not supported yet!!! Use generated .dat file at your own risk (as always of course).&#39;</span><span class="p">)</span>
      <span class="c1">#obj.writeDatFile(directory+os.sep+obj.fileName, self.mesh, overwrite=overwrite)</span>
      <span class="n">obj</span><span class="o">.</span><span class="n">writeDatFile</span><span class="p">(</span><span class="n">directory</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">+</span><span class="n">obj</span><span class="o">.</span><span class="n">fileName</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span>
    <span class="k">return</span></div>

<div class="viewcode-block" id="BFDTDobject.writeCtlFile"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.writeCtlFile">[docs]</a>  <span class="k">def</span> <span class="nf">writeCtlFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">,</span> <span class="n">withGeom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">withBox</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">no_offset</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    
    <span class="sd">&#39;&#39;&#39; Generate .ctl file &#39;&#39;&#39;</span>
    <span class="c1">#Cylinder.write_entry = Cylinder.writeCTL</span>
    <span class="c1">#self.writeGeoFile(fileName, withGeom, overwrite, withBox)</span>
    
    <span class="k">if</span> <span class="n">no_offset</span><span class="p">:</span>
      <span class="n">offset</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">offset</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">getCentro</span><span class="p">()</span>
    
    <span class="c1"># check if file already exists</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">overwrite</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fileName</span><span class="p">):</span>
      <span class="k">raise</span> <span class="ne">UserWarning</span><span class="p">(</span><span class="s1">&#39;File already exists: &#39;</span> <span class="o">+</span> <span class="n">fileName</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Writing to </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fileName</span><span class="p">))</span>
    
    <span class="c1"># open file</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">out</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">withBox</span><span class="p">:</span>
        <span class="c1">#write box</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">writeCTL</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
      
      <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;(set! geometry (list</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
      
      <span class="k">if</span> <span class="n">withGeom</span><span class="p">:</span>
        <span class="c1"># write geometry objects</span>
        <span class="c1">#print(&#39;len(self.geometry_object_list) = &#39;+len(self.geometry_object_list))</span>
        
        <span class="c1"># now loop through the geometry objects and write them to the file</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry_object_list</span><span class="p">:</span>
          <span class="c1">#print obj.name</span>
          <span class="c1">#print obj.__class__.__name__</span>
          <span class="n">obj</span><span class="o">.</span><span class="n">writeCTL</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>

      <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;))</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
      
      <span class="c1"># close file</span>
      <span class="n">out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span></div>
  
<div class="viewcode-block" id="BFDTDobject.writeGeoFile"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.writeGeoFile">[docs]</a>  <span class="k">def</span> <span class="nf">writeGeoFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">,</span> <span class="n">withGeom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">withBox</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">call_makedirs</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Generate .geo file &#39;&#39;&#39;</span>
    <span class="c1"># check if file already exists</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">overwrite</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fileName</span><span class="p">):</span>
      <span class="k">raise</span> <span class="ne">UserWarning</span><span class="p">(</span><span class="s1">&#39;File already exists: &#39;</span> <span class="o">+</span> <span class="n">fileName</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Writing to </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fileName</span><span class="p">))</span>
    
    <span class="c1"># create dirs if needed</span>
    <span class="k">if</span> <span class="n">call_makedirs</span><span class="p">:</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fileName</span><span class="p">)):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fileName</span><span class="p">))</span>
    
    <span class="c1"># open file</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">out</span><span class="p">:</span>
      
      <span class="c1"># write header</span>
      <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;**GEOMETRY FILE</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
      <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
      
      <span class="c1"># first add a backfill block if necessary</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_permittivity</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_conductivity</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">backfill</span> <span class="o">=</span> <span class="n">Block</span><span class="p">()</span>
        <span class="n">backfill</span><span class="o">.</span><span class="n">setRelativePermittivity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_permittivity</span><span class="p">)</span>
        <span class="n">backfill</span><span class="o">.</span><span class="n">setRelativeConductivity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_conductivity</span><span class="p">)</span>
        <span class="n">backfill</span><span class="o">.</span><span class="n">setLowerAbsolute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">getLower</span><span class="p">())</span>
        <span class="n">backfill</span><span class="o">.</span><span class="n">setUpperAbsolute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">getUpper</span><span class="p">())</span>
        <span class="n">backfill</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="s1">&#39;backfill&#39;</span><span class="p">)</span>
        <span class="n">backfill</span><span class="o">.</span><span class="n">write_entry</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
      
      <span class="k">if</span> <span class="n">withGeom</span><span class="p">:</span>
        <span class="c1"># write geometry objects</span>
        <span class="c1">#print(&#39;len(self.geometry_object_list) = &#39;+len(self.geometry_object_list))</span>
        
        <span class="c1"># now loop through the geometry objects and write them to the file</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry_object_list</span><span class="p">:</span>
          <span class="c1">#print obj.name</span>
          <span class="c1">#print obj.__class__.__name__</span>
          <span class="n">obj</span><span class="o">.</span><span class="n">write_entry</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

      <span class="k">if</span> <span class="n">withBox</span><span class="p">:</span>
        <span class="c1">#write box</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">write_entry</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
      
      <span class="c1"># write footer</span>
      <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;end</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">);</span> <span class="c1">#end the file</span>
    
      <span class="c1"># close file</span>
      <span class="n">out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span></div>

<div class="viewcode-block" id="BFDTDobject.fixSimulation"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.fixSimulation">[docs]</a>  <span class="k">def</span> <span class="nf">fixSimulation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Automatically fix common mistakes.</span>
<span class="sd">    </span>
<span class="sd">    .. todo:: Fix AutoFix/autoset*, etc redundancy here and in sub-objects like Excitation. Streamline fixing/checking/warning/exception procedures.</span>
<span class="sd">    </span>
<span class="sd">    .. todo:: set probe steps to 1? -&gt; check+fix</span>
<span class="sd">    .. todo:: probe step vs smallest excitation period... -&gt; check+fix</span>
<span class="sd">    .. todo:: time step vs smallest excitation period... -&gt; check+fix</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFlag</span><span class="p">()</span><span class="o">.</span><span class="n">getIdString</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;_id_&#39;</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">getFlag</span><span class="p">()</span><span class="o">.</span><span class="n">setIdString</span><span class="p">(</span><span class="s1">&#39;_id_&#39;</span><span class="p">)</span>
    
    <span class="c1"># make sure there is at least one excitation. Otherwise Bristol FDTD will crash.</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getExcitations</span><span class="p">())</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
      <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;WARNING: No excitation specified. Adding default excitation.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">addDefaultExcitation</span><span class="p">()</span>
    
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">autoset_ExcitationStartTime</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">autosetExcitationStartTime</span><span class="p">()</span>
    
    <span class="k">for</span> <span class="n">E</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getExcitations</span><span class="p">():</span>
      <span class="n">E</span><span class="o">.</span><span class="n">fix</span><span class="p">()</span>
    
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getProbes</span><span class="p">():</span>
      <span class="n">p</span><span class="o">.</span><span class="n">setStep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">autoset_FrequencySnapshotSettings</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">autosetFrequencySnapshotSettings</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">RepetitionMode</span><span class="p">)</span></div>
  
<div class="viewcode-block" id="BFDTDobject.checkSimulation"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.checkSimulation">[docs]</a>  <span class="k">def</span> <span class="nf">checkSimulation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_checks</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Supposed to make sure we don&#39;t write out too many probes/snapshots...</span>
<span class="sd">    </span>
<span class="sd">    * Problem: snapshot boxes and other compound objects will not get counted properly...</span>
<span class="sd">    * Solution: Best to count objects after writing (maybe use tmp, sys.stdout, file buffer or similar to allow count without actual file output).</span>
<span class="sd">    </span>
<span class="sd">    .. todo:: Check that frequency of fsnaps is within excitation range?</span>
<span class="sd">    .. todo:: check that repetition not too big or too small</span>
<span class="sd">    .. todo:: check that not too many snaps will be generated based on repetition value</span>
<span class="sd">    .. todo:: create function to quickly access number of generated snaps based on repetition value (+ setter functions for repetition/iterations? also based on time intervals, time/iter conversion functions?)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">printInfo</span><span class="p">()</span>
    
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFlag</span><span class="p">()</span><span class="o">.</span><span class="n">getIdString</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;_id_&#39;</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Please use &#39;_id_&#39; as ID string, not &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getFlag</span><span class="p">()</span><span class="o">.</span><span class="n">getIdString</span><span class="p">()))</span>
    
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getExcitations</span><span class="p">())</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;No excitation specified.&#39;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">output_checks</span><span class="p">:</span>
      <span class="p">(</span><span class="n">all_time_snapshots</span><span class="p">,</span> <span class="n">time_snapshots</span><span class="p">,</span> <span class="n">epsilon_snapshots</span><span class="p">,</span> <span class="n">mode_filtered_probes</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAllTimeSnapshots</span><span class="p">(</span><span class="n">split</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
      
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_time_snapshots</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">utilities</span><span class="o">.</span><span class="n">brisFDTD_ID_info</span><span class="o">.</span><span class="n">TIMESNAPSHOT_MAX</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Your simulation contains too many time snapshots!!! Either split it up into multiple simulations or reduce your number of snapshots. N(TimeSnapshots)=</span><span class="si">{}</span><span class="s1"> &gt; TIMESNAPSHOT_MAX=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_time_snapshots</span><span class="p">),</span> <span class="n">utilities</span><span class="o">.</span><span class="n">brisFDTD_ID_info</span><span class="o">.</span><span class="n">TIMESNAPSHOT_MAX</span><span class="p">))</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_time_snapshots</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">MaxTimeSnapshots</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Your simulation contains too many time snapshots!!! Either split it up into multiple simulations or reduce your number of snapshots. N(TimeSnapshots)=</span><span class="si">{}</span><span class="s1"> &gt; MaxTimeSnapshots=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_time_snapshots</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">MaxTimeSnapshots</span><span class="p">))</span>
      
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getFrequencySnapshots</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">utilities</span><span class="o">.</span><span class="n">brisFDTD_ID_info</span><span class="o">.</span><span class="n">FREQUENCYSNAPSHOT_MAX</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Your simulation contains too many frequency snapshots!!! Either split it up into multiple simulations or reduce your number of snapshots. N(FrequencySnapshots)=</span><span class="si">{}</span><span class="s1"> &gt; FREQUENCYSNAPSHOT_MAX=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getFrequencySnapshots</span><span class="p">(</span><span class="kc">True</span><span class="p">)),</span> <span class="n">utilities</span><span class="o">.</span><span class="n">brisFDTD_ID_info</span><span class="o">.</span><span class="n">FREQUENCYSNAPSHOT_MAX</span><span class="p">))</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getFrequencySnapshots</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">MaxFrequencySnapshots</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Your simulation contains too many frequency snapshots!!! Either split it up into multiple simulations or reduce your number of snapshots. N(FrequencySnapshots)=</span><span class="si">{}</span><span class="s1"> &gt; MaxFrequencySnapshots=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getFrequencySnapshots</span><span class="p">(</span><span class="kc">True</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">MaxFrequencySnapshots</span><span class="p">))</span>
    
    <span class="c1">#FREQUENCYSNAPSHOT_MAX</span>
    <span class="c1">#TIMESNAPSHOT_MAX</span>
    <span class="c1">#PROBE_MAX</span>
    <span class="c1">#MODEFILTEREDPROBE_MAX</span>
    <span class="c1">#warnings.warn(&#39;BAD SIM!!!&#39;)</span>
    
    <span class="c1"># already included in excitation check</span>
    <span class="c1">#if self.getExcitationStartTimeMin() &lt; 0:</span>
      <span class="c1">#raise Exception(&#39;self.getExcitationStartTimeMin()={} &lt; 0&#39;.format(self.getExcitationStartTimeMin()))</span>
    
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getIterations</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;self.getIterations()=</span><span class="si">{}</span><span class="s1"> &lt;= 0&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getIterations</span><span class="p">())</span> <span class="p">)</span>
    
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getIterations</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getExcitationEndTimeMax</span><span class="p">()</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSimulationTime</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;self.getExcitationEndTimeMax()=</span><span class="si">{}</span><span class="s1"> &gt;= self.getSimulationTime()=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getExcitationEndTimeMax</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSimulationTime</span><span class="p">())</span> <span class="p">)</span>
    
    <span class="c1"># time/iteration after which the excitations have stopped</span>
    <span class="n">t_Estop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getExcitationEndTimeMax</span><span class="p">()</span>
    <span class="n">N_Estop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">t_Estop</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">getTimeStep</span><span class="p">()))</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Excitation stop time = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t_Estop</span><span class="p">))</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Excitation stop iteration = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">N_Estop</span><span class="p">))</span>
    
    <span class="k">for</span> <span class="n">snapshot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSnapshots</span><span class="p">():</span>
      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">snapshot</span><span class="p">,</span> <span class="n">SnapshotBox</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">snapshot</span><span class="o">.</span><span class="n">getBaseSnapshot</span><span class="p">()</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">snapshot</span>
      
      <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">getFirst</span><span class="p">()</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">getIterations</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Snapshots with s.getFirst()=</span><span class="si">{}</span><span class="s1"> &gt; self.getIterations()=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">getFirst</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">getIterations</span><span class="p">()))</span>
      <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">getRepetition</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Snapshots with negative or zero repetition value! : s.getRepetition() = </span><span class="si">{}</span><span class="s1">, s.__class__ = </span><span class="si">{}</span><span class="s1">, s.getTypeBasedOnAttributes() = </span><span class="si">{}</span><span class="se">\n</span><span class="s1">--&gt;s:</span><span class="se">\n</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">getRepetition</span><span class="p">(),</span> <span class="n">s</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">getTypeBasedOnAttributes</span><span class="p">(),</span> <span class="n">s</span><span class="p">))</span>
    
      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">FrequencySnapshot</span><span class="p">):</span>
        
        <span class="c1"># TODO: Why these limitations? to always have enough snapshots + enough iterations in each?</span>
        <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">getRepetition</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">5e5</span><span class="p">:</span>
          <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;repetition = </span><span class="si">{}</span><span class="s1"> &gt; 5e5&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">getRepetition</span><span class="p">()))</span>
        <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">getRepetition</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">24</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="p">:</span>
          <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;repetition = </span><span class="si">{}</span><span class="s1"> &lt; 24*60*60&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">getRepetition</span><span class="p">()))</span>
        
        <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">getStartingSample</span><span class="p">()</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">getIterations</span><span class="p">():</span>
          <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Snapshots with s.getStartingSample()=</span><span class="si">{}</span><span class="s1"> &gt; self.getIterations()=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">getStartingSample</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">getIterations</span><span class="p">()))</span>
        <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">getFirst</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">s</span><span class="o">.</span><span class="n">getStartingSample</span><span class="p">()</span> <span class="o">+</span> <span class="n">s</span><span class="o">.</span><span class="n">getRepetition</span><span class="p">():</span>
          <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Frequency snapshot &quot;first&quot; value smaller than &quot;starting sample&quot; + &quot;repetition&quot;: </span><span class="si">{}</span><span class="s1"> &lt; </span><span class="si">{}</span><span class="s1">+</span><span class="si">{}</span><span class="s1">=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">getFirst</span><span class="p">(),</span> <span class="n">s</span><span class="o">.</span><span class="n">getStartingSample</span><span class="p">(),</span> <span class="n">s</span><span class="o">.</span><span class="n">getRepetition</span><span class="p">(),</span> <span class="n">s</span><span class="o">.</span><span class="n">getStartingSample</span><span class="p">()</span> <span class="o">+</span> <span class="n">s</span><span class="o">.</span><span class="n">getRepetition</span><span class="p">()))</span>
        <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">getStartingSample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">N_Estop</span><span class="p">:</span>
          <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Frequency snapshot &quot;starting sample&quot; &lt; &quot;excitation end&quot;: </span><span class="si">{}</span><span class="s1"> &lt; </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">getStartingSample</span><span class="p">(),</span> <span class="n">N_Estop</span><span class="p">))</span>
    
    <span class="c1"># .. todo:: Add check functions for each object, so those can be called instead?</span>
    <span class="k">for</span> <span class="n">exc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getExcitations</span><span class="p">():</span>
      <span class="n">exc</span><span class="o">.</span><span class="n">check</span><span class="p">()</span>
      <span class="c1">#if exc.getPeriod() &gt; exc.getTimeConstant():</span>
        <span class="c1">#raise Exception(&#39;exc.getPeriod()={} &gt; exc.getTimeConstant()={}&#39;.format(exc.getPeriod(), exc.getTimeConstant()))</span>
    
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getProbes</span><span class="p">():</span>
      <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">getStep</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;probe step=</span><span class="si">{}</span><span class="s1"> != 1&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">getStep</span><span class="p">()))</span>
    
    <span class="c1"># check that all snapshot frequencies are within excitation range</span>
    <span class="n">mini</span><span class="p">,</span> <span class="n">maxi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getExcitationFrequencyRange</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSnapshotFrequencySet</span><span class="p">():</span>
      <span class="k">if</span> <span class="n">f</span> <span class="o">&lt;</span> <span class="n">mini</span> <span class="ow">or</span> <span class="n">maxi</span> <span class="o">&lt;</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Snapshot frequency </span><span class="si">{}</span><span class="s1"> is outside the excited frequency range </span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">mini</span><span class="p">,</span> <span class="n">maxi</span><span class="p">))</span>
    
    <span class="k">return</span></div>

<div class="viewcode-block" id="BFDTDobject.writeExcitationsToFile"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.writeExcitationsToFile">[docs]</a>  <span class="k">def</span> <span class="nf">writeExcitationsToFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">call_makedirs</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

    <span class="c1"># create dirs if needed</span>
    <span class="k">if</span> <span class="n">call_makedirs</span><span class="p">:</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fileName</span><span class="p">)):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fileName</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">overwrite</span><span class="p">:</span>
      <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span> <span class="c1"># open for exclusive creation, failing if the file already exists</span>
    <span class="k">elif</span> <span class="n">append</span><span class="p">:</span>
      <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span> <span class="c1"># open for writing, appending to the end of the file if it exists</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;w&#39;</span> <span class="c1"># open for writing, truncating the file first</span>
    
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span> <span class="k">as</span> <span class="n">fid</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getExcitations</span><span class="p">():</span>
        <span class="n">e</span><span class="o">.</span><span class="n">write_entry</span><span class="p">(</span><span class="n">fid</span><span class="p">)</span>
    
    <span class="k">return</span></div>

<div class="viewcode-block" id="BFDTDobject.writeProbesToFile"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.writeProbesToFile">[docs]</a>  <span class="k">def</span> <span class="nf">writeProbesToFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">call_makedirs</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

    <span class="c1"># create dirs if needed</span>
    <span class="k">if</span> <span class="n">call_makedirs</span><span class="p">:</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fileName</span><span class="p">)):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fileName</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">overwrite</span><span class="p">:</span>
      <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span> <span class="c1"># open for exclusive creation, failing if the file already exists</span>
    <span class="k">elif</span> <span class="n">append</span><span class="p">:</span>
      <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span> <span class="c1"># open for writing, appending to the end of the file if it exists</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;w&#39;</span> <span class="c1"># open for writing, truncating the file first</span>
    
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span> <span class="k">as</span> <span class="n">fid</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getProbes</span><span class="p">():</span>
        <span class="n">p</span><span class="o">.</span><span class="n">write_entry</span><span class="p">(</span><span class="n">fid</span><span class="p">)</span>
    
    <span class="k">return</span></div>
  
<div class="viewcode-block" id="BFDTDobject.writeInpFile"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.writeInpFile">[docs]</a>  <span class="k">def</span> <span class="nf">writeInpFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Generate .inp file</span>
<span class="sd">    </span>
<span class="sd">    .. todo:: Should take a file object to enable writing to sys.stdout... (useful for counting final number of items and test runs)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="c1"># defaults</span>
    <span class="k">if</span> <span class="n">fileName</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">fileName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileBaseName</span> <span class="o">+</span> <span class="s1">&#39;.inp&#39;</span>
    
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;self.AutoFix = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">AutoFix</span><span class="p">))</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;self.autoset_FrequencySnapshotSettings = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">autoset_FrequencySnapshotSettings</span><span class="p">))</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;self.autoset_N_FrequencySnapshots = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">autoset_N_FrequencySnapshots</span><span class="p">))</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;self.autoset_ExcitationStartTime = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">autoset_ExcitationStartTime</span><span class="p">))</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;self.SafetyChecks = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SafetyChecks</span><span class="p">))</span>
    
    <span class="c1"># autofix</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">AutoFix</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">fixSimulation</span><span class="p">()</span>
    
    <span class="c1"># safety checks</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">SafetyChecks</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">checkSimulation</span><span class="p">()</span>
    
    <span class="c1"># check if file already exists</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">overwrite</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fileName</span><span class="p">):</span>
      <span class="k">raise</span> <span class="ne">UserWarning</span><span class="p">(</span><span class="s1">&#39;File already exists: &#39;</span> <span class="o">+</span> <span class="n">fileName</span><span class="p">)</span>
    
    <span class="c1"># open file</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">out</span><span class="p">:</span>
  
      <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getExcitations</span><span class="p">():</span>
        <span class="c1">#obj.directory = os.path.dirname(fileName)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMesh</span><span class="p">()</span>
        <span class="c1"># .. todo:: reduce check/fix calls... : no need to call here + in excitation write...</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">write_entry</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">AutoFix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">AutoFix</span><span class="p">,</span> <span class="n">SafetyChecks</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">SafetyChecks</span><span class="p">)</span>
      <span class="c1">#print(self.boundaries)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">getBoundaries</span><span class="p">()</span><span class="o">.</span><span class="n">write_entry</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">getFlag</span><span class="p">()</span><span class="o">.</span><span class="n">write_entry</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">getMesh</span><span class="p">()</span><span class="o">.</span><span class="n">write_entry</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
            
      <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapshot_list</span><span class="p">:</span>
        <span class="c1">#print(&#39;Now calling write using obj = {}&#39;.format(obj.__repr__()))</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">write_entry</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMesh</span><span class="p">())</span>
        
      <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">probe_list</span><span class="p">:</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">write_entry</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
      
      <span class="c1">#write footer</span>
      <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;end</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="c1">#end the file</span>
      <span class="c1">#close file</span>
      <span class="n">out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span></div>
        
<div class="viewcode-block" id="BFDTDobject.writeFileList"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.writeFileList">[docs]</a>  <span class="k">def</span> <span class="nf">writeFileList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">,</span> <span class="n">fileList</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_relpath</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Generate .in file &#39;&#39;&#39;</span>
    <span class="c1"># leaving it external at the moment since it might be practical to use it without having to create a Bfdtd object</span>
    <span class="c1">#if self.fileList is None:</span>
      <span class="c1">#self.fileList = [fileBaseName+&#39;.inp&#39;,fileBaseName+&#39;.geo&#39;]</span>
    <span class="k">if</span> <span class="n">fileList</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">fileList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileList</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;fileName = &#39;</span><span class="o">+</span><span class="n">fileName</span><span class="p">)</span>
    <span class="c1">#print(&#39;fileList = &#39;+str(fileList))</span>
    <span class="n">GEOin</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">fileList</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">,</span> <span class="n">use_relpath</span><span class="o">=</span><span class="n">use_relpath</span><span class="p">)</span>
    <span class="k">return</span></div>
    
<div class="viewcode-block" id="BFDTDobject.writeCondorScript"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.writeCondorScript">[docs]</a>  <span class="k">def</span> <span class="nf">writeCondorScript</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">,</span> <span class="n">BASENAME</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Generate fileName.cmd file for Condor using BASENAME.in, BASENAME.geo, BASENAME.inp &#39;&#39;&#39;</span>
    <span class="c1"># leaving it external at the moment since it might be practical to use it without having to create a Bfdtd object</span>
    <span class="k">if</span> <span class="n">BASENAME</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">BASENAME</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">fileName</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">GEOcommand</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">BASENAME</span><span class="p">)</span>
    <span class="k">return</span></div>
    
<div class="viewcode-block" id="BFDTDobject.writeShellScript"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.writeShellScript">[docs]</a>  <span class="k">def</span> <span class="nf">writeShellScript</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">,</span> <span class="n">EXE</span><span class="o">=</span><span class="s1">&#39;fdtd&#39;</span><span class="p">,</span> <span class="n">WORKDIR</span><span class="o">=</span><span class="s1">&#39;$JOBDIR&#39;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Generate .sh file &#39;&#39;&#39;</span>
    
    <span class="c1">#if BASENAME is None:</span>
      <span class="c1">#BASENAME = os.path.splitext(os.path.basename(fileName))[0]</span>
    <span class="c1">#GEOshellscript(fileName, BASENAME, EXE, WORKDIR, self.WALLTIME, overwrite=overwrite)</span>
    <span class="n">GEOshellscript</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFileBaseName</span><span class="p">(),</span> <span class="n">EXE</span><span class="p">,</span> <span class="n">WORKDIR</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getWallTime</span><span class="p">(),</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span>
    
    <span class="c1">#probe_col = 0</span>
    <span class="c1">#if self.excitation.E == [1,0,0]:</span>
      <span class="c1">#probe_col = 2</span>
    <span class="c1">#elif self.excitation.E == [0,1,0]:</span>
      <span class="c1">#probe_col = 3</span>
    <span class="c1">#elif self.excitation.E == [0,0,1]:</span>
      <span class="c1">#probe_col = 4</span>
    <span class="c1">#else:</span>
      <span class="c1">#print(&#39;ERROR : Unknown Excitation type&#39;)</span>
      <span class="c1">#sys.exit(-1)</span>
    <span class="c1">#GEOshellscript_advanced(fileName, BASENAME, probe_col, EXE, WORKDIR, WALLTIME)</span>
    <span class="k">return</span></div>
    
<div class="viewcode-block" id="BFDTDobject.getMemoryRequirements"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getMemoryRequirements">[docs]</a>  <span class="k">def</span> <span class="nf">getMemoryRequirements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Return an estimate of the required memory to run the simulation.</span>
<span class="sd">    </span>
<span class="sd">    At the moment, this is based on a fit of the data returned by Gema3 for various simulations and only depends on the number of cells.</span>
<span class="sd">    In reality, the memory used (and the speed) will also depend on the number of probes and snapshots used and is likely to be much higher.</span>
<span class="sd">    </span>
<span class="sd">    ``memory required in Bytes = p1*x + p0``, where x = number of cells, with:</span>

<span class="sd">      * p1 = 37.74864</span>
<span class="sd">      * p0 = 14153702.89349</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNcells</span><span class="p">()</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="mf">37.747</span>
    <span class="n">p0</span> <span class="o">=</span> <span class="mf">1.4147e+07</span>
    <span class="n">required_memory</span> <span class="o">=</span> <span class="n">p1</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">p0</span>
    <span class="k">return</span><span class="p">(</span><span class="n">required_memory</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="BFDTDobject.runSimulation"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.runSimulation">[docs]</a>  <span class="k">def</span> <span class="nf">runSimulation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simdir</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">simname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Writes the simulation files into simdir and runs a simulation there.&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">verbosity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">verbosity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span>
    <span class="n">inFileName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeAll</span><span class="p">(</span><span class="n">simdir</span><span class="p">,</span> <span class="n">simname</span><span class="p">)</span>
    <span class="n">runSimulation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">BFDTD_executable</span><span class="p">,</span> <span class="n">inFileName</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span></div>

<div class="viewcode-block" id="BFDTDobject.getOutputFileNames"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getOutputFileNames">[docs]</a>  <span class="k">def</span> <span class="nf">getOutputFileNames</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fsnap_time_number</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">tsnap_time_number</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Print out names of all output files that will be generated.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">fsnapshot_file_names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">tsnapshot_file_names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">esnapshot_file_names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">probe_file_names</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">probe_ident</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getIdString</span><span class="p">()</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMesh</span><span class="p">()</span>
    <span class="n">fsnap_numID</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">tsnap_numID</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">for</span> <span class="n">snapshot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFrequencySnapshots</span><span class="p">():</span>
      <span class="p">(</span><span class="n">snap_list</span><span class="p">,</span> <span class="n">fsnap_numID</span><span class="p">,</span> <span class="n">tsnap_numID</span><span class="p">)</span> <span class="o">=</span> <span class="n">snapshot</span><span class="o">.</span><span class="n">getFileNames</span><span class="p">(</span><span class="n">fsnap_numID</span><span class="p">,</span> <span class="n">tsnap_numID</span><span class="p">,</span> <span class="n">probe_ident</span><span class="p">,</span> <span class="n">fsnap_time_number</span><span class="p">)</span>
      <span class="n">fsnapshot_file_names</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">snap_list</span><span class="p">)</span>

    <span class="c1"># We need to filter based on class, because there is no difference between time and epsilon snapshots when numbering</span>
    <span class="k">for</span> <span class="n">snapshot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTimeSnapshots</span><span class="p">(</span><span class="n">filterBasedOnClass</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
      <span class="p">(</span><span class="n">snap_list</span><span class="p">,</span> <span class="n">fsnap_numID</span><span class="p">,</span> <span class="n">tsnap_numID</span><span class="p">)</span> <span class="o">=</span> <span class="n">snapshot</span><span class="o">.</span><span class="n">getFileNames</span><span class="p">(</span><span class="n">fsnap_numID</span><span class="p">,</span> <span class="n">tsnap_numID</span><span class="p">,</span> <span class="n">probe_ident</span><span class="p">,</span> <span class="n">tsnap_time_number</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">snapshot</span><span class="o">.</span><span class="n">getTypeBasedOnAttributes</span><span class="p">()</span> <span class="o">==</span> <span class="n">EpsilonSnapshot</span><span class="p">:</span>
        <span class="n">esnapshot_file_names</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">snap_list</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">tsnapshot_file_names</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">snap_list</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="p">(</span><span class="n">fsnapshot_file_names</span><span class="p">,</span> <span class="n">tsnapshot_file_names</span><span class="p">,</span> <span class="n">esnapshot_file_names</span><span class="p">,</span> <span class="n">probe_file_names</span><span class="p">)</span></div>
  
<div class="viewcode-block" id="BFDTDobject.getLatestFrequencySnapTimeNumber"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.getLatestFrequencySnapTimeNumber">[docs]</a>  <span class="k">def</span> <span class="nf">getLatestFrequencySnapTimeNumber</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Nmax</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the highest snap_time_number for which all output files have been generated.</span>
<span class="sd">    </span>
<span class="sd">    .. note:: It does this by incrementing snap_time_number from 0 and stopping as soon as all output files for the current snap_time_number cannot be found.</span>
<span class="sd">      This means that if snapshots for earlier snap_time_number values have been deleted, the result might not be what you expect.</span>
<span class="sd">    </span>
<span class="sd">    If it cannot find output files for snap_time_number=0, it will return -1.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFrequencySnapshots</span><span class="p">():</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;No frequency snapshots defined.&#39;</span><span class="p">)</span>
    
    <span class="n">latest</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">for</span> <span class="n">N</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nmax</span><span class="p">):</span>
      <span class="p">(</span><span class="n">fsnapshot_file_names</span><span class="p">,</span> <span class="n">tsnapshot_file_names</span><span class="p">,</span> <span class="n">esnapshot_file_names</span><span class="p">,</span> <span class="n">probe_file_names</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getOutputFileNames</span><span class="p">(</span><span class="n">fsnap_time_number</span><span class="o">=</span><span class="n">N</span><span class="p">)</span>
      <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">fsnapshot_file_names</span><span class="p">]):</span>
        <span class="n">latest</span> <span class="o">=</span> <span class="n">N</span>
        
    <span class="k">if</span> <span class="n">latest</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No frequency snapshots found with SnapTimeNumber &lt;= (Nmax=</span><span class="si">{}</span><span class="s1">).&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Nmax</span><span class="p">))</span>
      
    <span class="k">return</span><span class="p">(</span><span class="n">latest</span><span class="p">)</span></div>
      
    <span class="c1">#N = 0</span>
    <span class="c1">#if self.verbosity &gt; 3:</span>
      <span class="c1">#print(&#39;self.getOutputFileNames({})[0] = {}&#39;.format(N, self.getOutputFileNames(N)[0]))</span>
    
    <span class="c1">#while all([os.path.exists(i) for i in self.getOutputFileNames(N)[0]]):</span>
      <span class="c1">#N += 1</span>
      <span class="c1">#if N &gt; 100:</span>
        <span class="c1">#print(&#39;No frequency snapshots found with SnapTimeNumber &lt;= 100.&#39;)</span>
        <span class="c1">#return(-1)</span>
        <span class="c1">#break</span>
    <span class="c1">#return(N-1)</span>
  
<div class="viewcode-block" id="BFDTDobject.sampleFunction"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.sampleFunction">[docs]</a>  <span class="k">def</span> <span class="nf">sampleFunction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sampling_function</span><span class="p">,</span> <span class="n">destdir</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sample a function over the current mesh, i.e. generate .prn output files based on a sampling function of the form (epsilon, E, H) = f(x,y,z,t).</span>
<span class="sd">    </span>
<span class="sd">    This is mainly for testing postprocessing tools with known input but can of course be used for anything else.</span>
<span class="sd">    </span>
<span class="sd">    .. todo:: Should take in time via physical time? iteration index? &quot;snapshot repetition index&quot;?</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMesh</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">snapshot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSnapshots</span><span class="p">():</span>
      <span class="n">snapshot</span><span class="o">.</span><span class="n">write_data</span><span class="p">(</span><span class="n">sampling_function</span><span class="p">,</span> <span class="n">mesh</span><span class="o">=</span><span class="n">mesh</span><span class="p">,</span> <span class="n">numID</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">probe_ident</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getIdString</span><span class="p">(),</span> <span class="n">snap_time_number</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">destdir</span><span class="o">=</span><span class="n">destdir</span><span class="p">)</span>
    <span class="k">return</span></div>

  <span class="c1">#def readDataEpsilon(self, snap_time_number=0):</span>
    
    <span class="c1">#mesh = self.getMesh()</span>
    <span class="c1">#probe_ident = self.getIdString()</span>

    <span class="c1">#fsnap_numID = 1</span>
    <span class="c1">#tsnap_numID = 1</span>
    
    <span class="c1">#for snapshot in self.getSnapshots():</span>
      <span class="c1">#if isinstance(snapshot, TimeSnapshot):</span>
        <span class="c1">#if snapshot.eps == 1:</span>
          <span class="c1">#(self.data_epsilon, fsnap_numID, tsnap_numID) = snapshot.read_data(self.data_epsilon, mesh, fsnap_numID, tsnap_numID, probe_ident, snap_time_number, self.dataPaths)</span>
        <span class="c1">#else:</span>
          <span class="c1">## TODO: properly get number of snapshots</span>
          <span class="c1">#tsnap_numID += 1        </span>
      <span class="c1">#pass</span>

    <span class="c1">#print(self.data_epsilon)</span>

    <span class="c1">#return</span>

  <span class="c1">#def readData(self, snap_time_number=0, testrun=False):</span>
    <span class="c1">#&#39;&#39;&#39;</span>
    <span class="c1">#.. todo:: Automatically determine snap_time_number_max...</span>
    <span class="c1">#&#39;&#39;&#39;</span>
    <span class="c1">#Nx = len(self.getXmesh())</span>
    <span class="c1">#Ny = len(self.getYmesh())</span>
    <span class="c1">#Nz = len(self.getZmesh())</span>

    <span class="c1">##self.data_epsilon = numpy.zeros([Nx,Ny,Nz], dtype=float)</span>
    <span class="c1">#data_tsnap = numpy.zeros([Nx,Ny,Nz], dtype=[(&#39;E&#39;, float, 3), (&#39;H&#39;, float, 3), (&#39;Pow&#39;, float), (&#39;material&#39;, float)])</span>
    <span class="c1">#data_fsnap = numpy.zeros([Nx,Ny,Nz], dtype=[(&#39;E&#39;, complex, 3), (&#39;H&#39;, complex, 3)])</span>
    
    <span class="c1">#mesh = self.getMesh()</span>
    <span class="c1">#probe_ident = self.getIdString()</span>
    
    <span class="c1">#(all_time_snapshots, time_snapshots, epsilon_snapshots, mode_filtered_probes) = self.getAllTimeSnapshots(filterBasedOnClass=False)</span>

    <span class="c1">#fsnap_numID = 1</span>
    <span class="c1">#tsnap_numID = 1</span>

    <span class="c1">#for idx, snapshot in enumerate(all_time_snapshots):</span>
      <span class="c1">#(data_tsnap, fsnap_numID, tsnap_numID) = snapshot.read_data(data_tsnap, mesh, fsnap_numID, tsnap_numID, probe_ident, snap_time_number, self.dataPaths, testrun)</span>

    <span class="c1">#for idx, snapshot in enumerate(self.getFrequencySnapshots()):</span>
      <span class="c1">#(data_fsnap, fsnap_numID, tsnap_numID) = snapshot.read_data(data_fsnap, mesh, fsnap_numID, tsnap_numID, probe_ident, snap_time_number, self.dataPaths, testrun)</span>

    <span class="c1">##for snapshot in self.getSnapshots():</span>
      <span class="c1">##(self.data, fsnap_numID, tsnap_numID) = snapshot.read_data(self.data, mesh, fsnap_numID, tsnap_numID, probe_ident, snap_time_number, self.dataPaths)</span>
      <span class="c1">##if isinstance(snapshot, TimeSnapshot):</span>
        <span class="c1">##if snapshot.getTypeBasedOnAttributes() == </span>
      <span class="c1">##if isinstance(snapshot, FrequencySnapshot):</span>
          <span class="c1">##(self.data_epsilon, fsnap_numID, tsnap_numID) = snapshot.read_data(self.data_epsilon, mesh, fsnap_numID, tsnap_numID, probe_ident, snap_time_number, self.dataPaths)</span>
      <span class="c1">##pass</span>

    <span class="c1">#self.data_time_snapshots = [data_tsnap]</span>
    <span class="c1">#self.data_frequency_snapshots = [data_fsnap]</span>
    
    <span class="c1">##print(&#39;time data&#39;)</span>
    <span class="c1">##print(data_tsnap)</span>

    <span class="c1">##print(&#39;frequency data&#39;)</span>
    <span class="c1">##print(data_fsnap)</span>
    
    <span class="c1">##print(self.data)</span>

    <span class="c1">#return</span>

<div class="viewcode-block" id="BFDTDobject.readDataTimeSnapshots"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.readDataTimeSnapshots">[docs]</a>  <span class="k">def</span> <span class="nf">readDataTimeSnapshots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">snap_time_number</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">testrun</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">Nx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getXmesh</span><span class="p">())</span>
    <span class="n">Ny</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getYmesh</span><span class="p">())</span>
    <span class="n">Nz</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getZmesh</span><span class="p">())</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMesh</span><span class="p">()</span>
    <span class="n">probe_ident</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getIdString</span><span class="p">()</span>

    <span class="n">data_tsnap</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">Nx</span><span class="p">,</span><span class="n">Ny</span><span class="p">,</span><span class="n">Nz</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Pow&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;material&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">)])</span>
    
    <span class="p">(</span><span class="n">all_time_snapshots</span><span class="p">,</span> <span class="n">time_snapshots</span><span class="p">,</span> <span class="n">epsilon_snapshots</span><span class="p">,</span> <span class="n">mode_filtered_probes</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAllTimeSnapshots</span><span class="p">(</span><span class="n">filterBasedOnClass</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">fsnap_numID</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">tsnap_numID</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">Nsnaps</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_time_snapshots</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">snapshot</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">all_time_snapshots</span><span class="p">):</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;reading snapshot </span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">Nsnaps</span><span class="p">))</span>
      <span class="p">(</span><span class="n">data_tsnap</span><span class="p">,</span> <span class="n">fsnap_numID</span><span class="p">,</span> <span class="n">tsnap_numID</span><span class="p">)</span> <span class="o">=</span> <span class="n">snapshot</span><span class="o">.</span><span class="n">read_data</span><span class="p">(</span><span class="n">data_tsnap</span><span class="p">,</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">fsnap_numID</span><span class="p">,</span> <span class="n">tsnap_numID</span><span class="p">,</span> <span class="n">probe_ident</span><span class="p">,</span> <span class="n">snap_time_number</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataPaths</span><span class="p">,</span> <span class="n">testrun</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">data_time_snapshots</span><span class="p">[</span><span class="n">snap_time_number</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_tsnap</span>

    <span class="k">return</span></div>

<div class="viewcode-block" id="BFDTDobject.readDataFrequencySnapshots"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.readDataFrequencySnapshots">[docs]</a>  <span class="k">def</span> <span class="nf">readDataFrequencySnapshots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">snap_time_number</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">testrun</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">Nx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getXmesh</span><span class="p">())</span>
    <span class="n">Ny</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getYmesh</span><span class="p">())</span>
    <span class="n">Nz</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getZmesh</span><span class="p">())</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMesh</span><span class="p">()</span>
    <span class="n">probe_ident</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getIdString</span><span class="p">()</span>

    <span class="n">data_fsnap</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">Nx</span><span class="p">,</span><span class="n">Ny</span><span class="p">,</span><span class="n">Nz</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="mi">3</span><span class="p">)])</span>
    
    <span class="n">fsnap_numID</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">tsnap_numID</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">all_freq_snapshots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFrequencySnapshots</span><span class="p">()</span>
    <span class="n">Nsnaps</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_freq_snapshots</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">snapshot</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">all_freq_snapshots</span><span class="p">):</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;reading snapshot </span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">Nsnaps</span><span class="p">))</span>
      <span class="p">(</span><span class="n">data_fsnap</span><span class="p">,</span> <span class="n">fsnap_numID</span><span class="p">,</span> <span class="n">tsnap_numID</span><span class="p">)</span> <span class="o">=</span> <span class="n">snapshot</span><span class="o">.</span><span class="n">read_data</span><span class="p">(</span><span class="n">data_fsnap</span><span class="p">,</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">fsnap_numID</span><span class="p">,</span> <span class="n">tsnap_numID</span><span class="p">,</span> <span class="n">probe_ident</span><span class="p">,</span> <span class="n">snap_time_number</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataPaths</span><span class="p">,</span> <span class="n">testrun</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">data_frequency_snapshots</span><span class="p">[</span><span class="n">snap_time_number</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_fsnap</span>
    
    <span class="k">return</span></div>

<div class="viewcode-block" id="BFDTDobject.writeHDF5"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.writeHDF5">[docs]</a>  <span class="k">def</span> <span class="nf">writeHDF5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5file</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">h5py</span>
    <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">h5file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
      
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;writing to &#39;</span> <span class="o">+</span> <span class="n">h5file</span><span class="p">)</span>

      <span class="c1">#dset = f.create_dataset(&quot;description&quot;, (), dtype=&quot;S29&quot;)</span>
      <span class="c1">#dset[...] = &#39;dielectric function, epsilon&#39;</span>

      <span class="n">dset</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">string_</span><span class="p">(</span><span class="s1">&#39;Bristol FDTD data&#39;</span><span class="p">))</span>
      
      <span class="c1">#description = &#39;Bristol FDTD data&#39;</span>
      <span class="c1">##dset = f.create_dataset(&quot;description&quot;, (), dtype=&#39;S{}&#39;.format(len(description)))</span>
      <span class="c1">#dset = f.create_dataset(&quot;description&quot;, (), dtype=&#39;S18&#39;)</span>
      <span class="c1">#dset[...] = description</span>

      <span class="c1">#dset = f.create_dataset(&quot;description&quot;, data=&#39;Bristol FDTD data&#39;)</span>
      <span class="c1">#dset[...] = &#39;Bristol FDTD data&#39;</span>

      <span class="n">a1</span> <span class="o">=</span> <span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
      <span class="n">a2</span> <span class="o">=</span> <span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
      <span class="n">a3</span> <span class="o">=</span> <span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
      <span class="n">lattice_vectors</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">a3</span><span class="p">])</span>
      <span class="n">dset</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;/lattice vectors&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">lattice_vectors</span><span class="p">)</span>

      <span class="n">dset</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;/xmesh&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getXmesh</span><span class="p">())</span>
      <span class="n">dset</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;/ymesh&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getYmesh</span><span class="p">())</span>
      <span class="n">dset</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;/zmesh&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getZmesh</span><span class="p">())</span>
      
      <span class="n">probe_group</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;/probes&quot;</span><span class="p">)</span>
      <span class="n">tsnap_group</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;/time_snapshots&quot;</span><span class="p">)</span>
      <span class="n">fsnap_group</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;/frequency_snapshots&quot;</span><span class="p">)</span>
      
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_time_snapshots</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">snap_time_number</span><span class="p">,</span> <span class="n">tsnap</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_time_snapshots</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
          <span class="n">dset</span> <span class="o">=</span> <span class="n">tsnap_group</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;tsnap_</span><span class="si">{:03d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">snap_time_number</span><span class="p">),</span> <span class="n">data</span><span class="o">=</span><span class="n">tsnap</span><span class="p">)</span>

      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_frequency_snapshots</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">snap_time_number</span><span class="p">,</span> <span class="n">fsnap</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_frequency_snapshots</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
          <span class="n">dset</span> <span class="o">=</span> <span class="n">fsnap_group</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;fsnap_</span><span class="si">{:03d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">snap_time_number</span><span class="p">),</span> <span class="n">data</span><span class="o">=</span><span class="n">fsnap</span><span class="p">)</span>
        
      <span class="c1">#dset = f.create_dataset(&#39;/epsilon&#39;, data=self.data_epsilon)</span>
          
    <span class="k">return</span></div>

<div class="viewcode-block" id="BFDTDobject.writeTorqueJobDirectory"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.writeTorqueJobDirectory">[docs]</a>  <span class="k">def</span> <span class="nf">writeTorqueJobDirectory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">destdir</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Generate .in, .inp, .geo and .sh files in directory *destdir* (it will be created if it doesn&#39;t exist).</span>
<span class="sd">    </span>
<span class="sd">    This function was created as a replacement for writeAll and makes it easier to generate the desired .sh file to be submitted with qsub.</span>
<span class="sd">    </span>
<span class="sd">    .. note:: The destination directory will be created if it does not exist.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">geoFile</span> <span class="o">=</span> <span class="n">destdir</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileBaseName</span><span class="o">+</span><span class="s1">&#39;.geo&#39;</span>
    <span class="n">inpFile</span> <span class="o">=</span> <span class="n">destdir</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileBaseName</span><span class="o">+</span><span class="s1">&#39;.inp&#39;</span>
    <span class="n">inFile</span> <span class="o">=</span> <span class="n">destdir</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileBaseName</span><span class="o">+</span><span class="s1">&#39;.in&#39;</span>
    <span class="n">shFile</span> <span class="o">=</span> <span class="n">destdir</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileBaseName</span><span class="o">+</span><span class="s1">&#39;.sh&#39;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">overwrite</span><span class="p">:</span>
      <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;These files already exist in &#39;</span> <span class="o">+</span> <span class="n">destdir</span> <span class="o">+</span> <span class="s1">&#39; :</span><span class="se">\n</span><span class="s1">&#39;</span>
      <span class="n">files_exist</span> <span class="o">=</span> <span class="kc">False</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">geoFile</span><span class="p">,</span> <span class="n">inpFile</span><span class="p">,</span> <span class="n">inFile</span><span class="p">,</span> <span class="n">shFile</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
          <span class="n">msg</span> <span class="o">+=</span> <span class="s1">&#39;- &#39;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
          <span class="n">files_exist</span> <span class="o">=</span> <span class="kc">True</span>
      <span class="k">if</span> <span class="n">files_exist</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">UserWarning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
      
    <span class="bp">self</span><span class="o">.</span><span class="n">writeAll</span><span class="p">(</span><span class="n">destdir</span><span class="p">,</span> <span class="n">fileBaseName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fileBaseName</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span>
    <span class="c1">#self.writeShellScript(shFile, BASENAME=self.fileBaseName, EXE=self.BFDTD_executable, WORKDIR=self.WORKDIR, WALLTIME=self.WALLTIME, overwrite=overwrite)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">writeShellScript</span><span class="p">(</span><span class="n">shFile</span><span class="p">,</span> <span class="n">EXE</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">BFDTD_executable</span><span class="p">,</span> <span class="n">WORKDIR</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">WORKDIR</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span>
    <span class="k">return</span></div>
  
<div class="viewcode-block" id="BFDTDobject.writeAll"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.writeAll">[docs]</a>  <span class="k">def</span> <span class="nf">writeAll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newDirName</span><span class="p">,</span> <span class="n">fileBaseName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">withGeom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">writeShellScriptFunction</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Generate .in,.inp,.geo,.cmd,.sh files in directory newDirName (it will be created if it doesn&#39;t exist)</span>
<span class="sd">    </span>
<span class="sd">    .. note:: Please use writeTorqueJobDirectory if you wish to prepare a job directory for submission with qsub.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">newDirName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">newDirName</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="c1"># replace ~ or similar and remove any trailing &#39;/&#39;</span>
    
    <span class="c1">#use_makedirs=False</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">newDirName</span><span class="p">):</span>
      <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">newDirName</span><span class="p">)</span>
      <span class="c1">#if use_makedirs:</span>
        <span class="c1">#os.makedirs(newDirName)</span>
      <span class="c1">#else:</span>
        <span class="c1">#os.mkdir(newDirName)</span>

    <span class="k">if</span> <span class="n">fileBaseName</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">fileBaseName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileBaseName</span>
      <span class="c1">#fileBaseName = os.path.basename(os.path.abspath(newDirName))</span>
    
    <span class="c1">#print(&#39;fileBaseName = &#39;+fileBaseName)</span>
    
    <span class="n">geoFileName</span> <span class="o">=</span> <span class="n">newDirName</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">+</span><span class="n">fileBaseName</span><span class="o">+</span><span class="s1">&#39;.geo&#39;</span>
    <span class="n">inpFileName</span> <span class="o">=</span> <span class="n">newDirName</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">+</span><span class="n">fileBaseName</span><span class="o">+</span><span class="s1">&#39;.inp&#39;</span>
    <span class="n">inFileName</span> <span class="o">=</span> <span class="n">newDirName</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">+</span><span class="n">fileBaseName</span><span class="o">+</span><span class="s1">&#39;.in&#39;</span>
    <span class="n">cmdFileName</span> <span class="o">=</span> <span class="n">newDirName</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">+</span><span class="n">fileBaseName</span><span class="o">+</span><span class="s1">&#39;.cmd&#39;</span>
    <span class="n">shFileName</span> <span class="o">=</span> <span class="n">newDirName</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">+</span><span class="n">fileBaseName</span><span class="o">+</span><span class="s1">&#39;.sh&#39;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileList</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">fileList</span> <span class="o">=</span> <span class="p">[</span><span class="n">fileBaseName</span><span class="o">+</span><span class="s1">&#39;.inp&#39;</span><span class="p">,</span><span class="n">fileBaseName</span><span class="o">+</span><span class="s1">&#39;.geo&#39;</span><span class="p">]</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">writeGeoFile</span><span class="p">(</span><span class="n">geoFileName</span><span class="p">,</span> <span class="n">withGeom</span> <span class="o">=</span> <span class="n">withGeom</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">writeInpFile</span><span class="p">(</span><span class="n">inpFileName</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">writeFileList</span><span class="p">(</span><span class="n">inFileName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileList</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">writeDatFiles</span><span class="p">(</span><span class="n">newDirName</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">writeShellScriptFunction</span><span class="p">:</span>
      <span class="n">writeShellScriptFunction</span><span class="p">(</span><span class="n">shFileName</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span>
      <span class="c1">#self.writeCondorScript(cmdFileName)</span>
    
    <span class="k">return</span><span class="p">(</span><span class="n">inFileName</span><span class="p">)</span></div>
  
<div class="viewcode-block" id="BFDTDobject.fitBox"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.fitBox">[docs]</a>  <span class="k">def</span> <span class="nf">fitBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vec6</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Changes the limits of the box to fit the geometry. Moves all other things as necessary to have box min be [0,0,0] (necessary?).</span>
<span class="sd">    </span>
<span class="sd">    .. todo:: Finish this function.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;fitBox not working yet&#39;</span><span class="p">)</span>
    <span class="k">return</span></div>
  
<div class="viewcode-block" id="BFDTDobject.calculateMeshingParameters"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.calculateMeshingParameters">[docs]</a>  <span class="k">def</span> <span class="nf">calculateMeshingParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minimum_mesh_delta_vector3</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns a MeshingParameters object that can be used for meshing.</span>
<span class="sd">    </span>
<span class="sd">    It uses the *getMeshingParameters()* function and *useForMeshing* attribute of the various BFDTD objects.</span>
<span class="sd">    </span>
<span class="sd">    minimum_mesh_delta_vector3 : smallest cell size acceptable in the mesh. Because too small cells can cause Bristol FDTD to crash.</span>
<span class="sd">    </span>
<span class="sd">    meshing_parameters attributes:</span>
<span class="sd">    </span>
<span class="sd">      * meshing_parameters.maxPermittivityVector_X</span>
<span class="sd">      * meshing_parameters.thicknessVector_X</span>
<span class="sd">      * meshing_parameters.maxPermittivityVector_Y</span>
<span class="sd">      * meshing_parameters.thicknessVector_Y</span>
<span class="sd">      * meshing_parameters.maxPermittivityVector_Z</span>
<span class="sd">      * meshing_parameters.thicknessVector_Z</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="p">(</span><span class="n">simMinX</span><span class="p">,</span> <span class="n">simMinY</span><span class="p">,</span> <span class="n">simMinZ</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">lower</span>
    <span class="p">(</span><span class="n">simMaxX</span><span class="p">,</span> <span class="n">simMaxY</span><span class="p">,</span> <span class="n">simMaxZ</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">upper</span>

    <span class="c1"># Xvec, Yvec, Zvec are arrays of size (N,2) containing a list of (lower,upper) pairs corresponding to the meshing subdomains defined by the various geometrical objects.</span>
    <span class="c1"># epsX, epsY, epsZ are arrays of size (N,1) containing a list of epsilon values corresponding to the meshing subdomains defined by the various geometrical objects.</span>
    <span class="c1"># The (lower,upper) pairs from Xvec,Yvec,Zvec are associated with the corresponding epsilon values from epsX,epsY,epsZ to determine an appropriate mesh in the X,Y,Z directions respectively.</span>

    <span class="c1"># box mesh</span>
    <span class="n">Xvec</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">simMinX</span><span class="p">,</span> <span class="n">simMaxX</span><span class="p">]])</span>
    <span class="n">Yvec</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">simMinY</span><span class="p">,</span> <span class="n">simMaxY</span><span class="p">]])</span>
    <span class="n">Zvec</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">simMinZ</span><span class="p">,</span> <span class="n">simMaxZ</span><span class="p">]])</span>
    
    <span class="n">epsX</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">]])</span>
    <span class="n">epsY</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">]])</span>
    <span class="n">epsZ</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">]])</span>

    <span class="c1"># geometry object meshes</span>
    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry_object_list</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">useForMeshing</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verboseMeshing</span><span class="p">:</span>
          <span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
          <span class="nb">print</span><span class="p">((</span><span class="n">Xvec</span><span class="p">,</span><span class="n">Yvec</span><span class="p">,</span><span class="n">Zvec</span><span class="p">,</span><span class="n">epsX</span><span class="p">,</span><span class="n">epsY</span><span class="p">,</span><span class="n">epsZ</span><span class="p">))</span>
        <span class="n">Xvec</span><span class="p">,</span><span class="n">Yvec</span><span class="p">,</span><span class="n">Zvec</span><span class="p">,</span><span class="n">epsX</span><span class="p">,</span><span class="n">epsY</span><span class="p">,</span><span class="n">epsZ</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">getMeshingParameters</span><span class="p">(</span><span class="n">Xvec</span><span class="p">,</span><span class="n">Yvec</span><span class="p">,</span><span class="n">Zvec</span><span class="p">,</span><span class="n">epsX</span><span class="p">,</span><span class="n">epsY</span><span class="p">,</span><span class="n">epsZ</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verboseMeshing</span><span class="p">:</span>
          <span class="nb">print</span><span class="p">((</span><span class="n">Xvec</span><span class="p">,</span><span class="n">Yvec</span><span class="p">,</span><span class="n">Zvec</span><span class="p">,</span><span class="n">epsX</span><span class="p">,</span><span class="n">epsY</span><span class="p">,</span><span class="n">epsZ</span><span class="p">))</span>

    <span class="c1"># mesh object meshes</span>
    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_object_list</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">useForMeshing</span><span class="p">:</span>
        <span class="n">Xvec</span><span class="p">,</span><span class="n">Yvec</span><span class="p">,</span><span class="n">Zvec</span><span class="p">,</span><span class="n">epsX</span><span class="p">,</span><span class="n">epsY</span><span class="p">,</span><span class="n">epsZ</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">getMeshingParameters</span><span class="p">(</span><span class="n">Xvec</span><span class="p">,</span><span class="n">Yvec</span><span class="p">,</span><span class="n">Zvec</span><span class="p">,</span><span class="n">epsX</span><span class="p">,</span><span class="n">epsY</span><span class="p">,</span><span class="n">epsZ</span><span class="p">)</span>

    <span class="c1"># excitation object meshes</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitMeshToExcitations</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">excitation_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">useForMeshing</span><span class="p">:</span>
          <span class="n">Xvec</span><span class="p">,</span><span class="n">Yvec</span><span class="p">,</span><span class="n">Zvec</span><span class="p">,</span><span class="n">epsX</span><span class="p">,</span><span class="n">epsY</span><span class="p">,</span><span class="n">epsZ</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">getMeshingParameters</span><span class="p">(</span><span class="n">Xvec</span><span class="p">,</span><span class="n">Yvec</span><span class="p">,</span><span class="n">Zvec</span><span class="p">,</span><span class="n">epsX</span><span class="p">,</span><span class="n">epsY</span><span class="p">,</span><span class="n">epsZ</span><span class="p">)</span>

    <span class="c1"># probe object meshes</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitMeshToProbes</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">probe_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">useForMeshing</span><span class="p">:</span>
          <span class="n">Xvec</span><span class="p">,</span><span class="n">Yvec</span><span class="p">,</span><span class="n">Zvec</span><span class="p">,</span><span class="n">epsX</span><span class="p">,</span><span class="n">epsY</span><span class="p">,</span><span class="n">epsZ</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">getMeshingParameters</span><span class="p">(</span><span class="n">Xvec</span><span class="p">,</span><span class="n">Yvec</span><span class="p">,</span><span class="n">Zvec</span><span class="p">,</span><span class="n">epsX</span><span class="p">,</span><span class="n">epsY</span><span class="p">,</span><span class="n">epsZ</span><span class="p">)</span>

    <span class="c1"># snapshot object meshes</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitMeshToSnapshots</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapshot_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">useForMeshing</span><span class="p">:</span>
          <span class="n">Xvec</span><span class="p">,</span><span class="n">Yvec</span><span class="p">,</span><span class="n">Zvec</span><span class="p">,</span><span class="n">epsX</span><span class="p">,</span><span class="n">epsY</span><span class="p">,</span><span class="n">epsZ</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">getMeshingParameters</span><span class="p">(</span><span class="n">Xvec</span><span class="p">,</span><span class="n">Yvec</span><span class="p">,</span><span class="n">Zvec</span><span class="p">,</span><span class="n">epsX</span><span class="p">,</span><span class="n">epsY</span><span class="p">,</span><span class="n">epsZ</span><span class="p">)</span>
    
    <span class="c1"># postprocess the meshes</span>
    <span class="n">Xvec</span><span class="p">[</span><span class="n">Xvec</span><span class="o">&lt;</span><span class="n">simMinX</span><span class="p">]</span> <span class="o">=</span> <span class="n">simMinX</span>
    <span class="n">Xvec</span><span class="p">[</span><span class="n">Xvec</span><span class="o">&gt;</span><span class="n">simMaxX</span><span class="p">]</span> <span class="o">=</span> <span class="n">simMaxX</span>
    <span class="n">Yvec</span><span class="p">[</span><span class="n">Yvec</span><span class="o">&lt;</span><span class="n">simMinY</span><span class="p">]</span> <span class="o">=</span> <span class="n">simMinY</span>
    <span class="n">Yvec</span><span class="p">[</span><span class="n">Yvec</span><span class="o">&gt;</span><span class="n">simMaxY</span><span class="p">]</span> <span class="o">=</span> <span class="n">simMaxY</span>
    <span class="n">Zvec</span><span class="p">[</span><span class="n">Zvec</span><span class="o">&lt;</span><span class="n">simMinZ</span><span class="p">]</span> <span class="o">=</span> <span class="n">simMinZ</span>
    <span class="n">Zvec</span><span class="p">[</span><span class="n">Zvec</span><span class="o">&gt;</span><span class="n">simMaxZ</span><span class="p">]</span> <span class="o">=</span> <span class="n">simMaxZ</span>

    <span class="c1">##</span>
    <span class="n">VX</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">Xvec</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">Xvec</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]])))</span>
    <span class="n">MX</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Xvec</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">len</span><span class="p">(</span><span class="n">VX</span><span class="p">)))</span>

    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Xvec</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
      <span class="n">indmin</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">VX</span><span class="o">==</span><span class="n">Xvec</span><span class="p">[</span><span class="n">m</span><span class="p">,</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">indmaX</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">VX</span><span class="o">==</span><span class="n">Xvec</span><span class="p">[</span><span class="n">m</span><span class="p">,</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">eps</span> <span class="o">=</span> <span class="n">epsX</span><span class="p">[</span><span class="n">m</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">vv</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">VX</span><span class="p">))</span>
      <span class="n">vv</span><span class="p">[</span><span class="n">indmin</span><span class="p">:</span><span class="n">indmaX</span><span class="p">]</span> <span class="o">=</span> <span class="n">eps</span>
      <span class="n">MX</span><span class="p">[</span><span class="n">m</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">vv</span>
  
    <span class="n">thicknessVX</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">VX</span><span class="p">)</span>
    <span class="n">epsVX</span> <span class="o">=</span> <span class="n">MX</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="n">MX</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">epsVX</span> <span class="o">=</span> <span class="n">epsVX</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1">##</span>
    <span class="n">VY</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">Yvec</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">Yvec</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]])))</span>
    <span class="n">MY</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Yvec</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">len</span><span class="p">(</span><span class="n">VY</span><span class="p">)))</span>

    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Yvec</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
      <span class="n">indmin</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">VY</span><span class="o">==</span><span class="n">Yvec</span><span class="p">[</span><span class="n">m</span><span class="p">,</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">indmax</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">VY</span><span class="o">==</span><span class="n">Yvec</span><span class="p">[</span><span class="n">m</span><span class="p">,</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">eps</span> <span class="o">=</span> <span class="n">epsY</span><span class="p">[</span><span class="n">m</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">vv</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">VY</span><span class="p">))</span>
      <span class="n">vv</span><span class="p">[</span><span class="n">indmin</span><span class="p">:</span><span class="n">indmax</span><span class="p">]</span> <span class="o">=</span> <span class="n">eps</span>
      <span class="n">MY</span><span class="p">[</span><span class="n">m</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">vv</span>
  
    <span class="n">thicknessVY</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">VY</span><span class="p">)</span>
    <span class="n">epsVY</span> <span class="o">=</span> <span class="n">MY</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="n">MY</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">epsVY</span> <span class="o">=</span> <span class="n">epsVY</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1">##</span>
    <span class="n">VZ</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">Zvec</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">Zvec</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]])))</span>
    <span class="n">MZ</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Zvec</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">len</span><span class="p">(</span><span class="n">VZ</span><span class="p">)))</span>

    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Zvec</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
      <span class="n">indmin</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">VZ</span><span class="o">==</span><span class="n">Zvec</span><span class="p">[</span><span class="n">m</span><span class="p">,</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">indmax</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">VZ</span><span class="o">==</span><span class="n">Zvec</span><span class="p">[</span><span class="n">m</span><span class="p">,</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">eps</span> <span class="o">=</span> <span class="n">epsZ</span><span class="p">[</span><span class="n">m</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">vv</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">VZ</span><span class="p">))</span>
      <span class="n">vv</span><span class="p">[</span><span class="n">indmin</span><span class="p">:</span><span class="n">indmax</span><span class="p">]</span> <span class="o">=</span> <span class="n">eps</span>
      <span class="n">MZ</span><span class="p">[</span><span class="n">m</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">vv</span>
  
    <span class="n">thicknessVZ</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">VZ</span><span class="p">)</span>
    <span class="n">epsVZ</span> <span class="o">=</span> <span class="n">MZ</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="n">MZ</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">epsVZ</span> <span class="o">=</span> <span class="n">epsVZ</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        
    <span class="c1">##############################################</span>
    <span class="n">meshing_parameters</span> <span class="o">=</span> <span class="n">MeshingParameters</span><span class="p">()</span>
    <span class="n">meshing_parameters</span><span class="o">.</span><span class="n">maxPermittivityVector_X</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">meshing_parameters</span><span class="o">.</span><span class="n">thicknessVector_X</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">meshing_parameters</span><span class="o">.</span><span class="n">maxPermittivityVector_Y</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">meshing_parameters</span><span class="o">.</span><span class="n">thicknessVector_Y</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">meshing_parameters</span><span class="o">.</span><span class="n">maxPermittivityVector_Z</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">meshing_parameters</span><span class="o">.</span><span class="n">thicknessVector_Z</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c1"># TODO: use (thickness, epsilon) tuples so that filter() and similar functions can be used. Also prevents errors if lists have different lengths.</span>
    <span class="c1"># ex: t = filter(lambda x: x&gt;=1, t)</span>
    <span class="c1"># filter out parts smaller than minimum_mesh_delta_vector3[i]</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">thicknessVX</span><span class="p">)):</span>
      <span class="k">if</span> <span class="n">thicknessVX</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">minimum_mesh_delta_vector3</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">meshing_parameters</span><span class="o">.</span><span class="n">maxPermittivityVector_X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">epsVX</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
        <span class="n">meshing_parameters</span><span class="o">.</span><span class="n">thicknessVector_X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thicknessVX</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">thicknessVY</span><span class="p">)):</span>
      <span class="k">if</span> <span class="n">thicknessVY</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">minimum_mesh_delta_vector3</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">meshing_parameters</span><span class="o">.</span><span class="n">maxPermittivityVector_Y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">epsVY</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
        <span class="n">meshing_parameters</span><span class="o">.</span><span class="n">thicknessVector_Y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thicknessVY</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">thicknessVZ</span><span class="p">)):</span>
      <span class="k">if</span> <span class="n">thicknessVZ</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">minimum_mesh_delta_vector3</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
        <span class="n">meshing_parameters</span><span class="o">.</span><span class="n">maxPermittivityVector_Z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">epsVZ</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
        <span class="n">meshing_parameters</span><span class="o">.</span><span class="n">thicknessVector_Z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thicknessVZ</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
    
    <span class="k">return</span> <span class="n">meshing_parameters</span></div>
  
<div class="viewcode-block" id="BFDTDobject.autoMeshGeometryWithMaxNumberOfCells"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.autoMeshGeometryWithMaxNumberOfCells">[docs]</a>  <span class="k">def</span> <span class="nf">autoMeshGeometryWithMaxNumberOfCells</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Lambda</span><span class="p">,</span> <span class="n">MAXCELLS</span> <span class="o">=</span> <span class="mf">1e7</span><span class="p">,</span> <span class="n">a_min</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">a_step</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">a_start</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Calls autoMeshGeometry(Lambda/a) until it finds the biggest value of *a* (i.e. smallest cell size) so that Ncells &lt; MAXCELLS.</span>
<span class="sd">    </span>
<span class="sd">    Returns the final value used for a.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">a_start</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">autoMeshGeometry</span><span class="p">(</span><span class="n">Lambda</span><span class="o">/</span><span class="n">a</span><span class="p">)</span>
    <span class="c1">#print(self.getNcells()&lt;MAXCELLS)</span>
    <span class="k">while</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNcells</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">MAXCELLS</span> <span class="p">):</span>
      <span class="c1">#print(a)</span>
      <span class="n">a</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">a_step</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">autoMeshGeometry</span><span class="p">(</span><span class="n">Lambda</span><span class="o">/</span><span class="n">a</span><span class="p">)</span>
    <span class="k">while</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNcells</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">MAXCELLS</span> <span class="ow">and</span> <span class="n">a</span> <span class="o">-</span> <span class="n">a_step</span> <span class="o">&gt;=</span> <span class="n">a_min</span> <span class="p">):</span>
      <span class="n">a</span> <span class="o">=</span> <span class="n">a</span> <span class="o">-</span> <span class="n">a_step</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">autoMeshGeometry</span><span class="p">(</span><span class="n">Lambda</span><span class="o">/</span><span class="n">a</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">a</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="BFDTDobject.autoMeshGeometry"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.autoMeshGeometry">[docs]</a>  <span class="k">def</span> <span class="nf">autoMeshGeometry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meshing_factor</span><span class="p">,</span> <span class="n">minimum_mesh_delta_vector3</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1e-3</span><span class="p">,</span><span class="mf">1e-3</span><span class="p">,</span><span class="mf">1e-3</span><span class="p">]):</span>
    <span class="sd">&#39;&#39;&#39; Automatically mesh geometry so that the max cell size is meshing_factor*1/n in each object. &#39;&#39;&#39;</span>
    <span class="n">meshing_parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculateMeshingParameters</span><span class="p">(</span><span class="n">minimum_mesh_delta_vector3</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verboseMeshing</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=== meshing_parameters ===&#39;</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="n">meshing_parameters</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;meshing_factor*1./numpy.sqrt(meshing_parameters.maxPermittivityVector_X) = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">meshing_factor</span><span class="o">*</span><span class="mf">1.</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">meshing_parameters</span><span class="o">.</span><span class="n">maxPermittivityVector_X</span><span class="p">)))</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;meshing_factor*1./numpy.sqrt(meshing_parameters.maxPermittivityVector_Y) = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">meshing_factor</span><span class="o">*</span><span class="mf">1.</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">meshing_parameters</span><span class="o">.</span><span class="n">maxPermittivityVector_Y</span><span class="p">)))</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;meshing_factor*1./numpy.sqrt(meshing_parameters.maxPermittivityVector_Z) = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">meshing_factor</span><span class="o">*</span><span class="mf">1.</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">meshing_parameters</span><span class="o">.</span><span class="n">maxPermittivityVector_Z</span><span class="p">)))</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;==========================&#39;</span><span class="p">)</span>
    <span class="n">delta_X_vector</span><span class="p">,</span> <span class="n">local_delta_X_vector</span> <span class="o">=</span> <span class="n">subGridMultiLayer</span><span class="p">(</span><span class="n">meshing_factor</span><span class="o">*</span><span class="mf">1.</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">meshing_parameters</span><span class="o">.</span><span class="n">maxPermittivityVector_X</span><span class="p">),</span> <span class="n">meshing_parameters</span><span class="o">.</span><span class="n">thicknessVector_X</span><span class="p">)</span>
    <span class="n">delta_Y_vector</span><span class="p">,</span> <span class="n">local_delta_Y_vector</span> <span class="o">=</span> <span class="n">subGridMultiLayer</span><span class="p">(</span><span class="n">meshing_factor</span><span class="o">*</span><span class="mf">1.</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">meshing_parameters</span><span class="o">.</span><span class="n">maxPermittivityVector_Y</span><span class="p">),</span> <span class="n">meshing_parameters</span><span class="o">.</span><span class="n">thicknessVector_Y</span><span class="p">)</span>
    <span class="n">delta_Z_vector</span><span class="p">,</span> <span class="n">local_delta_Z_vector</span> <span class="o">=</span> <span class="n">subGridMultiLayer</span><span class="p">(</span><span class="n">meshing_factor</span><span class="o">*</span><span class="mf">1.</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">meshing_parameters</span><span class="o">.</span><span class="n">maxPermittivityVector_Z</span><span class="p">),</span> <span class="n">meshing_parameters</span><span class="o">.</span><span class="n">thicknessVector_Z</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">setXmeshDelta</span><span class="p">(</span><span class="n">delta_X_vector</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">setYmeshDelta</span><span class="p">(</span><span class="n">delta_Y_vector</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">setZmeshDelta</span><span class="p">(</span><span class="n">delta_Z_vector</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verboseMeshing</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=== mesh ===&#39;</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;============&#39;</span><span class="p">)</span>
    <span class="k">return</span></div>
  
<div class="viewcode-block" id="BFDTDobject.rotate"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.rotate">[docs]</a>  <span class="k">def</span> <span class="nf">rotate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis_point</span><span class="p">,</span> <span class="n">axis_direction</span><span class="p">,</span> <span class="n">angle_degrees</span><span class="p">):</span>
    <span class="c1"># .. todo:: Will only work for cylinders at the moment. (objects currently need to call parent class rotate function)</span>
    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry_object_list</span><span class="p">:</span>
      <span class="n">obj</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">axis_point</span><span class="p">,</span> <span class="n">axis_direction</span><span class="p">,</span> <span class="n">angle_degrees</span><span class="p">)</span>
    <span class="k">return</span></div>
    
<div class="viewcode-block" id="BFDTDobject.translate"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.translate">[docs]</a>  <span class="k">def</span> <span class="nf">translate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vec3</span><span class="p">):</span>
    <span class="c1"># .. todo:: translate rotations? (assuming they remain separate from the object they apply to, which really, they should not)</span>
    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry_object_list</span><span class="p">:</span>
      <span class="n">obj</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">vec3</span><span class="p">)</span>
    <span class="k">return</span></div>
    
<div class="viewcode-block" id="BFDTDobject.applyTransformationMatrix"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.BFDTDobject.applyTransformationMatrix">[docs]</a>  <span class="k">def</span> <span class="nf">applyTransformationMatrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">M</span><span class="p">):</span>
    <span class="c1"># .. todo:: finish this</span>
    <span class="k">return</span></div></div>

<span class="c1"># mandatory objects</span>
<div class="viewcode-block" id="Flag"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.Flag">[docs]</a><span class="k">class</span> <span class="nc">Flag</span><span class="p">(</span><span class="n">BFDTDentry</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  * iterationMethod: Set to 1 if FDTD/PEEC is wanted</span>
<span class="sd">  * propagationConstant: Propagation constant for two dimensional runs</span>
<span class="sd">  * flagOne: Set to 1 to use the Celuch method for dealing with curved dielectrics</span>
<span class="sd">  * flagTwo: Set to:</span>
<span class="sd">  </span>
<span class="sd">    1. Set to specify a two dimensional simulation</span>
<span class="sd">    2. Specify Static Field Solutions for metal strips</span>
<span class="sd">    3. Specify Pre-calculated Correction Factors for metal strips</span>
<span class="sd">    4. Specify MAMPs</span>
<span class="sd">  </span>
<span class="sd">  * iterations: Number of iterations required</span>
<span class="sd">  * timeStepFactor: Time step as a proportion of the maximum allowed</span>
<span class="sd">  * id_string: Probe identifier, id</span>
<span class="sd">  * 8: Set to 1 to ask for a file to be produced for input to the POVRAY ray tracing program</span>
<span class="sd">  </span>
<span class="sd">  .. todo:: This class could easily be integrated into the BFDTDobject class...</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;flag&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">layer</span> <span class="o">=</span> <span class="s1">&#39;flag&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">group</span> <span class="o">=</span> <span class="s1">&#39;flag&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">iterationMethod</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">propagationConstant</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">flagOne</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">flagTwo</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">iterations</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">timeStepFactor</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">;</span> <span class="c1">#mus</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">id_string</span> <span class="o">=</span> <span class="s1">&#39;_id_&#39;</span>
  
<div class="viewcode-block" id="Flag.getIdString"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.Flag.getIdString">[docs]</a>  <span class="k">def</span> <span class="nf">getIdString</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id_string</span><span class="p">)</span></div>
<div class="viewcode-block" id="Flag.setIdString"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.Flag.setIdString">[docs]</a>  <span class="k">def</span> <span class="nf">setIdString</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">id_string</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">id_string</span> <span class="o">=</span> <span class="n">id_string</span></div>
  
<div class="viewcode-block" id="Flag.setIterations"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.Flag.setIterations">[docs]</a>  <span class="k">def</span> <span class="nf">setIterations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterations</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Sets the number of iterations.&#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">iterations</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">iterations</span><span class="p">)</span></div>

<div class="viewcode-block" id="Flag.getIterations"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.Flag.getIterations">[docs]</a>  <span class="k">def</span> <span class="nf">getIterations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Returns the number of iterations.&#39;&#39;&#39;</span>
    <span class="k">return</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iterations</span><span class="p">))</span></div>
    
<div class="viewcode-block" id="Flag.set2D"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.Flag.set2D">[docs]</a>  <span class="k">def</span> <span class="nf">set2D</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">flagTwo</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">propagationConstant</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span></div>
<div class="viewcode-block" id="Flag.set3D"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.Flag.set3D">[docs]</a>  <span class="k">def</span> <span class="nf">set3D</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">flagTwo</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span></div>
    
<div class="viewcode-block" id="Flag.setTimeStepFactor"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.Flag.setTimeStepFactor">[docs]</a>  <span class="k">def</span> <span class="nf">setTimeStepFactor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeStepFactor</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">timeStepFactor</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;timeStepFactor = </span><span class="si">{}</span><span class="s1"> &gt; 1&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">timeStepFactor</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">timeStepFactor</span> <span class="o">=</span> <span class="n">timeStepFactor</span>
    <span class="k">return</span></div>

<div class="viewcode-block" id="Flag.getTimeStepFactor"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.Flag.getTimeStepFactor">[docs]</a>  <span class="k">def</span> <span class="nf">getTimeStepFactor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeStepFactor</span></div>
  
  <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">ret</span>  <span class="o">=</span> <span class="s1">&#39;name = &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">ret</span> <span class="o">+=</span> <span class="s1">&#39;iMethod = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iterationMethod</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>\
    <span class="s1">&#39;propCons = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">propagationConstant</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>\
    <span class="s1">&#39;flagOne = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flagOne</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>\
    <span class="s1">&#39;flagTwo = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flagTwo</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>\
    <span class="s1">&#39;iterations = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iterations</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>\
    <span class="s1">&#39;timeStepFactor = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeStepFactor</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>\
    <span class="s1">&#39;id = &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">id_string</span>
    <span class="k">return</span> <span class="n">ret</span>
<div class="viewcode-block" id="Flag.read_entry"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.Flag.read_entry">[docs]</a>  <span class="k">def</span> <span class="nf">read_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">iterationMethod</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">propagationConstant</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">flagOne</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">flagTwo</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">iterations</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span> <span class="c1"># is there a more direct way to convert to int? :/</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">timeStepFactor</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">id_string</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span></div>
<div class="viewcode-block" id="Flag.write_entry"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.Flag.write_entry">[docs]</a>  <span class="k">def</span> <span class="nf">write_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">FILE</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">):</span>
    
    <span class="c1"># BFDTD does not run if more than 5.5e11~2^39  iterations?</span>
    <span class="c1">#   184624273416 = 1.8462e+11 -&gt; no run</span>
    <span class="c1">#   5.5e11 -&gt; runs ok???</span>
    <span class="c1"># .. todo:: figure out these weird BFDTD bugs... Contact Railton...</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getIterations</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">1e9</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Too many iterations requested. BFDTD may not run any in this case... Also, do you really want that many?&#39;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeStepFactor</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;self.timeStepFactor = </span><span class="si">{}</span><span class="s1"> &gt; 1&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeStepFactor</span><span class="p">))</span>
    
    <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;FLAG  **name=&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;{</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> **ITERATION METHOD</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterationMethod</span><span class="p">)</span>
    <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%E</span><span class="s2"> **PROPAGATION CONSTANT (IGNORED IN 3D MODEL)</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">propagationConstant</span><span class="p">)</span>
    <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> **FLAG ONE</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">flagOne</span><span class="p">)</span>
    <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> **FLAG TWO</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">flagTwo</span><span class="p">)</span>
    <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> **ITERATIONS</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterations</span><span class="p">)</span>
    <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%E</span><span class="s2"> **TIMESTEP as a proportion of the maximum allowed</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeStepFactor</span><span class="p">)</span>
    <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2"> **ID CHARACTER (ALWAYS USE QUOTES)</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">id_string</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">))</span>
    <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="Boundaries"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.Boundaries">[docs]</a><span class="k">class</span> <span class="nc">Boundaries</span><span class="p">(</span><span class="n">BFDTDentry</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  The following ABC algorithms are available in the FDTD program:</span>
<span class="sd">  </span>
<span class="sd">    * 0. Magnetic Wall</span>
<span class="sd">    * 1. Metal wall. -&gt; &quot;symmetry wall&quot;</span>
<span class="sd">    * 2. Mur 1st. -&gt; default setting</span>
<span class="sd">    * 6. Dispersive.</span>
<span class="sd">    * 7. Higdon 1st.</span>
<span class="sd">    * 9. Higdon 2nd</span>
<span class="sd">    * 10. PML</span>
<span class="sd">  </span>
<span class="sd">  The parameters are for the second order and Perfectly Matched Layer boundary conditions and have the following meanings:</span>
<span class="sd">  </span>
<span class="sd">    * i. Dispersive ABC Parameter 1 and parameter2 are the values of effective permittivity for which perfect absorption may be expected</span>
<span class="sd">    * ii. Higdon ABC Parameter 1 and parameter 2 are the values for the angle of incidence ( in degrees ) at which perfect absorption may be expected</span>
<span class="sd">    * iii. PML Parameter 1 is the number of layers in the PML region, parameter 2 is the grading index, normally 2, parameter 3 is the minimum reflection coefficient, try 0.01 - 0.001. This is not critical.</span>

<span class="sd">  If you want to make the BFDTD simulations run faster, you can exploit the symmetry of the structure by putting the simulation box over only one half of the pillar and use a metallic wall at the symmetry boundary.</span>
<span class="sd">    </span>
<span class="sd">  .. todo:: &quot;ABC&quot; = Absorbing Boundary Conditions?</span>
<span class="sd">  .. todo:: Integrate in BFDTDobject?</span>
<span class="sd">  .. todo:: Add support for alphabetic names like &#39;PML&#39;, &#39;Metal wall&#39;, etc for code clarity. + setBoundaryConditionsZneg(ABC), etc functions</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;boundaries&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">layer</span> <span class="o">=</span> <span class="s1">&#39;boundaries&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">group</span> <span class="o">=</span> <span class="s1">&#39;boundaries&#39;</span>

    <span class="c1"># PML=10, symmetry=1, normal=2</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setBoundaryConditionsNormal</span><span class="p">()</span>
    
<div class="viewcode-block" id="Boundaries.setBoundaryConditionsXposToPML"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.Boundaries.setBoundaryConditionsXposToPML">[docs]</a>  <span class="k">def</span> <span class="nf">setBoundaryConditionsXposToPML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number_of_layers</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">grading_index</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">min_reflection_coeff</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Xpos_bc</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Xpos_param</span> <span class="o">=</span> <span class="p">[</span> <span class="n">number_of_layers</span><span class="p">,</span> <span class="n">grading_index</span><span class="p">,</span> <span class="n">min_reflection_coeff</span> <span class="p">]</span></div>
<div class="viewcode-block" id="Boundaries.setBoundaryConditionsYposToPML"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.Boundaries.setBoundaryConditionsYposToPML">[docs]</a>  <span class="k">def</span> <span class="nf">setBoundaryConditionsYposToPML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number_of_layers</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">grading_index</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">min_reflection_coeff</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Ypos_bc</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Ypos_param</span> <span class="o">=</span> <span class="p">[</span> <span class="n">number_of_layers</span><span class="p">,</span> <span class="n">grading_index</span><span class="p">,</span> <span class="n">min_reflection_coeff</span> <span class="p">]</span></div>
<div class="viewcode-block" id="Boundaries.setBoundaryConditionsZposToPML"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.Boundaries.setBoundaryConditionsZposToPML">[docs]</a>  <span class="k">def</span> <span class="nf">setBoundaryConditionsZposToPML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number_of_layers</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">grading_index</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">min_reflection_coeff</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Zpos_bc</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Zpos_param</span> <span class="o">=</span> <span class="p">[</span> <span class="n">number_of_layers</span><span class="p">,</span> <span class="n">grading_index</span><span class="p">,</span> <span class="n">min_reflection_coeff</span> <span class="p">]</span></div>
<div class="viewcode-block" id="Boundaries.setBoundaryConditionsXnegToPML"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.Boundaries.setBoundaryConditionsXnegToPML">[docs]</a>  <span class="k">def</span> <span class="nf">setBoundaryConditionsXnegToPML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number_of_layers</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">grading_index</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">min_reflection_coeff</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Xneg_bc</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Xneg_param</span> <span class="o">=</span> <span class="p">[</span> <span class="n">number_of_layers</span><span class="p">,</span> <span class="n">grading_index</span><span class="p">,</span> <span class="n">min_reflection_coeff</span> <span class="p">]</span></div>
<div class="viewcode-block" id="Boundaries.setBoundaryConditionsYnegToPML"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.Boundaries.setBoundaryConditionsYnegToPML">[docs]</a>  <span class="k">def</span> <span class="nf">setBoundaryConditionsYnegToPML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number_of_layers</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">grading_index</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">min_reflection_coeff</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Yneg_bc</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Yneg_param</span> <span class="o">=</span> <span class="p">[</span> <span class="n">number_of_layers</span><span class="p">,</span> <span class="n">grading_index</span><span class="p">,</span> <span class="n">min_reflection_coeff</span> <span class="p">]</span></div>
<div class="viewcode-block" id="Boundaries.setBoundaryConditionsZnegToPML"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.Boundaries.setBoundaryConditionsZnegToPML">[docs]</a>  <span class="k">def</span> <span class="nf">setBoundaryConditionsZnegToPML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number_of_layers</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">grading_index</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">min_reflection_coeff</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Zneg_bc</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Zneg_param</span> <span class="o">=</span> <span class="p">[</span> <span class="n">number_of_layers</span><span class="p">,</span> <span class="n">grading_index</span><span class="p">,</span> <span class="n">min_reflection_coeff</span> <span class="p">]</span></div>
    
<div class="viewcode-block" id="Boundaries.setBoundaryConditionsToPML"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.Boundaries.setBoundaryConditionsToPML">[docs]</a>  <span class="k">def</span> <span class="nf">setBoundaryConditionsToPML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number_of_layers</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">grading_index</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">min_reflection_coeff</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets all boundaries to PML.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setBoundaryConditionsXnegToPML</span><span class="p">(</span><span class="n">number_of_layers</span><span class="p">,</span> <span class="n">grading_index</span><span class="p">,</span> <span class="n">min_reflection_coeff</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setBoundaryConditionsYnegToPML</span><span class="p">(</span><span class="n">number_of_layers</span><span class="p">,</span> <span class="n">grading_index</span><span class="p">,</span> <span class="n">min_reflection_coeff</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setBoundaryConditionsZnegToPML</span><span class="p">(</span><span class="n">number_of_layers</span><span class="p">,</span> <span class="n">grading_index</span><span class="p">,</span> <span class="n">min_reflection_coeff</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setBoundaryConditionsXposToPML</span><span class="p">(</span><span class="n">number_of_layers</span><span class="p">,</span> <span class="n">grading_index</span><span class="p">,</span> <span class="n">min_reflection_coeff</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setBoundaryConditionsYposToPML</span><span class="p">(</span><span class="n">number_of_layers</span><span class="p">,</span> <span class="n">grading_index</span><span class="p">,</span> <span class="n">min_reflection_coeff</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setBoundaryConditionsZposToPML</span><span class="p">(</span><span class="n">number_of_layers</span><span class="p">,</span> <span class="n">grading_index</span><span class="p">,</span> <span class="n">min_reflection_coeff</span><span class="p">)</span></div>

<div class="viewcode-block" id="Boundaries.setBoundaryConditionsNormal"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.Boundaries.setBoundaryConditionsNormal">[docs]</a>  <span class="k">def</span> <span class="nf">setBoundaryConditionsNormal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Xpos_bc</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Ypos_bc</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Zpos_bc</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Xneg_bc</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Yneg_bc</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Zneg_bc</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">Xpos_param</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Ypos_param</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Zpos_param</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Xneg_param</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Yneg_param</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Zneg_param</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span></div>
    
  <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">ret</span>  <span class="o">=</span> <span class="s1">&#39;name = &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">ret</span> <span class="o">+=</span> <span class="s1">&#39;X+: Type = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Xpos_bc</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; parameters = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Xpos_param</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">ret</span> <span class="o">+=</span> <span class="s1">&#39;Y+: Type = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ypos_bc</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; parameters = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ypos_param</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">ret</span> <span class="o">+=</span> <span class="s1">&#39;Z+: Type = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Zpos_bc</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; parameters = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Zpos_param</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">ret</span> <span class="o">+=</span> <span class="s1">&#39;X-: Type = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Xneg_bc</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; parameters = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Xneg_param</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">ret</span> <span class="o">+=</span> <span class="s1">&#39;Y-: Type = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Yneg_bc</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; parameters = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Yneg_param</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">ret</span> <span class="o">+=</span> <span class="s1">&#39;Z-: Type = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Zneg_bc</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; parameters = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Zneg_param</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ret</span>
<div class="viewcode-block" id="Boundaries.read_entry"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.Boundaries.read_entry">[docs]</a>  <span class="k">def</span> <span class="nf">read_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">entry</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">name</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">Xpos_bc</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span> <span class="bp">self</span><span class="o">.</span><span class="n">Xpos_param</span> <span class="o">=</span> <span class="n">float_array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]);</span> <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">Ypos_bc</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ypos_param</span> <span class="o">=</span> <span class="n">float_array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]);</span> <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">Zpos_bc</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zpos_param</span> <span class="o">=</span> <span class="n">float_array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]);</span> <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">Xneg_bc</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span> <span class="bp">self</span><span class="o">.</span><span class="n">Xneg_param</span> <span class="o">=</span> <span class="n">float_array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]);</span> <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">Yneg_bc</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span> <span class="bp">self</span><span class="o">.</span><span class="n">Yneg_param</span> <span class="o">=</span> <span class="n">float_array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]);</span> <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">Zneg_bc</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zneg_param</span> <span class="o">=</span> <span class="n">float_array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]);</span> <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">24</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">Xpos_bc</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="o">*</span><span class="n">i</span><span class="p">]);</span> <span class="bp">self</span><span class="o">.</span><span class="n">Xpos_param</span> <span class="o">=</span> <span class="n">float_array</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="n">i</span><span class="p">:</span><span class="mi">4</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="n">i</span><span class="p">]);</span> <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">Ypos_bc</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="o">*</span><span class="n">i</span><span class="p">]);</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ypos_param</span> <span class="o">=</span> <span class="n">float_array</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="n">i</span><span class="p">:</span><span class="mi">4</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="n">i</span><span class="p">]);</span> <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">Zpos_bc</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="o">*</span><span class="n">i</span><span class="p">]);</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zpos_param</span> <span class="o">=</span> <span class="n">float_array</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="n">i</span><span class="p">:</span><span class="mi">4</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="n">i</span><span class="p">]);</span> <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">Xneg_bc</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="o">*</span><span class="n">i</span><span class="p">]);</span> <span class="bp">self</span><span class="o">.</span><span class="n">Xneg_param</span> <span class="o">=</span> <span class="n">float_array</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="n">i</span><span class="p">:</span><span class="mi">4</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="n">i</span><span class="p">]);</span> <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">Yneg_bc</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="o">*</span><span class="n">i</span><span class="p">]);</span> <span class="bp">self</span><span class="o">.</span><span class="n">Yneg_param</span> <span class="o">=</span> <span class="n">float_array</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="n">i</span><span class="p">:</span><span class="mi">4</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="n">i</span><span class="p">]);</span> <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">Zneg_bc</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="o">*</span><span class="n">i</span><span class="p">]);</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zneg_param</span> <span class="o">=</span> <span class="n">float_array</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="n">i</span><span class="p">:</span><span class="mi">4</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="n">i</span><span class="p">]);</span> <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ERROR: incorrect number of elements in boundary object&#39;</span><span class="p">)</span>
      <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div>
<div class="viewcode-block" id="Boundaries.write_entry"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.Boundaries.write_entry">[docs]</a>  <span class="k">def</span> <span class="nf">write_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">FILE</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">):</span>
    <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;BOUNDARY  **name=&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;{</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> </span><span class="si">%E</span><span class="s2"> </span><span class="si">%E</span><span class="s2"> </span><span class="si">%E</span><span class="s2"> **X+</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Xpos_bc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Xpos_param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Xpos_param</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Xpos_param</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
    <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> </span><span class="si">%E</span><span class="s2"> </span><span class="si">%E</span><span class="s2"> </span><span class="si">%E</span><span class="s2"> **Y+</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ypos_bc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ypos_param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ypos_param</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ypos_param</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
    <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> </span><span class="si">%E</span><span class="s2"> </span><span class="si">%E</span><span class="s2"> </span><span class="si">%E</span><span class="s2"> **Z+</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Zpos_bc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zpos_param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zpos_param</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zpos_param</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
    <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> </span><span class="si">%E</span><span class="s2"> </span><span class="si">%E</span><span class="s2"> </span><span class="si">%E</span><span class="s2"> **X-</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Xneg_bc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Xneg_param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Xneg_param</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Xneg_param</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
    <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> </span><span class="si">%E</span><span class="s2"> </span><span class="si">%E</span><span class="s2"> </span><span class="si">%E</span><span class="s2"> **Y-</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Yneg_bc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Yneg_param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Yneg_param</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Yneg_param</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
    <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> </span><span class="si">%E</span><span class="s2"> </span><span class="si">%E</span><span class="s2"> </span><span class="si">%E</span><span class="s2"> **Z-</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Zneg_bc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zneg_param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zneg_param</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zneg_param</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
    <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="Box"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.Box">[docs]</a><span class="k">class</span> <span class="nc">Box</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  .. todo:: It might make sense to make the box some sort of subclass of Block, or fully integrate it into the BFDTDobject since there can only be one box anyway.</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
    <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">layer</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">group</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">lower</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">upper</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;box&#39;</span>
    <span class="k">if</span> <span class="n">layer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">layer</span> <span class="o">=</span> <span class="s1">&#39;box&#39;</span><span class="p">,</span>
    <span class="k">if</span> <span class="n">group</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">group</span> <span class="o">=</span> <span class="s1">&#39;box&#39;</span><span class="p">,</span>
    <span class="k">if</span> <span class="n">lower</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">lower</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">upper</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">layer</span> <span class="o">=</span> <span class="n">layer</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">group</span> <span class="o">=</span> <span class="n">group</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lower</span> <span class="o">=</span> <span class="n">lower</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">upper</span> <span class="o">=</span> <span class="n">upper</span>
  
<div class="viewcode-block" id="Box.setLower"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.Box.setLower">[docs]</a>  <span class="k">def</span> <span class="nf">setLower</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lower</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lower</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lower</span><span class="p">)</span></div>
  
<div class="viewcode-block" id="Box.setUpper"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.Box.setUpper">[docs]</a>  <span class="k">def</span> <span class="nf">setUpper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">upper</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">upper</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">upper</span><span class="p">)</span></div>
  
  <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">ret</span>  <span class="o">=</span> <span class="s1">&#39;name = &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">ret</span> <span class="o">+=</span> <span class="s1">&#39;lower = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lower</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">ret</span> <span class="o">+=</span> <span class="s1">&#39;upper = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">upper</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ret</span>
  
<div class="viewcode-block" id="Box.read_entry"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.Box.read_entry">[docs]</a>  <span class="k">def</span> <span class="nf">read_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">entry</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lower</span> <span class="o">=</span> <span class="n">float_array</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">upper</span> <span class="o">=</span> <span class="n">float_array</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">])</span></div>
  
<div class="viewcode-block" id="Box.write_entry"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.Box.write_entry">[docs]</a>  <span class="k">def</span> <span class="nf">write_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">FILE</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lower</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">upper</span> <span class="o">=</span> <span class="n">fixLowerUpper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lower</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">upper</span><span class="p">)</span>
    <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;BOX  **name=&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;{</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%E</span><span class="s2"> **XL</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">lower</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%E</span><span class="s2"> **YL</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">lower</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%E</span><span class="s2"> **ZL</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">lower</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%E</span><span class="s2"> **XU</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">upper</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%E</span><span class="s2"> **YU</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">upper</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%E</span><span class="s2"> **ZU</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">upper</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Box.writeCTL"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.Box.writeCTL">[docs]</a>  <span class="k">def</span> <span class="nf">writeCTL</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">FILE</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">):</span>
    <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;(set! geometry-lattice (make lattice (size </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">)))</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">getSize</span><span class="p">()))</span>
    <span class="k">return</span></div>
    
<div class="viewcode-block" id="Box.translate"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.Box.translate">[docs]</a>  <span class="k">def</span> <span class="nf">translate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vec3</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lower</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lower</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">upper</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">upper</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lower</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lower</span> <span class="o">+</span> <span class="n">vec3</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">upper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">upper</span> <span class="o">+</span> <span class="n">vec3</span></div>

<div class="viewcode-block" id="Box.getCentro"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.Box.getCentro">[docs]</a>  <span class="k">def</span> <span class="nf">getCentro</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lower</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">upper</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lower</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">upper</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lower</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">upper</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="p">])</span></div>
  
<div class="viewcode-block" id="Box.setCentro"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.Box.setCentro">[docs]</a>  <span class="k">def</span> <span class="nf">setCentro</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nova_centro</span><span class="p">):</span>
    <span class="n">nova_centro</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nova_centro</span><span class="p">)</span>    
    <span class="n">nuna_centro</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCentro</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">nova_centro</span> <span class="o">-</span> <span class="n">nuna_centro</span><span class="p">)</span></div>
  
<div class="viewcode-block" id="Box.setExtension"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.Box.setExtension">[docs]</a>  <span class="k">def</span> <span class="nf">setExtension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">lower</span><span class="p">,</span><span class="n">upper</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setLower</span><span class="p">(</span><span class="n">lower</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setUpper</span><span class="p">(</span><span class="n">upper</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Box.getExtension"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.Box.getExtension">[docs]</a>  <span class="k">def</span> <span class="nf">getExtension</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getLower</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">getUpper</span><span class="p">())</span></div>
      
<div class="viewcode-block" id="Box.getSize"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.Box.getSize">[docs]</a>  <span class="k">def</span> <span class="nf">getSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">upper</span><span class="p">)</span><span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lower</span><span class="p">)</span></div>
  
<div class="viewcode-block" id="Box.setSize"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.Box.setSize">[docs]</a>  <span class="k">def</span> <span class="nf">setSize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size_vec3</span><span class="p">):</span>
    <span class="n">C</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCentro</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lower</span> <span class="o">=</span> <span class="n">C</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">size_vec3</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">upper</span> <span class="o">=</span> <span class="n">C</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">size_vec3</span><span class="p">)</span>
    <span class="k">return</span></div>
    
  <span class="c1"># convenience get functions, to get numpy arrays directly</span>
<div class="viewcode-block" id="Box.getLower"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.Box.getLower">[docs]</a>  <span class="k">def</span> <span class="nf">getLower</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lower</span><span class="p">)</span></div>
<div class="viewcode-block" id="Box.getUpper"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.Box.getUpper">[docs]</a>  <span class="k">def</span> <span class="nf">getUpper</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">upper</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="Entry"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.BFDTDobject.Entry">[docs]</a><span class="k">class</span> <span class="nc">Entry</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;default_entry&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">layer</span> <span class="o">=</span> <span class="s1">&#39;default_layer&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="s1">&#39;default_scene&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">group</span> <span class="o">=</span> <span class="s1">&#39;default_group&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Type</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># .. todo:: Will this ever be used?</span></div>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
	<span class="k">pass</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">script_inception_public  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2014, Mike Taverne.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.9.
    </div>
  </body>
</html>